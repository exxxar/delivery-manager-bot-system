import{f as l,H as h}from"./app-CL7EA87n.js";import{m as a}from"./makeAxiosFactory-DHy68HMT.js";const n="/bot-api/users",m=l("users",{state:()=>({items:[],self:null,loading:!1,error:null}),getters:{byId:t=>s=>t.items.find(i=>i.id===s)},actions:{setRole(t){this.self.role=t},async fetchSelf(){this.loading=!0,this.error=null;try{const{data:t}=await a(`${n}/self`,"POST");this.self=t}catch(t){this.error=(t==null?void 0:t.message)||"Failed to load agents"}finally{this.loading=!1}return!0},async fetchFiltered(t=1){var s,i;this.loading=!0,this.error=null;try{const e=new URLSearchParams;Object.entries(this.filters).forEach(([c,o])=>{o!=null&&o!==""&&o!==!1&&e.append(c,String(o))}),e.append("sort_field",this.sort.field),e.append("sort_direction",this.sort.direction),e.append("page",String(t));const{data:r}=await a(`${n}?${e.toString()}`,"GET");this.items=r.data,this.pagination=r}catch(e){this.error=((i=(s=e.response)==null?void 0:s.data)==null?void 0:i.message)??"Ошибка загрузки пользователей"}finally{this.loading=!1}},setFilters(t){this.filters=t},setSort(t,s){this.sort={field:t,direction:s}},async fetchAll(){this.loading=!0,this.error=null;try{const{data:t}=await a(`${n}`,"GET");this.items=t.data,console.log("data=>",t)}catch(t){this.error=(t==null?void 0:t.message)||"Failed to load users"}finally{this.loading=!1}},async fetchAllByPage(t=1){const{data:s}=await a(`${n}?page=${t}`,"GET");this.items=s.data,this.pagination=s},async fetchByUrl(t){const{data:s}=await a(t,"GET");this.items=s.data,this.pagination=s},async fetchOne(t){try{const{data:s}=await a(`${n}/${t}`,"GET");return s}catch(s){throw this.error=(s==null?void 0:s.message)||"Failed to load user",s}},async createPrimary(t){const{data:s}=await a(`${n}/primary`,"POST",t);return this.items.push(s),s},async create(t){const{data:s}=await a(`${n}`,"POST",t);return this.items.push(s),s},async update(t,s){const{data:i}=await a(`${n}/${t}`,"PUT",s),e=this.items.findIndex(r=>r.id===t);return e!==-1&&(this.items[e]=i),i},async selfRoleRequest(){await a(`${n}/request-role`,"GET")},async remove(t){await a(`${n}/${t}`,"DELETE"),this.items=this.items.filter(s=>s.id!==t)},async getTelegramLink(t){await a(`${n}/${t}/tg`,"GET")},async updateRole(t,s){const{data:i}=await a(`${n}/${t}/role`,"POST",{role:s}),e=this.items.findIndex(r=>r.id===t);return e!==-1&&(this.items[e]=i),i},async updatePercent(t,s){const{data:i}=await a(`${n}/${t}/percent`,"PATCH",{percent:s}),e=this.items.findIndex(r=>r.id===t);return e!==-1&&(this.items[e]=i),i},async updateWorkStatus(t,s){const i=h(),{data:e}=await a(`${n}/${t}/work-status`,"POST",{is_work:s});i.show("Статус успешно обновлен");const r=this.items.findIndex(c=>c.id===t);return r!==-1&&(this.items[r]=e),e},async block(t,s){const{data:i}=await a(`${n}/${t}/block`,"PATCH",{blocked_message:s}),e=this.items.findIndex(r=>r.id===t);return e!==-1&&(this.items[e]=i),i},async unblock(t){const{data:s}=await a(`${n}/${t}/unblock`,"PATCH"),i=this.items.findIndex(e=>e.id===t);return i!==-1&&(this.items[i]=s),s}}}),u=l("modal",{state:()=>({show:!1,message:"",onConfirm:null,onReject:null}),actions:{open(t,s,i){this.message=t,this.onConfirm=s,this.onReject=i,this.show=!0},close(){this.show=!1,this.message="",this.onConfirm=null,this.onReject=null},confirm(){this.onConfirm&&this.onConfirm(),this.close()},reject(){this.onReject&&this.onReject(),this.close()}}});export{u as a,m as u};
