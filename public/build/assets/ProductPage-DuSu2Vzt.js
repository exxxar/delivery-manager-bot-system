import{P as f,_ as k,a as $}from"./ProductList-CvT5sIKB.js";import{u as P}from"./baseExports-CZ3Lvsw_.js";import{u as M}from"./users-Cfl8QK4b.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as l,b as e,e as i,F as u,o as n,a as m,r as y,d as h,t as c,h as v,f as w,H as S,L as E}from"./app-CuqcIkQd.js";import{u as B,_ as x,P as j}from"./ProductCategoryList-DZMNLdrP.js";import{P as C}from"./Pagination-B42jjdvD.js";import{u as I}from"./SupplierList-EfTkapqO.js";import{B as U}from"./BackBtn-CC5-3KTy.js";import"./index-DuS1IyIQ.js";import"./makeAxiosFactory-DPBmHXy1.js";import"./useConfitmModalStore-CCtJZJJM.js";const D={data(){return{userStore:M(),jobStore:P()}},computed:{user(){return this.userStore.self||null}},methods:{selectMenu(o){this.$emit("select",o)},exportProducts(o){this.jobStore.exportProducts(o)}}},F={class:"btn-group-vertical w-100",role:"group","aria-label":"Вертикальное меню"},V={key:0,class:"dropdown mt-2"},z={class:"dropdown-menu w-100"},T=["disabled"],N=["disabled"],O=["disabled"];function W(o,t,s,a,r,d){var p,g;return n(),l(u,null,[e("div",F,[e("button",{type:"button",onClick:t[0]||(t[0]=b=>d.selectMenu("products")),class:"btn btn-outline-primary p-3"},"Общий список товаров "),e("button",{type:"button",onClick:t[1]||(t[1]=b=>d.selectMenu("products-by-supplier")),class:"btn btn-outline-primary p-3"},"Список товаров по поставщикам "),e("button",{type:"button",onClick:t[2]||(t[2]=b=>d.selectMenu("products-by-categories")),class:"btn btn-outline-primary p-3"},"Список товаров по категориям "),e("button",{type:"button",onClick:t[3]||(t[3]=b=>d.selectMenu("categories")),class:"btn btn-outline-primary p-3"},"Список категорий товаров "),(((p=d.user)==null?void 0:p.role)||0)>=3?(n(),l("button",{key:0,onClick:t[4]||(t[4]=b=>d.selectMenu("import-products")),type:"button",class:"btn btn-outline-primary p-3"},"Загрузить прайс с товарами и категориями ")):i("",!0)]),(((g=d.user)==null?void 0:g.role)||0)>=3?(n(),l("div",V,[t[8]||(t[8]=e("button",{class:"btn btn-outline-primary p-3 dropdown-toggle w-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Скачать таблицу с товарами ",-1)),e("ul",z,[e("li",null,[e("button",{type:"button",disabled:r.jobStore.loading,class:"dropdown-item",onClick:t[5]||(t[5]=b=>d.exportProducts(0))}," Список всех товаров ",8,T)]),e("li",null,[e("button",{type:"button",disabled:r.jobStore.loading,onClick:t[6]||(t[6]=b=>d.exportProducts(1)),class:"dropdown-item"}," Список по категориям ",8,N)]),e("li",null,[e("button",{type:"button",disabled:r.jobStore.loading,onClick:t[7]||(t[7]=b=>d.exportProducts(2)),class:"dropdown-item"}," Список по поставщикам ",8,O)])])])):i("",!0)],64)}const L=_(D,[["render",W]]),A={class:"card-header"},H={class:"mb-0"},q={class:"card-body"},G={key:0,class:"text-muted small"},J={key:1,class:"text-muted small"},K={class:"list-group list-group-flush"},Q=["onClick"],R={key:0,class:"badge bg-success mb-0"},X={key:2,class:"mt-3 text-center"},Y=["onClick"],Z={key:0,class:"alert alert-info mt-3"},tt={class:"modal fade",id:"viewProductModal",tabindex:"-1"},et={class:"modal-dialog modal-lg"},ot={class:"modal-content"},st={class:"modal-body"},nt={name:"Suppliers",components:{ProductCard:f},data(){return{supplierStore:I(),selectedProduct:null,pageMap:{}}},mounted(){this.fetchSuppliers()},methods:{async fetchDataByUrl(o){await this.supplierStore.fetchByUrl(o)},openView(o){this.selectedProduct=o,new bootstrap.Modal(document.getElementById("viewProductModal")).show()},async fetchSuppliers(){await this.supplierStore.fetchSupplierWithProducts()},async loadMore(o){this.pageMap[o]||(this.pageMap[o]=1),this.pageMap[o]++,await this.supplierStore.loadMoreSupplierProducts(o,this.pageMap[o])},closeEdit(){bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()},openEdit(o){this.$emit("edit-product",o),bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()}}},at=Object.assign(nt,{setup(o){return(t,s)=>(n(),l(u,null,[(n(!0),l(u,null,y(t.supplierStore.items,a=>{var r;return n(),l("div",{key:a.id,class:"card mb-2"},[e("div",A,[e("h6",H,c(a.name)+" ("+c(a.products_count||0)+"ед.)",1)]),e("div",q,[a.description?(n(),l("p",G,c(a.description),1)):i("",!0),a.address?(n(),l("p",J,c(a.address),1)):i("",!0),e("ul",K,[(n(!0),l(u,null,y(a.products,d=>{var p;return n(),l("li",{key:d.id,class:"list-group-item"},[e("p",{onClick:v(g=>t.openView(d),["prevent"]),class:"small text-primary mb-0"},c(d.name),9,Q),(p=d.category)!=null&&p.name?(n(),l("p",R,c(d.category.name||"-"),1)):i("",!0)])}),128))]),((r=a.products)==null?void 0:r.length)<a.products_count?(n(),l("div",X,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:d=>t.loadMore(a.id)}," Загрузить ещё ",8,Y)])):i("",!0)])])}),128)),m(C,{pagination:t.supplierStore.pagination,onPageChanged:t.fetchDataByUrl},null,8,["pagination","onPageChanged"]),t.supplierStore.items.length===0?(n(),l("div",Z," Товаров пока нет. ")):i("",!0),e("div",tt,[e("div",et,[e("div",ot,[s[0]||(s[0]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Карточка товара"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",st,[t.selectedProduct?(n(),h(f,{key:0,product:t.selectedProduct,onClose:t.closeEdit,onEdit:t.openEdit},null,8,["product","onClose","onEdit"])):i("",!0)])])])])],64))}}),dt={class:"card-header"},lt={class:"mb-0"},it={class:"card-body"},rt={key:0,class:"text-muted small"},ut={class:"list-group list-group-flush"},ct=["onClick"],pt={key:0,class:"badge bg-success mb-0"},mt={key:1,class:"mt-2 text-center"},bt=["onClick"],gt={key:0,class:"alert alert-info mt-3"},ht={class:"modal fade",id:"viewProductModal",tabindex:"-1"},yt={class:"modal-dialog modal-lg"},ft={class:"modal-content"},vt={class:"modal-body"},kt={name:"Categories",components:{ProductCard:f},data(){return{productCategoryStore:B(),selectedProduct:null,pageMap:{}}},mounted(){this.fetchProductsByCategory()},methods:{async fetchDataByUrl(o){await this.productCategoryStore.fetchByUrl(o)},async fetchProductsByCategory(){await this.productCategoryStore.fetchProductsByCategory()},openView(o){this.selectedProduct=o,new bootstrap.Modal(document.getElementById("viewProductModal")).show()},async loadMore(o){this.pageMap[o]||(this.pageMap[o]=1),this.pageMap[o]++,await this.productCategoryStore.loadMoreProductsInCategory(o,this.pageMap[o])},closeEdit(){bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()},openEdit(o){this.$emit("edit-product",o),bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()}}},Pt=Object.assign(kt,{setup(o){return(t,s)=>(n(),l(u,null,[(n(!0),l(u,null,y(t.productCategoryStore.items,a=>{var r;return n(),l("div",{key:a.id,class:"card mb-2"},[e("div",dt,[e("h6",lt,c(a.name)+" ("+c(a.products_count||0)+" ед.)",1)]),e("div",it,[a.description?(n(),l("p",rt,c(a.description),1)):i("",!0),e("ul",ut,[(n(!0),l(u,null,y(a.products,d=>{var p,g;return n(),l("li",{key:d.id,class:"list-group-item"},[e("p",{onClick:v(b=>t.openView(d),["prevent"]),class:"small mb-0"},c(d.name),9,ct),(p=d.supplier)!=null&&p.name?(n(),l("p",pt,c(((g=d.supplier)==null?void 0:g.name)||"-"),1)):i("",!0)])}),128))]),((r=a.products)==null?void 0:r.length)<a.products_count?(n(),l("div",mt,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:d=>t.loadMore(a.id)}," Загрузить ещё ",8,bt)])):i("",!0)])])}),128)),m(C,{pagination:t.productCategoryStore.pagination,onPageChanged:t.fetchDataByUrl},null,8,["pagination","onPageChanged"]),t.productCategoryStore.items.length===0?(n(),l("div",gt," Товаров пока нет. ")):i("",!0),e("div",ht,[e("div",yt,[e("div",ft,[s[0]||(s[0]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Карточка товара"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",vt,[t.selectedProduct?(n(),h(f,{key:0,product:t.selectedProduct,onClose:t.closeEdit,onEdit:t.openEdit},null,8,["product","onClose","onEdit"])):i("",!0)])])])])],64))}}),_t="/bot-api/imports",Ct=w("import",{state:()=>({uploading:!1,message:null,error:null}),actions:{async uploadProductWithCategoriesExcel(o){var s,a;this.uploading=!0,this.message=null,this.error=null;const t=S();t.show("Загрузка файла началась");try{const r=new FormData;r.append("excel",o);const{data:d}=await E.post(`${_t}/import-products-with-categories`,r,{headers:{"Content-Type":"multipart/form-data"}});this.message=d.message||"Файл успешно загружен",t.show(this.message,"success")}catch(r){const d=r;this.error=((a=(s=d.response)==null?void 0:s.data)==null?void 0:a.message)||"Ошибка при загрузке файла",t.show(this.error,"error")}finally{this.uploading=!1}}}}),$t={name:"ImportProducts",data(){return{file:null,jobStore:P(),store:Ct()}},methods:{onFileChange(o){this.file=o.target.files[0]},exportProducts(o){this.jobStore.exportProducts(o)},async handleUpload(){this.file&&await this.store.uploadProductWithCategoriesExcel(this.file)}}},Mt={class:"card mb-2"},wt={class:"card-body"},St={class:"mb-3"},Et=["disabled"],Bt={key:0,class:"alert alert-success mb-0"},xt={key:1,class:"alert alert-danger mb-0"},jt=["disabled"];function It(o,t,s,a,r,d){return n(),l(u,null,[t[4]||(t[4]=e("p",{class:"alert alert-info"}," При импорте товаров будут созданы также категории и поставщики, которых еще нет в системе. ",-1)),e("div",Mt,[t[3]||(t[3]=e("div",{class:"card-header bg-primary text-white"},[e("h6",{class:"mb-0"},"Импорт Excel-файла с продуктами")],-1)),e("div",wt,[e("form",{onSubmit:t[1]||(t[1]=v((...p)=>d.handleUpload&&d.handleUpload(...p),["prevent"]))},[e("div",St,[e("input",{type:"file",class:"form-control",onChange:t[0]||(t[0]=(...p)=>d.onFileChange&&d.onFileChange(...p)),accept:".xlsx,.xls"},null,32)]),e("button",{class:"btn btn-success w-100 p-3 mb-2",type:"submit",disabled:r.store.uploading||!r.file},c(r.store.uploading?"Загрузка...":"Загрузить"),9,Et)],32),r.store.message?(n(),l("div",Bt,c(r.store.message),1)):i("",!0),r.store.error?(n(),l("div",xt,c(r.store.error),1)):i("",!0)])]),e("button",{type:"button",disabled:r.jobStore.loading,class:"btn btn-outline-light text-primary w-100 p-3",onClick:t[2]||(t[2]=p=>d.exportProducts(0))}," Скачать пример ",8,jt)],64)}const Ut=_($t,[["render",It]]),Dt={class:"container-fluid p-3"},Ft={key:1,class:"alert alert-info"},Vt={class:"navbar fixed-bottom p-3"},zt={class:"modal fade",id:"createProductModal",tabindex:"-1"},Tt={class:"modal-dialog modal-lg"},Nt={class:"modal-content"},Ot={class:"modal-body"},Wt={class:"modal fade",id:"createCategoryModal",tabindex:"-1"},Lt={class:"modal-dialog"},At={class:"modal-content"},Ht={class:"modal-body"},qt={data(){return{loading:!1,selectedProduct:null,tab:"menu"}},mounted(){},methods:{openProductModal(){this.loading=!0,this.$nextTick(()=>{this.loading=!1,new bootstrap.Modal(document.getElementById("createProductModal")).show()})},selectMenu(o){this.tab=o},openEditProduct(o){this.selectMenu("product"),this.selectedProduct=o},fetchProducts(){const o=bootstrap.Modal.getInstance(document.getElementById("createProductModal"));o&&o.hide(),this.loading=!0,this.$nextTick(()=>{this.loading=!1})},fetchData(){const o=bootstrap.Modal.getInstance(document.getElementById("createCategoryModal"));o&&o.hide(),this.loading=!0,this.$nextTick(()=>{this.loading=!1})}}},ne=Object.assign(qt,{__name:"ProductPage",setup(o){return(t,s)=>(n(),l(u,null,[e("div",Dt,[t.tab==="menu"?(n(),l(u,{key:0},[m(U),m(L,{onSelect:t.selectMenu},null,8,["onSelect"])],64)):i("",!0),t.tab==="product"?(n(),l(u,{key:1},[e("button",{onClick:s[0]||(s[0]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),t.selectedProduct?(n(),h(k,{key:0,"initial-data":t.selectedProduct},null,8,["initial-data"])):(n(),l("p",Ft," Продукт не выбран "))],64)):i("",!0),t.tab==="products"?(n(),l(u,{key:2},[e("button",{onClick:s[1]||(s[1]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[7]||(s[7]=e("h4",{class:"mb-3"},"Список товаров",-1)),t.loading?i("",!0):(n(),h($,{key:0})),e("nav",Vt,[e("button",{type:"button",onClick:s[2]||(s[2]=(...a)=>t.openProductModal&&t.openProductModal(...a)),class:"btn w-100 p-3 btn-primary"}," Добавить товар ")])],64)):i("",!0),t.tab==="products-by-supplier"?(n(),l(u,{key:3},[e("button",{onClick:s[3]||(s[3]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[8]||(s[8]=e("h4",{class:"mb-3"},"Список товаров по поставщику",-1)),m(at,{onEditProduct:t.openEditProduct},null,8,["onEditProduct"])],64)):i("",!0),t.tab==="products-by-categories"?(n(),l(u,{key:4},[e("button",{onClick:s[4]||(s[4]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[9]||(s[9]=e("h4",{class:"mb-3"},"Список товаров по категориям",-1)),m(Pt,{onEditProduct:t.openEditProduct},null,8,["onEditProduct"])],64)):i("",!0),t.tab==="categories"?(n(),l(u,{key:5},[e("button",{onClick:s[5]||(s[5]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[10]||(s[10]=e("h4",{class:"mb-3"},"Категории товара",-1)),m(x),s[11]||(s[11]=e("nav",{class:"navbar fixed-bottom p-3"},[e("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#createCategoryModal",class:"btn w-100 p-3 btn-primary"}," Добавить категорию ")],-1))],64)):i("",!0),t.tab==="import-products"?(n(),l(u,{key:6},[e("button",{onClick:s[6]||(s[6]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),m(Ut)],64)):i("",!0)]),e("div",zt,[e("div",Tt,[e("div",Nt,[s[12]||(s[12]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Добавление товара"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",Ot,[t.loading?i("",!0):(n(),h(k,{key:0,onSaved:t.fetchProducts},null,8,["onSaved"]))])])])]),e("div",Wt,[e("div",Lt,[e("div",At,[s[13]||(s[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Создание новой категории товара"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",Ht,[m(j,{onSaved:t.fetchData},null,8,["onSaved"])])])])])],64))}});export{ne as default};
