import{c as l,o as a,b as s,t as h,i as b,w as p,v as y,h as g,L as C,f as E,a as v,e as u,F as c,r as q,d as k,k as w,J as S,E as V,H as N}from"./app-inwx_hyd.js";import{a as T}from"./ReportGenerator-CZvf0qvX.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as O}from"./Pagination-CGZz5MhN.js";import{m as d}from"./makeAxiosFactory-BnGsf8sy.js";import{_ as P}from"./SupplierList-DSpFfC2D.js";import{a as F,s as B,c as j}from"./ProductList-DussKdy5.js";import{u as A}from"./useConfitmModalStore-l3FymIkY.js";const M={name:"CustomerCard",props:{customer:{type:Object,required:!0}}},L={class:"container-fluid p-3"},I={class:"card shadow-sm"},G={class:"card-header bg-primary text-white"},z={class:"mb-0"},J={class:"card-body"},R={class:"list-group list-group-flush"},H={class:"list-group-item"},K={class:"list-group-item"},Q={class:"list-group-item"},W={class:"list-group-item"},X={class:"card-footer text-end"};function Y(o,t,e,n,i,r){return a(),l("div",L,[s("div",I,[s("div",G,[s("h5",z,h(e.customer.name),1)]),s("div",J,[s("ul",R,[s("li",H,[t[2]||(t[2]=s("strong",null,"Компания:",-1)),b(" "+h(e.customer.company_name),1)]),s("li",K,[t[3]||(t[3]=s("strong",null,"Адрес:",-1)),b(" "+h(e.customer.address),1)]),s("li",Q,[t[4]||(t[4]=s("strong",null,"Телефон:",-1)),b(" "+h(e.customer.phone),1)]),s("li",W,[t[5]||(t[5]=s("strong",null,"Email:",-1)),b(" "+h(e.customer.email),1)])])]),s("div",X,[s("button",{class:"btn btn-outline-secondary me-2",onClick:t[0]||(t[0]=m=>o.$emit("close"))},"Закрыть"),s("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=m=>o.$emit("edit",e.customer))},"Редактировать")])])])}const Z=D(M,[["render",Y]]),x={name:"CustomerForm",props:{initialData:{type:Object,default:null}},data(){return{form:{name:"",company_name:"",address:"",phone:"",email:""},isEdit:!1}},created(){this.initialData&&(this.form={...this.initialData},this.isEdit=!0)},methods:{async submitForm(){try{this.isEdit?(await C.put(`/api/customers/${this.form.id}`,this.form),alert("Клиент обновлён!")):(await C.post("/api/customers",this.form),alert("Клиент добавлен!")),this.$emit("saved")}catch(o){console.error("Ошибка сохранения клиента:",o)}}}},tt={class:"container-fluid p-3"},et={class:"form-floating mb-3"},st={class:"form-floating mb-3"},ot={class:"form-floating mb-3"},it={class:"form-floating mb-3"},at={class:"form-floating mb-3"},nt={type:"submit",class:"btn btn-primary w-100"};function lt(o,t,e,n,i,r){return a(),l("div",tt,[s("form",{onSubmit:t[5]||(t[5]=g((...m)=>r.submitForm&&r.submitForm(...m),["prevent"]))},[s("div",et,[p(s("input",{"onUpdate:modelValue":t[0]||(t[0]=m=>i.form.name=m),type:"text",class:"form-control",id:"name",placeholder:"Имя",required:""},null,512),[[y,i.form.name]]),t[6]||(t[6]=s("label",{for:"name"},"Имя",-1))]),s("div",st,[p(s("input",{"onUpdate:modelValue":t[1]||(t[1]=m=>i.form.company_name=m),type:"text",class:"form-control",id:"company_name",placeholder:"Компания",required:""},null,512),[[y,i.form.company_name]]),t[7]||(t[7]=s("label",{for:"company_name"},"Компания",-1))]),s("div",ot,[p(s("input",{"onUpdate:modelValue":t[2]||(t[2]=m=>i.form.address=m),type:"text",class:"form-control",id:"address",placeholder:"Адрес",required:""},null,512),[[y,i.form.address]]),t[8]||(t[8]=s("label",{for:"address"},"Адрес",-1))]),s("div",it,[p(s("input",{"onUpdate:modelValue":t[3]||(t[3]=m=>i.form.phone=m),type:"tel",class:"form-control",id:"phone",placeholder:"Телефон",required:""},null,512),[[y,i.form.phone]]),t[9]||(t[9]=s("label",{for:"phone"},"Телефон",-1))]),s("div",at,[p(s("input",{"onUpdate:modelValue":t[4]||(t[4]=m=>i.form.email=m),type:"email",class:"form-control",id:"email",placeholder:"Email",required:""},null,512),[[y,i.form.email]]),t[10]||(t[10]=s("label",{for:"email"},"Email",-1))]),s("button",nt,h(i.isEdit?"Сохранить изменения":"Добавить клиента"),1)],32)])}const rt=D(x,[["render",lt]]),_="/bot-api/customers",dt=E("customers",{state:()=>({items:[],loading:!1,error:null}),getters:{byId:o=>t=>o.items.find(e=>e.id===t)},actions:{async fetchAll(){this.loading=!0,this.error=null;try{const{data:o}=await d(`${_}`,"GET");this.items=o}catch(o){this.error=(o==null?void 0:o.message)||"Failed to load customers"}finally{this.loading=!1}},async fetchAllByPage(o=1){const{data:t}=await d(`${_}?page=${o}`,"GET");this.items=t.data,this.pagination=t},async fetchByUrl(o){const{data:t}=await d(o,"GET");this.items=t.data,this.pagination=t},async create(o){const{data:t}=await d(_,"POST",o);return this.items.push(t),t},async update(o,t){const{data:e}=await d(_,"PUT",t),n=this.items.findIndex(i=>i.id===o);return n!==-1&&(this.items[n]=e),e},async remove(o){await d(`${_}/${o}`,"DELETE"),this.items=this.items.filter(t=>t.id!==o)}}}),mt={class:"form-floating mb-3"},pt={class:"list-group"},ut=["onClick"],ft={class:"fw-bold"},ct={class:"text-muted"},yt={class:"dropdown"},ht={class:"dropdown-menu dropdown-menu-end"},bt={key:0},gt=["onClick"],_t=["onClick"],vt=["onClick"],wt=["onClick"],$t={key:0,class:"alert alert-info mt-3"},Ct={class:"modal fade",id:"editCustomerModal",tabindex:"-1"},kt={class:"modal-dialog modal-lg"},St={class:"modal-content"},Et={class:"modal-body"},Tt={class:"modal fade",id:"deleteCustomerModal",tabindex:"-1"},Dt={class:"modal-dialog"},Pt={class:"modal-content"},Ft={class:"modal-body"},Ut={class:"modal-footer"},qt={class:"modal fade",id:"viewCustomerModal",tabindex:"-1"},Vt={class:"modal-dialog"},Nt={class:"modal-content"},Ot={class:"modal-body"},Bt={name:"CustomerList",props:["forSelect"],data(){return{search:null,customerStore:dt(),selectedCustomer:null}},computed:{filteredCustomers(){if(!this.search)return this.customerStore.items||[];const o=this.search.toLowerCase();return this.customerStore.items.filter(t=>Object.values(t).some(e=>e?String(e).toLowerCase().includes(o):!1))}},created(){this.fetchData()},methods:{selectCustomer(o){this.forSelect&&this.$emit("select",o)},async fetchData(o=1){await this.customerStore.fetchAllByPage(o)},async fetchDataByUrl(o){await this.customerStore.fetchByUrl(o)},openEdit(o){this.selectedCustomer=o,new bootstrap.Modal(document.getElementById("editCustomerModal")).show()},confirmDelete(o){this.selectedCustomer=o,new bootstrap.Modal(document.getElementById("deleteCustomerModal")).show()},async deleteCustomer(){try{await C.delete(`/api/customers/${this.selectedCustomer.id}`),this.customers=this.customers.filter(o=>o.id!==this.selectedCustomer.id),bootstrap.Modal.getInstance(document.getElementById("deleteCustomerModal")).hide()}catch(o){console.error("Ошибка удаления клиента:",o)}},openView(o){this.selectedCustomer=o,new bootstrap.Modal(document.getElementById("viewCustomerModal")).show()}}},U=Object.assign(Bt,{setup(o){return(t,e)=>{var n;return a(),l(c,null,[s("div",mt,[p(s("input",{type:"search","onUpdate:modelValue":e[0]||(e[0]=i=>t.search=i),class:"form-control",id:"searchInput",placeholder:"Поиск..."},null,512),[[y,t.search]]),e[2]||(e[2]=s("label",{for:"searchInput"},"Поиск",-1))]),s("ul",pt,[(a(!0),l(c,null,q(t.filteredCustomers,i=>(a(),l("li",{onClick:r=>t.selectCustomer(i),key:i.id,class:"list-group-item d-flex justify-content-between align-items-center"},[s("div",null,[s("div",ft,h(i.name),1),s("small",ct,h(i.company_name),1)]),s("div",yt,[e[3]||(e[3]=s("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[s("i",{class:"fas fa-bars"})],-1)),s("ul",ht,[o.forSelect?(a(),l("li",bt,[s("a",{class:"dropdown-item",href:"#",onClick:g(r=>t.selectCustomer(i),["prevent"])},"Выбрать клиента",8,gt)])):(a(),l(c,{key:1},[s("li",null,[s("a",{class:"dropdown-item",href:"#",onClick:g(r=>t.openEdit(i),["prevent"])},"Редактировать",8,_t)]),s("li",null,[s("a",{class:"dropdown-item text-danger",href:"#",onClick:g(r=>t.confirmDelete(i),["prevent"])},"Удалить",8,vt)]),s("li",null,[s("a",{class:"dropdown-item",href:"#",onClick:g(r=>t.openView(i),["prevent"])},"Просмотреть",8,wt)])],64))])])],8,ut))),128))]),v(O,{pagination:t.customerStore.pagination,onPageChanged:t.fetchDataByUrl},null,8,["pagination","onPageChanged"]),t.customerStore.items.length===0?(a(),l("div",$t," Клиентов пока нет. ")):u("",!0),s("div",Ct,[s("div",kt,[s("div",St,[e[4]||(e[4]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Редактирование клиента"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),s("div",Et,[t.selectedCustomer?(a(),k(rt,{key:0,initialData:t.selectedCustomer,onSaved:t.fetchCustomers},null,8,["initialData","onSaved"])):u("",!0)])])])]),s("div",Tt,[s("div",Dt,[s("div",Pt,[e[8]||(e[8]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title text-danger"},"Удаление клиента"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),s("div",Ft,[e[5]||(e[5]=b(" Вы уверены, что хотите удалить ",-1)),s("strong",null,h((n=t.selectedCustomer)==null?void 0:n.name),1),e[6]||(e[6]=b("? ",-1))]),s("div",Ut,[e[7]||(e[7]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),s("button",{type:"button",class:"btn btn-danger",onClick:e[1]||(e[1]=(...i)=>t.deleteCustomer&&t.deleteCustomer(...i))},"Удалить")])])])]),s("div",qt,[s("div",Vt,[s("div",Nt,[e[9]||(e[9]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Карточка клиента"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),s("div",Ot,[t.selectedCustomer?(a(),k(Z,{key:0,customer:t.selectedCustomer,onEdit:t.openEdit},null,8,["customer","onEdit"])):u("",!0)])])])])],64)}}}),f="/bot-api/sales",jt=E("sales",{state:()=>({items:[],loading:!1,filters:null,progress:0,error:null,sort:{field:"id",direction:"desc"}}),getters:{byId:o=>t=>o.items.find(e=>e.id===t)},actions:{async fetchAll(){this.loading=!0,this.error=null;try{const{data:o}=await d(`${f}`,"GET");this.items=o}catch(o){this.error=(o==null?void 0:o.message)||"Failed to load sales"}finally{this.loading=!1}},async acceptAll(o){await d(`${f}/accept-all`,"POST",{ids:o})},async selfSalesFiltered(o=1,t=30){const e=new URLSearchParams;Object.entries(this.filters).forEach(([i,r])=>{r!=null&&r!==""&&e.append(i,String(r))}),e.append("sort_field",this.sort.field),e.append("sort_direction",this.sort.direction),e.append("page",String(o)),e.append("size",String(t));const{data:n}=await d(`${f}/self-sales?${e.toString()}`,"GET");return this.items=n.data,this.pagination=n,!0},async fetchFiltered(o=1,t=30){const e=new URLSearchParams;Object.entries(this.filters).forEach(([i,r])=>{r!=null&&r!==""&&e.append(i,String(r))}),e.append("sort_field",this.sort.field),e.append("sort_direction",this.sort.direction),e.append("page",String(o)),e.append("size",String(t));const{data:n}=await d(`${f}?${e.toString()}`,"GET");return this.items=n.data,this.pagination=n,!0},setFilters(o){this.filters=o},setSort(o,t){this.sort={field:o,direction:t}},async fetchAllByPage(o=1){const{data:t}=await d(`${f}?page=${o}`,"GET");this.items=t.data,this.pagination=t},async fetchByUrl(o){const{data:t}=await d(o,"GET");this.items=t.data,this.pagination=t},async sendPaymentDocumentToTg(o){try{const{data:t}=await d(`${f}/payment-document/${o}`,"GET");return!0}catch(t){throw this.error=(t==null?void 0:t.message)||"Failed to load sale",t}},async fetchOne(o){try{const{data:t}=await d(`${f}/${o}`,"GET");return t}catch(t){throw this.error=(t==null?void 0:t.message)||"Failed to load sale",t}},async create(o,t){const e=new FormData;Object.keys(o).forEach(i=>{const r=o[i]||"";typeof r=="object"?e.append(i,JSON.stringify(r)):e.append(i,r)}),t&&e.append("file",t);const{data:n}=await d(`${f}`,"POST",e,{headers:{"Content-Type":"multipart/form-data"}});return this.items.push(n),n},async update(o,t,e){const n=new FormData;Object.keys(t).forEach(m=>{const $=t[m]||"";typeof $=="object"?n.append(m,JSON.stringify($)):n.append(m,$)}),e&&n.append("file",e);const{data:i}=await d(`${f}/${o}`,"POST",n,{headers:{"Content-Type":"multipart/form-data"}}),r=this.items.findIndex(m=>m.id===o);return r!==-1&&(this.items[r]=i),i},async confirmDealAndPayment(o){var t;try{const e=new FormData;e.append("id",o.id||null),e.append("payment_type",o.payment_type||0),e.append("sale_date",o.sale_date||""),e.append("actual_delivery_date",o.actual_delivery_date||""),e.append("quantity",o.quantity||1),e.append("total_price",o.total_price),e.append("receipt_is_lost",o.receipt_is_lost||!1),e.append("same_sale_delivery_date",o.same_sale_delivery_date||!1),e.append("additional_comment",o.additional_comment||""),e.append("need_additional_comment",o.need_additional_comment||!1),e.append("status","completed"),this.progress=0,(o.files||[]).length>0&&o.files.forEach((i,r)=>{e.append(`files[${r}]`,i)});const{data:n}=await d(`${f}/confirm-deal-payment`,"POST",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:i=>{i.total&&(this.progress=Math.round(i.loaded*100/i.total))}});return await this.fetchAllByPage(((t=this.pagination)==null?void 0:t.current_page)||1),n}catch(e){throw e}},async confirmPayment(o){var t;try{const e=new FormData;e.append("id",o.id||null),e.append("payment_type",o.payment_type||0),e.append("receipt_is_lost",o.receipt_is_lost||!1),o.file&&e.append("file",o.file);const{data:n}=await d(`${f}/confirm-payment`,"POST",e,{headers:{"Content-Type":"multipart/form-data"}});return await this.fetchAllByPage(((t=this.pagination)==null?void 0:t.current_page)||1),n}catch(e){throw e}},async confirmDeal(o){var t;try{const{data:e}=await d(`${f}/confirm-deal`,"POST",{...o,status:"completed"});return await this.fetchAllByPage(((t=this.pagination)==null?void 0:t.current_page)||1),e}catch(e){throw console.error("Ошибка подтверждения сделки:",e),e}},async deleteSale(o){try{return await d(`${f}/${o}`,"DELETE"),this.items=this.items.filter(t=>t.id!==o),!0}catch(t){throw console.error("Ошибка удаления продажи:",t),t}},async cancelDeal(o){var t;try{const{data:e}=await d(`${f}/${o.id}`,"PUT",{...o,status:"rejected"});return await this.fetchAllByPage(((t=this.pagination)==null?void 0:t.current_page)||1),e}catch(e){throw console.error("Ошибка отмены сделки:",e),e}}}}),At={class:"form-check form-switch mb-2"},Mt={class:"form-check-label",for:"need_automatic_naming"},Lt={key:0,class:"fw-bold text-primary"},It={key:1,class:"fw-bold text-primary"},Gt={class:"form-floating mb-2"},zt={class:"form-floating mb-2"},Jt={class:"input-group mb-2"},Rt={class:"form-floating flex-grow-1"},Ht=["value"],Kt={class:"input-group mb-2"},Qt={class:"form-floating flex-grow-1"},Wt=["value"],Xt=["disabled"],Yt={class:"form-floating mb-2"},Zt={class:"form-floating mb-2"},xt={class:"form-floating mb-2"},te={class:"form-floating mb-2"},ee=["required"],se={class:"form-check form-switch mb-2"},oe={key:3,class:"form-floating mb-2"},ie={class:"form-floating mb-2"},ae={class:"form-check form-switch mb-2"},ne={class:"form-floating mb-2"},le={class:"form-floating mb-2"},re={class:"input-group mb-2"},de={class:"form-floating flex-grow-1"},me=["value"],pe={key:6,class:"form-check form-switch mb-2"},ue=["disabled"],fe={key:0},ce={key:1},ye={name:"SaleForm",components:{AgentList:T,CustomerList:U,SupplierListGroup:P,ProductList:F},props:{initialData:{type:Object,default:null}},watch:{"form.quantity":function(o,t){this.form.total_price===0&&(this.form.total_price=(this.product.price*this.form.quantity).toFixed(2))}},computed:{user(){return this.userStore.self||null},productName(){var o;return((o=this.product)==null?void 0:o.name)||""}},data(){return{display_more_dates:!1,tab:"main",spent_time:0,alertStore:N(),salesStore:jt(),userStore:A(),can_add_past_assignments:!1,file:null,product_filters:{supplier_id:null},form:{title:"",description:"",status:"pending",due_date:"",actual_delivery_date:"",sale_date:"",quantity:0,total_price:0,agent_id:null,customer_id:null,supplier_id:null,product_id:null,payment_type:"0",payment_document_name:null,need_automatic_naming:!0,receipt_is_lost:!1,is_already_delivered:!1},agentName:"",customerName:"",supplierName:"",product:null,isEdit:!1}},created(){var o,t,e;this.initialData&&(this.form={...this.initialData},this.form.need_automatic_naming=!0,this.form.payment_type=""+this.form.payment_type,this.isEdit=!0,this.agentName=((o=this.initialData.agent)==null?void 0:o.name)||"",this.customerName=((t=this.initialData.customer)==null?void 0:t.name)||"",this.supplierName=((e=this.initialData.supplier)==null?void 0:e.name)||"",this.product=this.initialData.product||null)},mounted(){j(),window.addEventListener("trigger-spent-timer",o=>{this.spent_time=o.detail})},methods:{async sendPaymentDocumentToTg(){await this.salesStore.sendPaymentDocumentToTg(this.form.id).then(()=>{this.alertStore.show("Чек отправлен вам в телеграм бот!")})},onFileChange(o){this.file=o.target.files[0]},selectAgent(o){this.form.agent_id=o.id,this.agentName=o.name,this.tab="main"},selectCustomer(o){this.form.customer_id=o.id,this.customerName=o.name,this.tab="main"},selectSupplier(o){const t=this.form.supplier_id;this.form.supplier_id=null,this.supplierName=null,this.product_filters.supplier_id=null,t!==o.id&&(this.form.product_id=null,this.product=null),this.$nextTick(()=>{this.form.supplier_id=o.id,this.supplierName=o.name,this.tab="main",this.product_filters.supplier_id=o.id})},selectProduct(o){this.form.product_id=o.id,this.product=o,this.tab="main",this.form.quantity=1,this.form.total_price=o.price||0},async submitForm(){this.alertStore.show("Началось добавление заявки"),B(10),this.isEdit?await this.salesStore.update(this.form.id,this.form,this.file):await this.salesStore.create(this.form,this.file),this.$emit("saved")}}},ke=Object.assign(ye,{setup(o){return new Date().toISOString().split("T")[0],(t,e)=>{var n;return a(),l("form",{onSubmit:e[23]||(e[23]=g((...i)=>t.submitForm&&t.submitForm(...i),["prevent"]))},[t.tab==="main"?(a(),l(c,{key:0},[s("div",At,[p(s("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>t.form.need_automatic_naming=i),class:"form-check-input",type:"checkbox",role:"switch",id:"need_automatic_naming"},null,512),[[w,t.form.need_automatic_naming]]),s("label",Mt,[e[24]||(e[24]=b("Автоматическое название и описание ",-1)),t.form.need_automatic_naming?(a(),l("span",Lt,"включено")):(a(),l("span",It,"выключено"))])]),t.form.need_automatic_naming?u("",!0):(a(),l(c,{key:0},[s("div",Gt,[p(s("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>t.form.title=i),type:"text",class:"form-control",id:"title",placeholder:"Название",required:""},null,512),[[y,t.form.title]]),e[25]||(e[25]=s("label",{for:"title"},"Название задания",-1))]),s("div",zt,[p(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=i=>t.form.description=i),class:"form-control",id:"description",placeholder:"Описание",style:{height:"120px"},required:""},null,512),[[y,t.form.description]]),e[26]||(e[26]=s("label",{for:"description"},"Описание задания",-1))])],64)),s("div",Jt,[s("div",Rt,[s("input",{required:"",type:"text",class:"form-control",id:"supplier",value:t.supplierName,placeholder:"Поставщик",readonly:""},null,8,Ht),e[27]||(e[27]=s("label",{for:"supplier"},"Поставщик",-1))]),s("button",{type:"button",class:"btn btn-outline-light text-primary find-btn",onClick:e[3]||(e[3]=i=>t.tab="supplier")}," Выбрать ")]),s("div",Kt,[s("div",Qt,[s("input",{type:"text",required:"",class:"form-control",id:"product",value:t.productName,placeholder:"Продукт",readonly:""},null,8,Wt),e[28]||(e[28]=s("label",{for:"product"},"Продукт",-1))]),s("button",{type:"button",disabled:t.form.supplier_id==null,class:"btn btn-outline-light text-primary find-btn",onClick:e[4]||(e[4]=i=>t.tab="product")},"Выбрать ",8,Xt)]),t.form.supplier_id&&t.form.product_id?(a(),l(c,{key:1},[s("div",Yt,[p(s("input",{required:"","onUpdate:modelValue":e[5]||(e[5]=i=>t.form.quantity=i),type:"number",class:"form-control",id:"quantity",placeholder:"Количество"},null,512),[[y,t.form.quantity]]),e[29]||(e[29]=s("label",{for:"quantity"},"Количество",-1))]),s("div",Zt,[p(s("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>t.form.total_price=i),required:"",type:"number",step:"0.01",class:"form-control",id:"total_price",placeholder:"Сумма"},null,512),[[y,t.form.total_price]]),e[30]||(e[30]=s("label",{for:"total_price"},"Сумма сделки",-1))])],64)):u("",!0),s("div",xt,[p(s("select",{class:"form-select","onUpdate:modelValue":e[7]||(e[7]=i=>t.form.payment_type=i),id:"payment-type","aria-label":"Floating label select example"},[...e[31]||(e[31]=[s("option",{value:"0"},"Наличный расчет",-1),s("option",{value:"1"},"Безналичный расчет",-1)])],512),[[S,t.form.payment_type]]),e[32]||(e[32]=s("label",{for:"payment-type"},"Тип оплаты",-1))]),t.form.payment_type==="1"?(a(),l(c,{key:2},[e[36]||(e[36]=s("h6",null,"Фотография чека",-1)),t.form.payment_document_name?(a(),l("span",{key:0,onClick:e[8]||(e[8]=(...i)=>t.sendPaymentDocumentToTg&&t.sendPaymentDocumentToTg(...i)),style:{cursor:"pointer","text-align":"left"},class:"mb-2 w-100 badge bg-success text-decoration-underline"},[...e[33]||(e[33]=[s("i",{style:{"margin-right":"5px"},class:"fa-brands fa-telegram"},null,-1),b(" Чек прикреплен к сделке. ",-1)])])):u("",!0),s("div",te,[t.form.payment_document_name?(a(),l("input",{key:0,type:"file",class:"form-control",onChange:e[9]||(e[9]=(...i)=>t.onFileChange&&t.onFileChange(...i)),accept:".jpg,.png,.pdf"},null,32)):(a(),l("input",{key:1,type:"file",class:"form-control",onChange:e[10]||(e[10]=(...i)=>t.onFileChange&&t.onFileChange(...i)),accept:".jpg,.png,.pdf",required:!t.form.receipt_is_lost},null,40,ee)),e[34]||(e[34]=s("label",{for:"payment-type"},"Прикрепить",-1))]),s("div",se,[p(s("input",{"onUpdate:modelValue":e[11]||(e[11]=i=>t.form.receipt_is_lost=i),class:"form-check-input",type:"checkbox",role:"switch",id:"need_automatic_naming"},null,512),[[w,t.form.receipt_is_lost]]),e[35]||(e[35]=s("label",{class:"form-check-label",for:"need_automatic_naming"},"Чек был утрачен или еще не оплачено ",-1))])],64)):u("",!0),t.isEdit?(a(),l("div",oe,[p(s("select",{"onUpdate:modelValue":e[12]||(e[12]=i=>t.form.status=i),class:"form-select",id:"status",required:""},[...e[37]||(e[37]=[V('<option value="pending">Ожидает</option><option value="assigned">Назначено</option><option value="delivered">Доставляется</option><option value="completed">Завершено</option><option value="rejected">Отклонено</option>',5)])],512),[[S,t.form.status]]),e[38]||(e[38]=s("label",{for:"status"},"Статус",-1))])):u("",!0),s("div",ie,[p(s("input",{"onUpdate:modelValue":e[13]||(e[13]=i=>t.form.due_date=i),required:"",type:"date",class:"form-control",id:"due_date"},null,512),[[y,t.form.due_date]]),e[39]||(e[39]=s("label",{for:"due_date"},"Дата задания",-1))]),s("div",ae,[p(s("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[14]||(e[14]=i=>t.display_more_dates=i),id:"display_more_dates"},null,512),[[w,t.display_more_dates]]),e[40]||(e[40]=s("label",{class:"form-check-label",for:"display_more_dates"}," Отображать больше параметров ",-1))]),t.display_more_dates?(a(),l(c,{key:4},[s("div",ne,[p(s("input",{required:"","onUpdate:modelValue":e[15]||(e[15]=i=>t.form.sale_date=i),type:"date",class:"form-control",id:"sale_date"},null,512),[[y,t.form.sale_date]]),e[41]||(e[41]=s("label",{for:"sale_date"},"Дата оплаты",-1))]),s("div",le,[p(s("input",{required:"","onUpdate:modelValue":e[16]||(e[16]=i=>t.form.actual_delivery_date=i),type:"date",class:"form-control",id:"actual_delivery_date"},null,512),[[y,t.form.actual_delivery_date]]),e[42]||(e[42]=s("label",{for:"actual_delivery_date"},"Фактическая дата доставки",-1))])],64)):u("",!0),((n=t.user)==null?void 0:n.role)>=3?(a(),l(c,{key:5},[e[44]||(e[44]=s("p",{class:"alert alert-info mb-2"},"Назначение ответственного по данной задаче",-1)),s("div",re,[s("div",de,[s("input",{type:"text",class:"form-control",id:"agent",value:t.agentName,placeholder:"Младший администратор",readonly:""},null,8,me),e[43]||(e[43]=s("label",{for:"agent"},"Администратор",-1))]),s("button",{type:"button",class:"btn btn-outline-light text-primary find-btn",onClick:e[17]||(e[17]=i=>t.tab="agent")}," Выбрать ")])],64)):u("",!0),t.isEdit?u("",!0):(a(),l("div",pe,[p(s("input",{"onUpdate:modelValue":e[18]||(e[18]=i=>t.form.is_already_delivered=i),class:"form-check-input",type:"checkbox",role:"switch",id:"is_already_delivered"},null,512),[[w,t.form.is_already_delivered]]),e[45]||(e[45]=s("label",{class:"form-check-label",for:"is_already_delivered"},"Товар уже доставлен ",-1))])),s("button",{disabled:t.spent_time>0,type:"submit",class:"btn btn-primary w-100 p-3"},[t.spent_time>0?(a(),l("span",fe,h(t.spent_time)+" сек.",1)):(a(),l("span",ce,h(t.isEdit?"Сохранить изменения":"Создать задание"),1))],8,ue)],64)):u("",!0),t.tab==="agent"?(a(),l(c,{key:1},[s("button",{onClick:e[19]||(e[19]=i=>t.tab="main"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"0px","z-index":"100"}},"Назад "),v(T,{"for-select":!0,onSelect:t.selectAgent},null,8,["onSelect"])],64)):u("",!0),t.tab==="customer"?(a(),l(c,{key:2},[s("button",{onClick:e[20]||(e[20]=i=>t.tab="main"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"0px","z-index":"100"}},"Назад "),v(U,{"for-select":!0,onSelect:t.selectCustomer},null,8,["onSelect"])],64)):u("",!0),t.tab==="supplier"?(a(),l(c,{key:3},[s("button",{onClick:e[21]||(e[21]=i=>t.tab="main"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"0px","z-index":"100"}},"Назад "),v(P,{"for-select":!0,onSelect:t.selectSupplier},null,8,["onSelect"])],64)):u("",!0),t.tab==="product"?(a(),l(c,{key:4},[s("button",{onClick:e[22]||(e[22]=i=>t.tab="main"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"0px","z-index":"100"}},"Назад "),v(F,{"for-select":!0,filters:t.product_filters,onSelect:t.selectProduct},null,8,["filters","onSelect"])],64)):u("",!0)],32)}}});export{ke as _,U as a,jt as u};
