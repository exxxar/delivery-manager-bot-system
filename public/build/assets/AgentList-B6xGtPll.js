import{c as a,o as i,b as t,e as r,i as m,t as g,F as p,w as u,v as f,h,f as _,k,a as w,r as D,d as v}from"./app-0l_Rbhps.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as E}from"./Pagination-Ca3A3Wtp.js";import{U as I}from"./UserForm-DGT9uAUO.js";import{u as C}from"./baseExports-ePWwj_Fw.js";import"./index-DGTR43rF.js";import{_ as M}from"./AdminList-DarSUQyT.js";import{m as c}from"./makeAxiosFactory-DkVpsmdd.js";const U={name:"AgentInfo",props:{agent:{type:Object,required:!0}}},B={class:"list-group list-group-flush"},P={class:"list-group-item"},V={class:"list-group-item"},T={class:"list-group-item"},F={class:"list-group-item"},L={class:"list-group-item"},R={key:0,class:"list-group-item"};function G(s,e,o,n,l,y){var d;return i(),a(p,null,[t("ul",B,[t("li",P,[e[1]||(e[1]=t("strong",null,"ID:",-1)),m(" "+g(o.agent.id),1)]),t("li",V,[e[2]||(e[2]=t("strong",null,"Имя:",-1)),m(" "+g(o.agent.name),1)]),t("li",T,[e[3]||(e[3]=t("strong",null,"Телефон:",-1)),m(" "+g(o.agent.phone),1)]),t("li",F,[e[4]||(e[4]=t("strong",null,"Email:",-1)),m(" "+g(o.agent.email),1)]),t("li",L,[e[5]||(e[5]=t("strong",null,"Регион:",-1)),m(" "+g(o.agent.region),1)]),o.agent.in_learning?(i(),a("li",R,[e[6]||(e[6]=t("strong",null,"Обучается у: ",-1)),o.agent.mentor?(i(),a(p,{key:0},[m(g(((d=o.agent.mentor)==null?void 0:d.name)||"-"),1)],64)):(i(),a(p,{key:1},[m(" Наставник не указан ")],64))])):r("",!0)]),t("button",{class:"btn btn-primary p-3 w-100",onClick:e[0]||(e[0]=Ht=>s.$emit("edit",o.agent))},"Редактировать")],64)}const N=A(U,[["render",G]]),O={name:"ReportIndividualGenerator",props:["agentId"],data(){return{reportStore:C(),report:{startDate:"",endDate:""}}},methods:{generateReport(){const s={...this.report,id:this.agentId};this.reportStore.exportIndividual(s),this.$emit("generate-report",s)}}},j={class:"form-floating mb-2"},q={class:"form-floating mb-2"},z=["disabled"];function W(s,e,o,n,l,y){return i(),a("form",{onSubmit:e[2]||(e[2]=h((...d)=>y.generateReport&&y.generateReport(...d),["prevent"]))},[t("div",j,[u(t("input",{type:"date",class:"form-control",id:"startDate","onUpdate:modelValue":e[0]||(e[0]=d=>l.report.startDate=d),required:""},null,512),[[f,l.report.startDate]]),e[3]||(e[3]=t("label",{for:"startDate"},"Дата начала периода",-1))]),t("div",q,[u(t("input",{type:"date",class:"form-control",id:"endDate","onUpdate:modelValue":e[1]||(e[1]=d=>l.report.endDate=d),required:""},null,512),[[f,l.report.endDate]]),e[4]||(e[4]=t("label",{for:"endDate"},"Дата окончания периода",-1))]),t("button",{disabled:l.report.loading,type:"submit",class:"btn btn-primary p-3 w-100"}," Сформировать отчёт ",8,z)],32)}const H=A(O,[["render",W]]),b="/bot-api/agents",$=_("agents",{state:()=>({items:[],loading:!1,error:null}),getters:{byId:s=>e=>s.items.find(o=>o.id===e)},actions:{async fetchAll(){this.loading=!0,this.error=null;try{const{data:s}=await c(`${b}`,"GET");this.items=s}catch(s){this.error=(s==null?void 0:s.message)||"Failed to load agents"}finally{this.loading=!1}},async fetchAllByPage(s=1){const{data:e}=await c(`${b}?page=${s}`,"GET");this.items=e.data,this.pagination=e},async fetchByUrl(s){const{data:e}=await c(s,"GET");this.items=e.data,this.pagination=e},async fetchOne(s){try{const{data:e}=await c(`${b}/${s}`,"GET");return e}catch(e){throw this.error=(e==null?void 0:e.message)||"Failed to load agent",e}},async create(s){const{data:e}=await c(`${b}`,"POST",s);return this.items.push(e),e},async update(s,e){const{data:o}=await c(`${b}/${s}`,"PUT",e),n=this.items.findIndex(l=>l.id===s);return n!==-1&&(this.items[n]=o),o},async remove(s){await c(`${b}/${s}`,"DELETE"),this.items=this.items.filter(e=>e.id!==s)},async downloadSelReport(s){var e,o;this.loading=!0,this.error=null;try{const{data:n}=await c(`${b}/download-self-report`,"POST",s);return n}catch(n){throw this.error=((o=(e=n.response)==null?void 0:e.data)==null?void 0:o.message)??"Ошибка отправки отчёта",n}finally{this.loading=!1}}}}),J={class:"form-floating mb-2"},K={class:"form-floating mb-2"},Q={class:"form-floating mb-2"},X={class:"form-floating mb-2"},Y={class:"form-check form-switch mb-2"},Z={class:"form-check-label",for:"in_learning"},x={key:0,class:"fw-bold text-primary"},tt={key:1,class:"fw-bold text-primary"},et={class:"input-group mb-2"},ot={class:"form-floating flex-grow-1"},st=["value"],nt={class:"form-check form-switch mb-2"},lt={class:"form-floating mb-2"},it={class:"form-floating mb-2"},at={name:"AgentForm",props:{initialData:{type:Object,default:null}},data(){return{agentStore:$(),isEdit:!1,configLearningPeriod:!1,tab:"main",form:{name:"",phone:"",email:"",region:"",start_learning_date:null,end_learning_date:null,in_learning:!1},mentorName:null}},created(){var s;this.initialData&&(this.form={...this.initialData},this.isEdit=!0,this.mentorName=((s=this.initialData.mentor)==null?void 0:s.name)||"")},methods:{selectAdmin(s){this.form.mentor_id=s.id,this.mentorName=s.name,this.tab="main"},async submitForm(){this.isEdit?this.agentStore.update(this.form.id,this.form):this.agentStore.create(this.form),this.$emit("callback")}}},S=Object.assign(at,{setup(s){return(e,o)=>(i(),a("form",{onSubmit:o[10]||(o[10]=h((...n)=>e.submitForm&&e.submitForm(...n),["prevent"]))},[e.tab==="main"?(i(),a(p,{key:0},[t("div",J,[u(t("input",{"onUpdate:modelValue":o[0]||(o[0]=n=>e.form.name=n),type:"text",class:"form-control",id:"name",placeholder:"Имя",required:""},null,512),[[f,e.form.name]]),o[11]||(o[11]=t("label",{for:"name"},"Имя",-1))]),t("div",K,[u(t("input",{"onUpdate:modelValue":o[1]||(o[1]=n=>e.form.phone=n),type:"tel",class:"form-control",id:"phone",placeholder:"Телефон",required:""},null,512),[[f,e.form.phone]]),o[12]||(o[12]=t("label",{for:"phone"},"Телефон",-1))]),t("div",Q,[u(t("input",{"onUpdate:modelValue":o[2]||(o[2]=n=>e.form.email=n),type:"email",class:"form-control",id:"email",placeholder:"Email",required:""},null,512),[[f,e.form.email]]),o[13]||(o[13]=t("label",{for:"email"},"Email",-1))]),t("div",X,[u(t("input",{"onUpdate:modelValue":o[3]||(o[3]=n=>e.form.region=n),type:"text",class:"form-control",id:"region",placeholder:"Регион"},null,512),[[f,e.form.region]]),o[14]||(o[14]=t("label",{for:"region"},"Регион",-1))]),t("div",Y,[u(t("input",{"onUpdate:modelValue":o[4]||(o[4]=n=>e.form.in_learning=n),class:"form-check-input",type:"checkbox",role:"switch",id:"in_learning"},null,512),[[k,e.form.in_learning]]),t("label",Z,[o[15]||(o[15]=m("На обучении ",-1)),e.form.in_learning?(i(),a("span",x,"включено")):(i(),a("span",tt,"выключено"))])]),e.form.in_learning?(i(),a(p,{key:0},[o[21]||(o[21]=t("p",{class:"alert alert-info mb-2"},"Назначение ответственного за обучение (наставника)",-1)),t("div",et,[t("div",ot,[t("input",{type:"text",class:"form-control",id:"admin",value:e.mentorName,placeholder:"Администратор",readonly:""},null,8,st),o[16]||(o[16]=t("label",{for:"admin"},"Старший администратор",-1))]),t("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:o[5]||(o[5]=n=>e.tab="admin")},"Выбрать ")]),t("div",nt,[u(t("input",{"onUpdate:modelValue":o[6]||(o[6]=n=>e.configLearningPeriod=n),class:"form-check-input",type:"checkbox",role:"switch",id:"configLearningPeriod"},null,512),[[k,e.configLearningPeriod]]),o[17]||(o[17]=t("label",{class:"form-check-label",for:"configLearningPeriod"},"Настройка периода обучения ",-1))]),e.configLearningPeriod?(i(),a(p,{key:0},[o[20]||(o[20]=t("p",{class:"alert alert-info mb-2"},"Период настраивается автоматически после того как вы задали что Админстратор находится на обучении",-1)),t("div",lt,[u(t("input",{"onUpdate:modelValue":o[7]||(o[7]=n=>e.form.start_learning_date=n),type:"date",class:"form-control",id:"sale_date"},null,512),[[f,e.form.start_learning_date]]),o[18]||(o[18]=t("label",{for:"sale_date"},"Дата начала обучения",-1))]),t("div",it,[u(t("input",{"onUpdate:modelValue":o[8]||(o[8]=n=>e.form.end_learning_date=n),type:"date",class:"form-control",id:"sale_date"},null,512),[[f,e.form.end_learning_date]]),o[19]||(o[19]=t("label",{for:"sale_date"},"Дата окончания обучения",-1))])],64)):r("",!0)],64)):r("",!0)],64)):r("",!0),e.tab==="admin"?(i(),a(p,{key:1},[t("button",{onClick:o[9]||(o[9]=n=>e.tab="main"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"0px","z-index":"100"}},"Назад "),w(M,{"for-select":!0,onSelect:e.selectAdmin},null,8,["onSelect"])],64)):r("",!0),o[22]||(o[22]=t("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Сохранить",-1))],32))}}),dt={class:"form-floating mb-3"},rt={class:"list-group"},mt=["onClick"],ut={class:"fw-bold"},gt={key:0,class:"badge bg-success"},pt={key:1,class:"small text-success"},ft=["onClick"],ct={class:"text-muted"},bt={class:"dropdown"},ht={class:"dropdown-menu dropdown-menu-end"},yt={key:0},vt=["onClick"],kt=["onClick"],wt=["onClick"],At=["onClick"],$t=["onClick"],St={class:"modal fade",id:"agentInfoModal",tabindex:"-1"},_t={class:"modal-dialog"},Dt={class:"modal-content"},Et={class:"modal-body"},It={class:"modal fade",id:"deleteModal",tabindex:"-1"},Ct={class:"modal-dialog"},Mt={class:"modal-content"},Ut={class:"modal-body"},Bt={class:"modal-footer"},Pt={class:"modal fade",id:"editAgentModal",tabindex:"-1"},Vt={class:"modal-dialog modal-lg"},Tt={class:"modal-content"},Ft={class:"modal-body"},Lt={class:"modal fade",id:"editUserModal",tabindex:"-1"},Rt={class:"modal-dialog modal-lg"},Gt={class:"modal-content"},Nt={class:"modal-body"},Ot={class:"modal fade",id:"personalStatisticModal",tabindex:"-1"},jt={class:"modal-dialog modal-lg"},qt={class:"modal-content"},zt={class:"modal-body"},Wt={name:"SupplierListWithDropdown",components:{AgentForm:S},props:["forSelect"],data(){return{search:"",selectedAdmin:null,agentStore:$(),selectedAgent:null,report:{startDate:"",endDate:""}}},computed:{filteredAgents(){if(!this.search)return this.agentStore.items||[];const s=this.search.toLowerCase();return this.agentStore.items.filter(e=>Object.values(e).some(o=>o?String(o).toLowerCase().includes(s):!1))}},created(){this.fetchAgents()},methods:{generateReport(){bootstrap.Modal.getInstance(document.getElementById("personalStatisticModal")).hide()},openEdit(s){this.selectedAdmin=null,this.$nextTick(()=>{this.selectedAdmin=s,new bootstrap.Modal(document.getElementById("editUserModal")).show()})},async fetchAgents(s=1){await this.agentStore.fetchAllByPage(s)},async fetchAgentsByUrl(s){await this.agentStore.fetchByUrl(s)},selectAgent(s){this.forSelect&&this.$emit("select",s)},openAgentInfo(s){this.selectedAgent=s,new bootstrap.Modal(document.getElementById("agentInfoModal")).show()},openPercents(s){this.selectedAgent=s,new bootstrap.Modal(document.getElementById("percentsModal")).show()},confirmDelete(s){this.selectedAgent=s,new bootstrap.Modal(document.getElementById("deleteModal")).show()},async deleteAgent(){try{await this.agentStore.remove(this.selectedAgent.id),bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide()}catch(s){console.error("Ошибка удаления:",s)}},getPersonalStatistic(s){this.selectedAgent=null,this.$nextTick(()=>{this.selectedAgent=s,new bootstrap.Modal(document.getElementById("personalStatisticModal")).show()})},openEditAgent(s){this.selectedAgent=null,this.$nextTick(()=>{this.selectedAgent=s,new bootstrap.Modal(document.getElementById("editAgentModal")).show()})}}},ee=Object.assign(Wt,{setup(s){return(e,o)=>{var n;return i(),a(p,null,[t("div",dt,[u(t("input",{type:"search","onUpdate:modelValue":o[0]||(o[0]=l=>e.search=l),class:"form-control",id:"searchInput",placeholder:"Поиск..."},null,512),[[f,e.search]]),o[2]||(o[2]=t("label",{for:"searchInput"},"Поиск",-1))]),t("ul",rt,[(i(!0),a(p,null,D(e.filteredAgents,l=>{var y;return i(),a("li",{key:l.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",{onClick:d=>e.selectAgent(l)},[t("div",ut,[l.in_learning?(i(),a("span",gt,[...o[3]||(o[3]=[t("i",{class:"fa-solid fa-user-graduate"},null,-1)])])):r("",!0),m(" "+g(l.name)+" ",1),l.in_learning&&!s.forSelect?(i(),a("span",pt,[l.mentor?(i(),a("a",{key:0,onClick:d=>e.openEdit(l.mentor),href:"javascript:void(0)"},"("+g(((y=l.mentor)==null?void 0:y.name)||"-")+")",9,ft)):(i(),a(p,{key:1},[m(" Наставник не указан ")],64))])):r("",!0)]),t("small",ct,g(l.phone)+" | "+g(l.email),1)],8,mt),t("div",bt,[o[5]||(o[5]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",ht,[s.forSelect?(i(),a("li",yt,[t("a",{class:"dropdown-item",href:"#",onClick:h(d=>e.selectAgent(l),["prevent"])},"Выбрать",8,vt)])):r("",!0),s.forSelect?r("",!0):(i(),a(p,{key:1},[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:h(d=>e.openAgentInfo(l),["prevent"])},"Просмотр",8,kt)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:h(d=>e.openEditAgent(l),["prevent"])},"Редактировать",8,wt)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:h(d=>e.getPersonalStatistic(l),["prevent"])},"Выгрузка статистики",8,At)]),o[4]||(o[4]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"#",onClick:h(d=>e.confirmDelete(l),["prevent"])},"Удалить",8,$t)])],64))])])])}),128))]),w(E,{pagination:e.agentStore.pagination,onPageChanged:e.fetchAgentsByUrl},null,8,["pagination","onPageChanged"]),t("div",St,[t("div",_t,[t("div",Dt,[o[6]||(o[6]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Информация"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Et,[e.selectedAgent?(i(),v(N,{key:0,agent:e.selectedAgent},null,8,["agent"])):r("",!0)])])])]),t("div",It,[t("div",Ct,[t("div",Mt,[o[10]||(o[10]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title text-danger"},"Удаление"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Ut,[o[7]||(o[7]=m(" Вы уверены, что хотите удалить ",-1)),t("strong",null,g((n=e.selectedAgent)==null?void 0:n.name),1),o[8]||(o[8]=m("? ",-1))]),t("div",Bt,[o[9]||(o[9]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),t("button",{type:"button",class:"btn btn-danger",onClick:o[1]||(o[1]=(...l)=>e.deleteAgent&&e.deleteAgent(...l))},"Удалить")])])])]),t("div",Pt,[t("div",Vt,[t("div",Tt,[o[11]||(o[11]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Ft,[e.selectedAgent?(i(),v(S,{key:0,initialData:e.selectedAgent},null,8,["initialData"])):r("",!0)])])])]),t("div",Lt,[t("div",Rt,[t("div",Gt,[o[12]||(o[12]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование администратора"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Nt,[e.selectedAdmin?(i(),v(I,{key:0,initialData:e.selectedAdmin,onSaved:e.fetchData},null,8,["initialData","onSaved"])):r("",!0)])])])]),t("div",Ot,[t("div",jt,[t("div",qt,[o[13]||(o[13]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Персональная статистика за период"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",zt,[e.selectedAgent?(i(),v(H,{key:0,"agent-id":e.selectedAgent.id,onGenerateReport:e.generateReport},null,8,["agent-id","onGenerateReport"])):r("",!0)])])])])],64)}}});export{H as R,ee as _,S as a,$ as u};
