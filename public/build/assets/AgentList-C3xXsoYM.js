import{c as a,o as i,b as t,e as d,i as r,t as u,F as g,f as S,w as m,v as p,k,a as w,h,r as E,d as v}from"./app-DzD-JY4S.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as C}from"./Pagination-Bj5-hq51.js";import{U as M}from"./UserForm-CvFKeals.js";import"./index-C2c5QJQL.js";import{_ as I}from"./AdminList-JYgMIXaY.js";import{m as c}from"./makeAxiosFactory-D1-PeoKG.js";import{u as _}from"./baseExports-DTt8fx6n.js";const U={name:"AgentInfo",props:{agent:{type:Object,required:!0}}},B={class:"list-group list-group-flush"},P={class:"list-group-item"},V={class:"list-group-item"},T={class:"list-group-item"},F={class:"list-group-item"},L={class:"list-group-item"},N={key:0,class:"list-group-item"};function O(o,s,e,n,l,y){var f;return i(),a(g,null,[t("ul",B,[t("li",P,[s[1]||(s[1]=t("strong",null,"ID:",-1)),r(" "+u(e.agent.id),1)]),t("li",V,[s[2]||(s[2]=t("strong",null,"Имя:",-1)),r(" "+u(e.agent.name),1)]),t("li",T,[s[3]||(s[3]=t("strong",null,"Телефон:",-1)),r(" "+u(e.agent.phone),1)]),t("li",F,[s[4]||(s[4]=t("strong",null,"Email:",-1)),r(" "+u(e.agent.email),1)]),t("li",L,[s[5]||(s[5]=t("strong",null,"Регион:",-1)),r(" "+u(e.agent.region),1)]),e.agent.in_learning?(i(),a("li",N,[s[6]||(s[6]=t("strong",null,"Обучается у: ",-1)),e.agent.mentor?(i(),a(g,{key:0},[r(u(((f=e.agent.mentor)==null?void 0:f.name)||"-"),1)],64)):(i(),a(g,{key:1},[r(" Наставник не указан ")],64))])):d("",!0)]),t("button",{class:"btn btn-primary p-3 w-100",onClick:s[0]||(s[0]=Rt=>o.$emit("edit",e.agent))},"Редактировать")],64)}const j=D(U,[["render",O]]),b="/bot-api/agents",A=S("agents",{state:()=>({items:[],loading:!1,error:null}),getters:{byId:o=>s=>o.items.find(e=>e.id===s)},actions:{async fetchAll(){this.loading=!0,this.error=null;try{const{data:o}=await c(`${b}`,"GET");this.items=o}catch(o){this.error=(o==null?void 0:o.message)||"Failed to load agents"}finally{this.loading=!1}},async fetchAllByPage(o=1){const{data:s}=await c(`${b}?page=${o}`,"GET");this.items=s.data,this.pagination=s},async fetchByUrl(o){const{data:s}=await c(o,"GET");this.items=s.data,this.pagination=s},async fetchOne(o){try{const{data:s}=await c(`${b}/${o}`,"GET");return s}catch(s){throw this.error=(s==null?void 0:s.message)||"Failed to load agent",s}},async create(o){const{data:s}=await c(`${b}`,"POST",o);return this.items.push(s),s},async update(o,s){const{data:e}=await c(`${b}/${o}`,"PUT",s),n=this.items.findIndex(l=>l.id===o);return n!==-1&&(this.items[n]=e),e},async remove(o){await c(`${b}/${o}`,"DELETE"),this.items=this.items.filter(s=>s.id!==o)},async downloadSelReport(o){var s,e;this.loading=!0,this.error=null;try{const{data:n}=await c(`${b}/download-self-report`,"POST",o);return n}catch(n){throw this.error=((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.message)??"Ошибка отправки отчёта",n}finally{this.loading=!1}}}}),q={class:"form-floating mb-2"},G={class:"form-floating mb-2"},R={class:"form-floating mb-2"},z={class:"form-floating mb-2"},W={class:"form-check form-switch mb-2"},H={class:"form-check-label",for:"in_learning"},J={key:0,class:"fw-bold text-primary"},K={key:1,class:"fw-bold text-primary"},Q={class:"input-group mb-2"},X={class:"form-floating flex-grow-1"},Y=["value"],Z={class:"form-check form-switch mb-2"},x={class:"form-floating mb-2"},tt={class:"form-floating mb-2"},et={name:"AgentForm",props:{initialData:{type:Object,default:null}},data(){return{agentStore:A(),isEdit:!1,configLearningPeriod:!1,tab:"main",form:{name:"",phone:"",email:"",region:"",start_learning_date:null,end_learning_date:null,in_learning:!1},mentorName:null}},created(){var o;this.initialData&&(this.form={...this.initialData},this.isEdit=!0,this.mentorName=((o=this.initialData.mentor)==null?void 0:o.name)||"")},methods:{selectAdmin(o){this.form.mentor_id=o.id,this.mentorName=o.name,this.tab="main"},async submitForm(){this.isEdit?this.agentStore.update(this.form.id,this.form):this.agentStore.create(this.form),this.$emit("callback")}}},$=Object.assign(et,{setup(o){return(s,e)=>(i(),a("form",{onSubmit:e[10]||(e[10]=h((...n)=>s.submitForm&&s.submitForm(...n),["prevent"]))},[s.tab==="main"?(i(),a(g,{key:0},[t("div",q,[m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>s.form.name=n),type:"text",class:"form-control",id:"name",placeholder:"Имя",required:""},null,512),[[p,s.form.name]]),e[11]||(e[11]=t("label",{for:"name"},"Имя",-1))]),t("div",G,[m(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>s.form.phone=n),type:"tel",class:"form-control",id:"phone",placeholder:"Телефон",required:""},null,512),[[p,s.form.phone]]),e[12]||(e[12]=t("label",{for:"phone"},"Телефон",-1))]),t("div",R,[m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>s.form.email=n),type:"email",class:"form-control",id:"email",placeholder:"Email",required:""},null,512),[[p,s.form.email]]),e[13]||(e[13]=t("label",{for:"email"},"Email",-1))]),t("div",z,[m(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>s.form.region=n),type:"text",class:"form-control",id:"region",placeholder:"Регион"},null,512),[[p,s.form.region]]),e[14]||(e[14]=t("label",{for:"region"},"Регион",-1))]),t("div",W,[m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>s.form.in_learning=n),class:"form-check-input",type:"checkbox",role:"switch",id:"in_learning"},null,512),[[k,s.form.in_learning]]),t("label",H,[e[15]||(e[15]=r("На обучении ",-1)),s.form.in_learning?(i(),a("span",J,"включено")):(i(),a("span",K,"выключено"))])]),s.form.in_learning?(i(),a(g,{key:0},[e[21]||(e[21]=t("p",{class:"alert alert-info mb-2"},"Назначение ответственного за обучение (наставника)",-1)),t("div",Q,[t("div",X,[t("input",{type:"text",class:"form-control",id:"admin",value:s.mentorName,placeholder:"Администратор",readonly:""},null,8,Y),e[16]||(e[16]=t("label",{for:"admin"},"Старший администратор",-1))]),t("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:e[5]||(e[5]=n=>s.tab="admin")},"Выбрать ")]),t("div",Z,[m(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>s.configLearningPeriod=n),class:"form-check-input",type:"checkbox",role:"switch",id:"configLearningPeriod"},null,512),[[k,s.configLearningPeriod]]),e[17]||(e[17]=t("label",{class:"form-check-label",for:"configLearningPeriod"},"Настройка периода обучения ",-1))]),s.configLearningPeriod?(i(),a(g,{key:0},[e[20]||(e[20]=t("p",{class:"alert alert-info mb-2"},"Период настраивается автоматически после того как вы задали что Админстратор находится на обучении",-1)),t("div",x,[m(t("input",{"onUpdate:modelValue":e[7]||(e[7]=n=>s.form.start_learning_date=n),type:"date",class:"form-control",id:"sale_date"},null,512),[[p,s.form.start_learning_date]]),e[18]||(e[18]=t("label",{for:"sale_date"},"Дата начала обучения",-1))]),t("div",tt,[m(t("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>s.form.end_learning_date=n),type:"date",class:"form-control",id:"sale_date"},null,512),[[p,s.form.end_learning_date]]),e[19]||(e[19]=t("label",{for:"sale_date"},"Дата окончания обучения",-1))])],64)):d("",!0)],64)):d("",!0)],64)):d("",!0),s.tab==="admin"?(i(),a(g,{key:1},[t("button",{onClick:e[9]||(e[9]=n=>s.tab="main"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"0px","z-index":"100"}},"Назад "),w(I,{"for-select":!0,onSelect:s.selectAdmin},null,8,["onSelect"])],64)):d("",!0),e[22]||(e[22]=t("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Сохранить",-1))],32))}}),st={class:"form-floating mb-3"},ot={class:"list-group"},nt=["onClick"],lt={class:"fw-bold"},it={key:0,class:"badge bg-success"},at={key:1,class:"small text-success"},dt=["onClick"],rt={class:"text-muted"},mt={class:"dropdown"},ut={class:"dropdown-menu dropdown-menu-end"},gt={key:0},ft=["onClick"],pt=["onClick"],ct=["onClick"],bt=["onClick"],ht=["onClick"],yt={class:"modal fade",id:"agentInfoModal",tabindex:"-1"},vt={class:"modal-dialog"},kt={class:"modal-content"},wt={class:"modal-body"},At={class:"modal fade",id:"deleteModal",tabindex:"-1"},$t={class:"modal-dialog"},St={class:"modal-content"},Et={class:"modal-body"},Dt={class:"modal-footer"},Ct={class:"modal fade",id:"editAgentModal",tabindex:"-1"},Mt={class:"modal-dialog modal-lg"},It={class:"modal-content"},_t={class:"modal-body"},Ut={class:"modal fade",id:"editUserModal",tabindex:"-1"},Bt={class:"modal-dialog modal-lg"},Pt={class:"modal-content"},Vt={class:"modal-body"},Tt={class:"modal fade",id:"personalStatisticModal",tabindex:"-1"},Ft={class:"modal-dialog modal-lg"},Lt={class:"modal-content"},Nt={class:"modal-body"},Ot={class:"form-floating mb-2"},jt={class:"form-floating mb-2"},qt=["disabled"],Gt={name:"SupplierListWithDropdown",components:{AgentForm:$},props:["forSelect"],data(){return{search:"",selectedAdmin:null,agentStore:A(),reportStore:_(),selectedAgent:null,report:{startDate:"",endDate:""}}},computed:{filteredAgents(){if(!this.search)return this.agentStore.items||[];const o=this.search.toLowerCase();return this.agentStore.items.filter(s=>Object.values(s).some(e=>e?String(e).toLowerCase().includes(o):!1))}},created(){this.fetchAgents()},methods:{generateReport(){const o={...this.report,id:this.selectedAgent.id};bootstrap.Modal.getInstance(document.getElementById("personalStatisticModal")).hide(),this.reportStore.exportFull(o)},openEdit(o){this.selectedAdmin=null,this.$nextTick(()=>{this.selectedAdmin=o,new bootstrap.Modal(document.getElementById("editUserModal")).show()})},async fetchAgents(o=1){await this.agentStore.fetchAllByPage(o)},async fetchAgentsByUrl(o){await this.agentStore.fetchByUrl(o)},selectAgent(o){this.forSelect&&this.$emit("select",o)},openAgentInfo(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("agentInfoModal")).show()},openPercents(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("percentsModal")).show()},confirmDelete(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("deleteModal")).show()},async deleteAgent(){try{await this.agentStore.remove(this.selectedAgent.id),bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide()}catch(o){console.error("Ошибка удаления:",o)}},getPersonalStatistic(o){this.selectedAgent=null,this.$nextTick(()=>{this.selectedAgent=o,new bootstrap.Modal(document.getElementById("personalStatisticModal")).show()})},openEditAgent(o){this.selectedAgent=null,this.$nextTick(()=>{this.selectedAgent=o,new bootstrap.Modal(document.getElementById("editAgentModal")).show()})}}},Zt=Object.assign(Gt,{setup(o){return(s,e)=>{var n;return i(),a(g,null,[t("div",st,[m(t("input",{type:"search","onUpdate:modelValue":e[0]||(e[0]=l=>s.search=l),class:"form-control",id:"searchInput",placeholder:"Поиск..."},null,512),[[p,s.search]]),e[5]||(e[5]=t("label",{for:"searchInput"},"Поиск",-1))]),t("ul",ot,[(i(!0),a(g,null,E(s.filteredAgents,l=>{var y;return i(),a("li",{key:l.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",{onClick:f=>s.selectAgent(l)},[t("div",lt,[l.in_learning?(i(),a("span",it,[...e[6]||(e[6]=[t("i",{class:"fa-solid fa-user-graduate"},null,-1)])])):d("",!0),r(" "+u(l.name)+" ",1),l.in_learning&&!o.forSelect?(i(),a("span",at,[l.mentor?(i(),a("a",{key:0,onClick:f=>s.openEdit(l.mentor),href:"javascript:void(0)"},"("+u(((y=l.mentor)==null?void 0:y.name)||"-")+")",9,dt)):(i(),a(g,{key:1},[r(" Наставник не указан ")],64))])):d("",!0)]),t("small",rt,u(l.phone)+" | "+u(l.email),1)],8,nt),t("div",mt,[e[8]||(e[8]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",ut,[o.forSelect?(i(),a("li",gt,[t("a",{class:"dropdown-item",href:"#",onClick:h(f=>s.selectAgent(l),["prevent"])},"Выбрать",8,ft)])):d("",!0),o.forSelect?d("",!0):(i(),a(g,{key:1},[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:h(f=>s.openAgentInfo(l),["prevent"])},"Просмотр",8,pt)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:h(f=>s.openEditAgent(l),["prevent"])},"Редактировать",8,ct)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:h(f=>s.getPersonalStatistic(l),["prevent"])},"Выгрузка статистики",8,bt)]),e[7]||(e[7]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"#",onClick:h(f=>s.confirmDelete(l),["prevent"])},"Удалить",8,ht)])],64))])])])}),128))]),w(C,{pagination:s.agentStore.pagination,onPageChanged:s.fetchAgentsByUrl},null,8,["pagination","onPageChanged"]),t("div",yt,[t("div",vt,[t("div",kt,[e[9]||(e[9]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Информация"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",wt,[s.selectedAgent?(i(),v(j,{key:0,agent:s.selectedAgent},null,8,["agent"])):d("",!0)])])])]),t("div",At,[t("div",$t,[t("div",St,[e[13]||(e[13]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title text-danger"},"Удаление"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Et,[e[10]||(e[10]=r(" Вы уверены, что хотите удалить ",-1)),t("strong",null,u((n=s.selectedAgent)==null?void 0:n.name),1),e[11]||(e[11]=r("? ",-1))]),t("div",Dt,[e[12]||(e[12]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),t("button",{type:"button",class:"btn btn-danger",onClick:e[1]||(e[1]=(...l)=>s.deleteAgent&&s.deleteAgent(...l))},"Удалить")])])])]),t("div",Ct,[t("div",Mt,[t("div",It,[e[14]||(e[14]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",_t,[s.selectedAgent?(i(),v($,{key:0,initialData:s.selectedAgent},null,8,["initialData"])):d("",!0)])])])]),t("div",Ut,[t("div",Bt,[t("div",Pt,[e[15]||(e[15]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование администратора"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Vt,[s.selectedAdmin?(i(),v(M,{key:0,initialData:s.selectedAdmin,onSaved:s.fetchData},null,8,["initialData","onSaved"])):d("",!0)])])])]),t("div",Tt,[t("div",Ft,[t("div",Lt,[e[18]||(e[18]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Персональная статистика за период"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Nt,[t("form",{onSubmit:e[4]||(e[4]=h((...l)=>s.generateReport&&s.generateReport(...l),["prevent"]))},[t("div",Ot,[m(t("input",{type:"date",class:"form-control",id:"startDate","onUpdate:modelValue":e[2]||(e[2]=l=>s.report.startDate=l),required:""},null,512),[[p,s.report.startDate]]),e[16]||(e[16]=t("label",{for:"startDate"},"Дата начала периода",-1))]),t("div",jt,[m(t("input",{type:"date",class:"form-control",id:"endDate","onUpdate:modelValue":e[3]||(e[3]=l=>s.report.endDate=l),required:""},null,512),[[p,s.report.endDate]]),e[17]||(e[17]=t("label",{for:"endDate"},"Дата окончания периода",-1))]),t("button",{disabled:s.report.loading,type:"submit",class:"btn btn-primary p-3 w-100"}," Сформировать отчёт ",8,qt)],32)])])])])],64)}}});export{Zt as _,$ as a,A as u};
