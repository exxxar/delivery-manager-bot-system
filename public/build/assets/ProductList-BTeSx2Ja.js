import{c as d,o as r,a as e,f as w,d as u,t as p,F as h,r as $,w as g,e as m,j as f,g as E,i as I,h as k,b as _}from"./app-kqq_ax9F.js";import{P as D}from"./Pagination-Bt6uxHH4.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as M}from"./ProductCategoryList-C93MXW4j.js";import{_ as V}from"./SupplierList-Bqt28g09.js";import{m as b}from"./makeAxiosFactory-DcNQawBG.js";import{u as U}from"./useConfitmModalStore-_TLIiHym.js";const B={name:"ProductFilter",data(){return{field_visible:{},filters:{name:"",description:"",price:"",count:"",supplier_id:"",product_category_id:""},sort:{field:"id",direction:"asc"},sortableFields:{id:"ID",name:"Название",description:"Описание",price:"Цена",count:"Количество",supplier_id:"Поставщик",product_category_id:"Категория",created_at:"Дата создания",updated_at:"Дата обновления"}}},created(){const s=["name","price"];for(const t in this.sortableFields)this.field_visible[t]=s.includes(t)},methods:{clearFilters(){const s={name:"",description:"",price:"",count:"",supplier_id:"",product_category_id:""};this.size=20,this.page=1;let t=["name","price"];for(const o in this.sortableFields)this.field_visible[o]=t.indexOf(o)!==-1;this.filters=s},openFilter(){new bootstrap.Modal(document.getElementById("productFilterModal")).show()},changeSort(s){this.sort.field===s?this.sort.direction=this.sort.direction==="asc"?"desc":"asc":(this.sort.field=s,this.sort.direction="asc"),this.$emit("apply-filters",{filters:this.filters,sort:this.sort,field_visible:this.field_visible})},applyFilters(){this.$emit("apply-filters",{filters:this.filters,sort:this.sort,field_visible:this.field_visible}),bootstrap.Modal.getInstance(document.getElementById("productFilterModal")).hide()}}},N={class:"d-flex mb-2"},j={class:"dropdown d-inline-block ms-2"},T={style:{"font-size":"12px"},class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown"},z={key:0},O={key:1},A={key:2},q={class:"dropdown-menu"},x=["onClick"],G={class:"modal fade",id:"productFilterModal",tabindex:"-1"},L={class:"modal-dialog modal-fullscreen"},R={class:"modal-body"},H={class:"form-floating mb-2"},J={class:"form-floating mb-2"},K={class:"form-floating mb-2"},Q={class:"form-floating mb-2"},W={class:"form-floating mb-2"},X={class:"form-floating mb-2"},Y=["onUpdate:modelValue","id"],Z=["for"];function tt(s,t,o,l,i,a){return r(),d("div",null,[e("div",N,[e("button",{style:{"font-size":"12px"},class:"btn btn-secondary",onClick:t[0]||(t[0]=(...n)=>a.openFilter&&a.openFilter(...n))},"Фильтр"),e("div",j,[e("button",T,[w(p(i.sortableFields[i.sort.field].slice(0,17))+" ",1),i.sortableFields[i.sort.field].length>17?(r(),d("span",z,"...")):u("",!0),t[11]||(t[11]=w(" (",-1)),i.sort.direction==="asc"?(r(),d("span",O,[...t[9]||(t[9]=[e("i",{class:"fa-solid fa-arrow-down"},null,-1)])])):u("",!0),i.sort.direction==="desc"?(r(),d("span",A,[...t[10]||(t[10]=[e("i",{class:"fa-solid fa-arrow-up"},null,-1)])])):u("",!0),t[12]||(t[12]=w(") ",-1))]),e("ul",q,[(r(!0),d(h,null,$(i.sortableFields,(n,c)=>(r(),d("li",{key:c},[e("a",{class:"dropdown-item",onClick:v=>a.changeSort(c)},p(n),9,x)]))),128))])])]),e("div",G,[e("div",L,[e("form",{class:"modal-content",onSubmit:t[8]||(t[8]=g((...n)=>a.applyFilters&&a.applyFilters(...n),["prevent"]))},[t[20]||(t[20]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Фильтры товаров"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",R,[e("div",H,[m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>i.filters.name=n),class:"form-control",id:"nameInput",placeholder:"Название"},null,512),[[f,i.filters.name]]),t[13]||(t[13]=e("label",{for:"nameInput"},"Название",-1))]),e("div",J,[m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>i.filters.description=n),class:"form-control",id:"descInput",placeholder:"Описание"},null,512),[[f,i.filters.description]]),t[14]||(t[14]=e("label",{for:"descInput"},"Описание",-1))]),e("div",K,[m(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=n=>i.filters.price=n),class:"form-control",id:"priceInput",placeholder:"Цена"},null,512),[[f,i.filters.price]]),t[15]||(t[15]=e("label",{for:"priceInput"},"Цена",-1))]),e("div",Q,[m(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=n=>i.filters.count=n),class:"form-control",id:"countInput",placeholder:"Количество"},null,512),[[f,i.filters.count]]),t[16]||(t[16]=e("label",{for:"countInput"},"Количество",-1))]),e("div",W,[m(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=n=>i.filters.supplier_id=n),class:"form-control",id:"supplierInput",placeholder:"ID поставщика"},null,512),[[f,i.filters.supplier_id]]),t[17]||(t[17]=e("label",{for:"supplierInput"},"ID поставщика",-1))]),e("div",X,[m(e("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=n=>i.filters.product_category_id=n),class:"form-control",id:"categoryInput",placeholder:"ID категории"},null,512),[[f,i.filters.product_category_id]]),t[18]||(t[18]=e("label",{for:"categoryInput"},"ID категории",-1))]),t[19]||(t[19]=e("h6",{class:"mt-3"},"Отображаемые поля",-1)),(r(!0),d(h,null,$(i.sortableFields,(n,c)=>(r(),d("div",{key:c,class:"form-check form-switch mb-2"},[m(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":v=>i.field_visible[c]=v,id:`switch-${c}`},null,8,Y),[[E,i.field_visible[c]]]),e("label",{class:"form-check-label",for:`switch-${c}`},p(n),9,Z)]))),128)),e("button",{type:"button",onClick:t[7]||(t[7]=(...n)=>a.clearFilters&&a.clearFilters(...n)),class:"btn btn-outline-light text-secondary mb-2 w-100 p-3"},"Очистить фильтры ")]),t[21]||(t[21]=e("div",{class:"modal-footer"},[e("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Применить")],-1))],32)])])])}const et=S(B,[["render",tt]]),y="/bot-api/products",F=I("products",{state:()=>({items:[],loading:!1,filters:null,error:null,sort:{field:"id",direction:"desc"}}),getters:{byId:s=>t=>s.items.find(o=>o.id===t)},actions:{setFilters(s){this.filters=s},setSort(s,t){this.sort={field:s,direction:t}},async fetchAll(){this.loading=!0,this.error=null;try{const{data:s}=await b(`${y}`,"GET");this.items=s}catch(s){this.error=(s==null?void 0:s.message)||"Failed to load products"}finally{this.loading=!1}},async fetchAllByPage(s=1){const{data:t}=await b(`${y}?page=${s}`,"GET");this.items=t.data,this.pagination=t},async fetchByUrl(s){const{data:t}=await b(s,"GET");this.items=t.data,this.pagination=t},async fetchOne(s){try{const{data:t}=await b(`${y}/${s}`,"GET");return t}catch(t){throw this.error=(t==null?void 0:t.message)||"Failed to load product",t}},async fetchFilteredProducts(s=1,t=30){const o=new URLSearchParams;Object.entries(this.filters).forEach(([i,a])=>{a!=null&&a!==""&&o.append(i,String(a))}),o.append("sort_field",this.sort.field),o.append("sort_direction",this.sort.direction),o.append("page",String(s)),o.append("suze",String(t));const{data:l}=await b(`${y}?${o.toString()}`,"GET");return this.items=l.data,this.pagination=l,!0},async create(s){const{data:t}=await b(`${y}`,"POST",s);return this.items.push(t),t},async update(s,t){const{data:o}=await b(`${y}/${s}`,"PUT",t),l=this.items.findIndex(i=>i.id===s);return l!==-1&&(this.items[l]=o),o},async remove(s){await b(`${y}/${s}`,"DELETE"),this.items=this.items.filter(t=>t.id!==s)}}}),st={class:"container-fluid p-0"},ot={class:"form-floating mb-2"},it={class:"form-floating mb-2"},lt={class:"form-floating mb-2"},nt={class:"form-floating mb-2"},rt={class:"input-group mb-2"},dt={class:"form-floating flex-grow-1"},at=["value"],ut={class:"input-group mb-2"},pt={class:"form-floating flex-grow-1"},ct=["value"],mt=["disabled"],ft={name:"ProductForm",props:{initialData:{type:Object,default:null}},data(){return{tab:"main",productStore:F(),form:{name:"",description:"",price:0,count:0,supplier_id:null,product_category_id:null},supplierName:"",categoryName:"",isEdit:!1}},created(){var s,t;this.initialData&&(this.form={...this.initialData},this.isEdit=!0,this.supplierName=((s=this.initialData.supplier)==null?void 0:s.name)||"",this.categoryName=((t=this.initialData.category)==null?void 0:t.name)||"")},methods:{selectSupplier(s){this.form.supplier_id=s.id,this.supplierName=s.name,this.tab="main"},selectCategory(s){this.form.product_category_id=s.id,this.categoryName=s.name,this.tab="main"},async submitForm(){try{this.isEdit?await this.productStore.update(this.form.id,this.form):await this.productStore.create(this.form),this.$emit("saved")}catch(s){console.error("Ошибка сохранения продукта:",s)}}}},P=Object.assign(ft,{setup(s){return(t,o)=>(r(),d("div",st,[t.tab==="main"?(r(),d("form",{key:0,onSubmit:o[6]||(o[6]=g((...l)=>t.submitForm&&t.submitForm(...l),["prevent"]))},[e("div",ot,[m(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>t.form.name=l),type:"text",class:"form-control",id:"name",placeholder:"Название",required:""},null,512),[[f,t.form.name]]),o[9]||(o[9]=e("label",{for:"name"},"Название продукта",-1))]),e("div",it,[m(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=l=>t.form.description=l),class:"form-control",id:"description",placeholder:"Описание",style:{height:"120px"},required:""},null,512),[[f,t.form.description]]),o[10]||(o[10]=e("label",{for:"description"},"Описание",-1))]),e("div",lt,[m(e("input",{"onUpdate:modelValue":o[2]||(o[2]=l=>t.form.price=l),type:"number",step:"0.01",class:"form-control",id:"price",placeholder:"Цена",required:""},null,512),[[f,t.form.price]]),o[11]||(o[11]=e("label",{for:"price"},"Цена",-1))]),e("div",nt,[m(e("input",{"onUpdate:modelValue":o[3]||(o[3]=l=>t.form.count=l),type:"number",class:"form-control",id:"count",placeholder:"Количество",required:""},null,512),[[f,t.form.count]]),o[12]||(o[12]=e("label",{for:"count"},"Количество",-1))]),e("div",rt,[e("div",dt,[e("input",{type:"text",class:"form-control",id:"supplier",value:t.supplierName,placeholder:"Поставщик",readonly:""},null,8,at),o[13]||(o[13]=e("label",{for:"supplier"},"Поставщик",-1))]),e("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:o[4]||(o[4]=l=>t.tab="supplier")}," Выбрать ")]),e("div",ut,[e("div",pt,[e("input",{type:"text",class:"form-control",id:"category",value:t.categoryName,placeholder:"Категория",readonly:""},null,8,ct),o[14]||(o[14]=e("label",{for:"category"},"Категория",-1))]),e("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:o[5]||(o[5]=l=>t.tab="category")}," Выбрать ")]),e("button",{disabled:!t.supplierName||!t.categoryName,type:"submit",class:"btn btn-primary w-100 p-3"},p(t.isEdit?"Сохранить изменения":"Добавить продукт"),9,mt)],32)):u("",!0),t.tab==="supplier"?(r(),d(h,{key:1},[e("button",{onClick:o[7]||(o[7]=l=>t.tab="main"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"0px","z-index":"100"}},"Назад "),k(V,{"for-select":!0,onSelect:t.selectSupplier},null,8,["onSelect"])],64)):u("",!0),t.tab==="category"?(r(),d(h,{key:2},[e("button",{onClick:o[8]||(o[8]=l=>t.tab="main"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"0px","z-index":"100"}},"Назад "),k(M,{"for-select":!0,onSelect:t.selectCategory},null,8,["onSelect"])],64)):u("",!0)]))}}),bt={name:"ProductCard",props:{product:{type:Object,required:!0}}},ht={class:"list-group list-group-flush"},yt={class:"list-group-item d-flex justify-content-between"},gt={class:"list-group-item d-flex justify-content-between"},vt={class:"list-group-item d-flex justify-content-between"},wt={class:"list-group-item d-flex justify-content-between"},_t={style:{"text-align":"right"}},$t={class:"list-group-item d-flex justify-content-between"},kt={style:{"text-align":"right"}},St={class:"list-group-item",style:{"text-align":"justify"}};function Ft(s,t,o,l,i,a){var n,c;return r(),d(h,null,[e("ul",ht,[e("li",yt,[t[1]||(t[1]=e("span",null,[e("strong",null,"Название:")],-1)),e("span",null,p(o.product.name),1)]),e("li",gt,[t[2]||(t[2]=e("span",null,[e("strong",null,"Цена:")],-1)),e("span",null,p(o.product.price)+" ₽",1)]),e("li",vt,[t[3]||(t[3]=e("span",null,[e("strong",null,"Количество:")],-1)),e("span",null,p(o.product.count),1)]),e("li",wt,[t[4]||(t[4]=e("span",null,[e("strong",null,"Поставщик:")],-1)),e("span",_t,p(((n=o.product.supplier)==null?void 0:n.name)||"не выбран"),1)]),e("li",$t,[t[5]||(t[5]=e("span",null,[e("strong",null,"Категория:")],-1)),e("span",kt,p(((c=o.product.category)==null?void 0:c.name)||"не выбрана"),1)]),e("li",St,p(o.product.description),1)]),e("button",{class:"btn btn-primary p-3 w-100",onClick:t[0]||(t[0]=v=>s.$emit("edit",o.product))},"Редактировать")],64)}const C=S(bt,[["render",Ft]]),Pt={class:"list-group"},Ct=["onClick"],Et={class:"fw-bold"},It={class:"text-muted"},Dt={class:"dropdown"},Mt={class:"dropdown-menu dropdown-menu-end"},Vt={key:0},Ut=["onClick"],Bt=["onClick"],Nt=["onClick"],jt=["onClick"],Tt={key:1,class:"alert alert-info mt-3"},zt={class:"modal fade",id:"editProductModal",tabindex:"-1"},Ot={class:"modal-dialog modal-lg"},At={class:"modal-content"},qt={class:"modal-body"},xt={class:"modal fade",id:"viewProductModal",tabindex:"-1"},Gt={class:"modal-dialog modal-lg"},Lt={class:"modal-content"},Rt={class:"modal-body"},Ht={name:"ProductList",components:{ProductForm:P,ProductCard:C},props:["forSelect"],data(){return{productStore:F(),modalStore:U(),products:[],selectedProduct:null}},created(){this.fetchData()},methods:{async applyFilters(s){this.field_visible=s.field_visible;let t=s.size||30,o=s.page||1;delete s.field_visible,this.productStore.setFilters(s.filters),this.productStore.setSort(s.sort.field,s.sort.direction),await this.productStore.fetchFilteredProducts(o,t)},async fetchData(s=1){await this.productStore.fetchAllByPage(s)},async fetchDataByUrl(s){await this.productStore.fetchByUrl(s)},closeEdit(){const s=bootstrap.Modal.getInstance(document.getElementById("viewProductModal"));s&&s.hide()},openEdit(s){this.selectedProduct=s,new bootstrap.Modal(document.getElementById("editProductModal")).show(),this.closeEdit()},confirmDelete(s){var t;this.selectedProduct=s,this.modalStore.open(`Вы уверены, что хотите удалить <b>${(t=this.selectedProduct)==null?void 0:t.name}</b>?`,()=>this.productStore.remove(this.selectedProduct.id),()=>this.modalStore.close())},async deleteProduct(){await this.productStore.remove(this.selectedProduct.id),bootstrap.Modal.getInstance(document.getElementById("deleteProductModal")).hide()},openView(s){this.selectedProduct=s,new bootstrap.Modal(document.getElementById("viewProductModal")).show()}}},te=Object.assign(Ht,{setup(s){return(t,o)=>(r(),d(h,null,[s.forSelect?u("",!0):(r(),_(et,{key:0,onApplyFilters:t.applyFilters},null,8,["onApplyFilters"])),e("ul",Pt,[(r(!0),d(h,null,$(t.productStore.items,l=>(r(),d("li",{key:l.id,class:"list-group-item d-flex justify-content-between align-items-center"},[e("div",{onClick:g(i=>t.$emit("select",l),["prevent"])},[e("div",Et,p(l.name),1),e("small",It,p(l.price)+" ₽",1)],8,Ct),e("div",Dt,[o[0]||(o[0]=e("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[e("i",{class:"fas fa-bars"})],-1)),e("ul",Mt,[s.forSelect?(r(),d("li",Vt,[e("a",{class:"dropdown-item",href:"#",onClick:g(i=>t.$emit("select",l),["prevent"])},"Выбрать",8,Ut)])):u("",!0),s.forSelect?u("",!0):(r(),d(h,{key:1},[e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:g(i=>t.openView(l),["prevent"])},"Просмотреть",8,Bt)]),e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:g(i=>t.openEdit(l),["prevent"])},"Редактировать",8,Nt)]),e("li",null,[e("a",{class:"dropdown-item text-danger",href:"#",onClick:g(i=>t.confirmDelete(l),["prevent"])},"Удалить",8,jt)])],64))])])]))),128))]),k(D,{pagination:t.productStore.pagination,onPageChanged:t.fetchDataByUrl},null,8,["pagination","onPageChanged"]),t.productStore.items.length===0?(r(),d("div",Tt," Товаров пока нет. ")):u("",!0),e("div",zt,[e("div",Ot,[e("div",At,[o[1]||(o[1]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Редактирование товара"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",qt,[t.selectedProduct?(r(),_(P,{key:0,initialData:t.selectedProduct,onSaved:t.fetchProducts},null,8,["initialData","onSaved"])):u("",!0)])])])]),e("div",xt,[e("div",Gt,[e("div",Lt,[o[2]||(o[2]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Карточка товара"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",Rt,[t.selectedProduct?(r(),_(C,{key:0,product:t.selectedProduct,onClose:t.closeEdit,onEdit:t.openEdit},null,8,["product","onClose","onEdit"])):u("",!0)])])])])],64))}});export{C as P,P as _,te as a};
