import{c as n,o,a as t,f as b,t as m,F as h,d as a,r as U,w as u,e as p,j as k,v as E,G as j,g,b as y,h as w}from"./app-BMbYUiN0.js";import{U as V}from"./UserForm-DMz7p2n5.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as T}from"./Pagination-BrV3I5EG.js";import{u as D}from"./users-Dnbw8t4q.js";import{u as N}from"./useConfitmModalStore-B5U-lBSu.js";import{B as L}from"./BackBtn-ByiU8IFf.js";import"./makeAxiosFactory-BXbjrVGO.js";const P={name:"UserCard",props:{user:{type:Object,required:!0}},methods:{roleName(s){switch(s){case 0:return"Пользователь";case 1:return"Младший администратор";case 2:return"Поставщик";case 3:return"Администратор";case 4:return"Суперадмин";default:return"Неизвестно"}}}},R={class:"list-group list-group-flush"},O={class:"list-group-item"},A={class:"list-group-item"},q={class:"list-group-item"},z={class:"list-group-item"},W={class:"list-group-item"},G={class:"list-group-item"};function H(s,e,l,r,i,f){return o(),n(h,null,[t("ul",R,[t("li",O,[e[1]||(e[1]=t("strong",null,"Имя в системе:",-1)),b(" "+m(l.user.name),1)]),t("li",A,[e[2]||(e[2]=t("strong",null,"Имя из Telegram:",-1)),b(" "+m(l.user.fio_from_telegram||"не указано"),1)]),t("li",q,[e[3]||(e[3]=t("strong",null,"Email:",-1)),b(" "+m(l.user.email),1)]),t("li",z,[e[4]||(e[4]=t("strong",null,"Telegram Chat ID:",-1)),b(" "+m(l.user.telegram_chat_id||"не указан"),1)]),t("li",W,[e[5]||(e[5]=t("strong",null,"Роль:",-1)),b(" "+m(f.roleName(l.user.role)),1)]),t("li",G,[e[6]||(e[6]=t("strong",null,"Процент:",-1)),b(" "+m(l.user.percent)+"% ",1)])]),t("button",{class:"btn btn-primary w-100 p-3",onClick:e[0]||(e[0]=d=>s.$emit("edit",l.user))},"Редактировать")],64)}const J=S(P,[["render",H]]),K={name:"UserFilter",data(){return{field_visible:[],filters:{name:"",fio_from_telegram:"",email:"",telegram_chat_id:"",role:"",percent:"",is_work:!1,email_verified:!1,blocked:!1},sort:{field:"id",direction:"asc"},sortableFields:{id:"№",name:"Имя",fio_from_telegram:"ФИО из Telegram",email:"Электронная почта",telegram_chat_id:"ID чата Telegram",role:"Роль",percent:"Процент",is_work:"Работает(да\\нет)",email_verified_at:"Дата подтверждения email",blocked_at:"Дата блокировки",created_at:"Дата создания",updated_at:"Дата обновления данных"}}},created(){let s=["name","email"];for(const e in this.sortableFields)this.field_visible[e]=s.indexOf(e)!==-1},methods:{openFilter(){new bootstrap.Modal(document.getElementById("userFilterModal")).show()},changeSort(s){this.sort.field===s?this.sort.direction=this.sort.direction==="asc"?"desc":"asc":(this.sort.field=s,this.sort.direction="asc");const e={filters:this.filters,sort:this.sort};this.$emit("apply-filters",e)},applyFilters(){const s={filters:this.filters,sort:this.sort,field_visible:this.field_visible};this.$emit("apply-filters",s),bootstrap.Modal.getInstance(document.getElementById("userFilterModal")).hide()}}},Q={class:"d-flex mb-2"},X={class:"dropdown d-inline-block ms-2"},Y={style:{"font-size":"12px"},class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown"},Z={key:0},x={key:1},ee={key:2},te={class:"dropdown-menu"},se=["onClick"],le={class:"modal fade",id:"userFilterModal",tabindex:"-1"},oe={class:"modal-dialog"},ie={class:"modal-content"},re={class:"modal-body"},de={class:"form-floating mb-2"},ne={class:"form-floating mb-2"},ae={class:"form-floating mb-2"},me={class:"form-floating mb-2"},ce={class:"form-floating mb-2"},ue={class:"form-floating mb-2"},pe={class:"form-check mb-2"},fe={class:"form-check mb-2"},be={class:"form-check mb-2"},ve=["onUpdate:modelValue","id"],he=["for"];function _e(s,e,l,r,i,f){return o(),n("div",null,[t("div",Q,[t("button",{style:{"font-size":"12px"},class:"btn btn-secondary",onClick:e[0]||(e[0]=(...d)=>f.openFilter&&f.openFilter(...d))},"Фильтр"),t("div",X,[t("button",Y,[b(m(i.sortableFields[i.sort.field].slice(0,17))+" ",1),i.sortableFields[i.sort.field].length>17?(o(),n("span",Z,"...")):a("",!0),e[13]||(e[13]=b(" (",-1)),i.sort.direction==="asc"?(o(),n("span",x,[...e[11]||(e[11]=[t("i",{class:"fa-solid fa-arrow-down"},null,-1)])])):a("",!0),i.sort.direction==="desc"?(o(),n("span",ee,[...e[12]||(e[12]=[t("i",{class:"fa-solid fa-arrow-up"},null,-1)])])):a("",!0),e[14]||(e[14]=b(") ",-1))]),t("ul",te,[(o(!0),n(h,null,U(i.sortableFields,(d,c)=>(o(),n("li",{key:c},[t("a",{class:"dropdown-item",onClick:_=>f.changeSort(c)},m(d),9,se)]))),128))])])]),t("div",le,[t("div",oe,[t("div",ie,[t("form",{onSubmit:e[10]||(e[10]=u((...d)=>f.applyFilters&&f.applyFilters(...d),["prevent"]))},[e[26]||(e[26]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Фильтры пользователей"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",re,[t("div",de,[p(t("input",{"onUpdate:modelValue":e[1]||(e[1]=d=>i.filters.name=d),class:"form-control",id:"nameInput",placeholder:"Имя"},null,512),[[k,i.filters.name]]),e[15]||(e[15]=t("label",{for:"nameInput"},"Имя",-1))]),t("div",ne,[p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=d=>i.filters.fio_from_telegram=d),class:"form-control",id:"fioInput",placeholder:"ФИО из Telegram"},null,512),[[k,i.filters.fio_from_telegram]]),e[16]||(e[16]=t("label",{for:"fioInput"},"ФИО из Telegram",-1))]),t("div",ae,[p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=d=>i.filters.email=d),class:"form-control",id:"emailInput",placeholder:"Email"},null,512),[[k,i.filters.email]]),e[17]||(e[17]=t("label",{for:"emailInput"},"Email",-1))]),t("div",me,[p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=d=>i.filters.telegram_chat_id=d),class:"form-control",id:"tgInput",placeholder:"Telegram chat id"},null,512),[[k,i.filters.telegram_chat_id]]),e[18]||(e[18]=t("label",{for:"tgInput"},"Telegram chat id",-1))]),t("div",ce,[p(t("select",{"onUpdate:modelValue":e[5]||(e[5]=d=>i.filters.role=d),class:"form-select",id:"roleSelect"},[...e[19]||(e[19]=[j('<option value="">Все</option><option value="0">Пользователь</option><option value="1">Младший администратор</option><option value="2">Поставщик</option><option value="3">Администратор</option><option value="4">Суперадмин</option>',6)])],512),[[E,i.filters.role]]),e[20]||(e[20]=t("label",{for:"roleSelect"},"Роль",-1))]),t("div",ue,[p(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=d=>i.filters.percent=d),class:"form-control",id:"percentInput",placeholder:"Процент"},null,512),[[k,i.filters.percent]]),e[21]||(e[21]=t("label",{for:"percentInput"},"Процент",-1))]),t("div",pe,[p(t("input",{class:"form-check-input",type:"checkbox",id:"isWorkCheck","onUpdate:modelValue":e[7]||(e[7]=d=>i.filters.is_work=d)},null,512),[[g,i.filters.is_work]]),e[22]||(e[22]=t("label",{class:"form-check-label",for:"isWorkCheck"},"Работает",-1))]),t("div",fe,[p(t("input",{class:"form-check-input",type:"checkbox",id:"verifiedCheck","onUpdate:modelValue":e[8]||(e[8]=d=>i.filters.email_verified=d)},null,512),[[g,i.filters.email_verified]]),e[23]||(e[23]=t("label",{class:"form-check-label",for:"verifiedCheck"},"Email подтверждён",-1))]),t("div",be,[p(t("input",{class:"form-check-input",type:"checkbox",id:"blockedCheck","onUpdate:modelValue":e[9]||(e[9]=d=>i.filters.blocked=d)},null,512),[[g,i.filters.blocked]]),e[24]||(e[24]=t("label",{class:"form-check-label",for:"blockedCheck"},"Заблокирован",-1))]),e[25]||(e[25]=t("h6",null,"Отображаемые поля",-1)),(o(!0),n(h,null,U(i.sortableFields,(d,c)=>(o(),n("div",{key:c,class:"form-check form-switch mb-2"},[p(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":_=>i.field_visible[c]=_,id:`switch-${c}`},null,8,ve),[[g,i.field_visible[c]]]),t("label",{class:"form-check-label",for:`switch-${c}`},m(d),9,he)]))),128))]),e[27]||(e[27]=t("div",{class:"modal-footer"},[t("button",{type:"submit",class:"btn btn-primary"},"Применить")],-1))],32)])])])])}const ke=S(K,[["render",_e]]),ge={class:"list-group"},ye={class:"fw-bold"},Ue={key:0},we={key:1},Se={key:0,class:"text-muted small"},Ce={key:1,class:"text-muted small"},Fe=["onClick"],Me={key:2,class:"text-muted small"},Ie={key:3,class:"text-muted small"},$e={key:4,class:"text-muted small"},Be={key:5,class:"text-muted small"},Ve={key:6,class:"text-muted small"},Ee={key:7,class:"text-muted small"},je={key:8,class:"text-muted small"},Te={class:"dropdown"},De={class:"dropdown-menu dropdown-menu-end"},Ne=["onClick"],Le=["onClick"],Pe=["onClick"],Re=["onClick"],Oe=["onClick"],Ae=["onClick"],qe={key:1},ze=["onClick"],We={key:2},Ge=["onClick"],He={key:1,class:"alert alert-light mt-3"},Je={class:"modal fade",id:"editUserModal",tabindex:"-1"},Ke={class:"modal-dialog modal-lg"},Qe={class:"modal-content"},Xe={class:"modal-body"},Ye={class:"modal fade",id:"editUserModal",tabindex:"-1"},Ze={class:"modal-dialog modal-lg"},xe={class:"modal-content"},et={class:"modal-body"},tt={class:"modal fade",id:"roleSwitcherUserModal",tabindex:"-1"},st={class:"modal-dialog modal-lg"},lt={class:"modal-content"},ot={class:"modal-body"},it={class:"form-floating mb-2"},rt={class:"modal fade",id:"viewUserModal",tabindex:"-1"},dt={class:"modal-dialog"},nt={class:"modal-content"},at={class:"modal-body"},mt={name:"UserList",props:["forSelect"],data(){return{roles:["Пользователь","Младший администратор","Поставщик","Администратор"],modalStore:N(),usersStore:D(),selectedUser:null,field_visible:null}},created(){this.fetchUsers()},methods:{async fetchUsers(s=1){await this.usersStore.fetchAllByPage(s)},async getTelegramLink(s){await this.usersStore.getTelegramLink(s.id)},async fetchUsersByUrl(s){await this.usersStore.fetchByUrl(s)},applyFilter(s){this.field_visible=s.field_visible,console.log("test",this.field_visible),this.usersStore.setFilters(s.filters),this.usersStore.setSort(s.sort.field,s.sort.direction),this.usersStore.fetchFiltered()},openRoleSwitcher(s){this.selectedUser=s,new bootstrap.Modal(document.getElementById("roleSwitcherUserModal")).show()},openEdit(s){this.selectedUser=s;const e=bootstrap.Modal.getInstance(document.getElementById("viewUserModal"));e&&e.hide(),new bootstrap.Modal(document.getElementById("editUserModal")).show()},confirmDelete(s){var e;this.selectedUser=s,this.modalStore.open(`Вы уверены, что хотите удалить ${(e=this.selectedUser)==null?void 0:e.name}?`,()=>this.usersStore.remove(this.selectedUser.id),()=>this.modalStore.close())},confirmUnBlocked(s){var e;this.selectedUser=s,this.modalStore.open(`Вы уверены, что хотите разблокировать ${(e=this.selectedUser)==null?void 0:e.name}?`,()=>this.usersStore.unblock(this.selectedUser.id),()=>this.modalStore.close())},confirmBlocked(s){var e;this.selectedUser=s,this.modalStore.open(`Вы уверены, что хотите заблокировать ${(e=this.selectedUser)==null?void 0:e.name}?`,()=>this.usersStore.block(this.selectedUser.id,""),()=>this.modalStore.close())},openView(s){this.selectedUser=s,new bootstrap.Modal(document.getElementById("viewUserModal")).show()},async changeRole(){await this.usersStore.updateRole(this.selectedUser.id,this.selectedUser.role);const s=bootstrap.Modal.getInstance(document.getElementById("roleSwitcherUserModal"));s&&s.hide()}}},ct=Object.assign(mt,{setup(s){return(e,l)=>(o(),n(h,null,[s.forSelect?a("",!0):(o(),y(ke,{key:0,onApplyFilters:e.applyFilter},null,8,["onApplyFilters"])),t("ul",ge,[(o(!0),n(h,null,U(e.usersStore.items,r=>{var i,f,d,c,_,C,F,M,I,$,B;return o(),n("li",{key:r.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",null,[t("div",ye,[((i=e.field_visible)!=null&&i.name,o(),n("span",Ue,m(r.name),1)),(f=e.field_visible)!=null&&f.id?(o(),n("span",we,"(#"+m(r.id)+")",1)):a("",!0)]),((d=e.field_visible)!=null&&d.email,o(),n("p",Se,"Почта "+m(r.email),1)),(c=e.field_visible)!=null&&c.telegram_chat_id?(o(),n("p",Ce,[l[2]||(l[2]=b(" ТГ id ",-1)),t("a",{href:"javascript:void(0)",onClick:u(v=>e.getTelegramLink(r),["prevent"])},m(r.telegram_chat_id||"Не указано"),9,Fe)])):a("",!0),(_=e.field_visible)!=null&&_.role?(o(),n("p",Me,m(e.roles[r.role||0]||"неизвестная роль"),1)):a("",!0),(C=e.field_visible)!=null&&C.percent?(o(),n("p",Ie,"Процент за работу "+m(r.percent)+"%",1)):a("",!0),(F=e.field_visible)!=null&&F.is_work?(o(),n("p",$e,"Статус работы "+m(r.is_work?"работает":"не работает"),1)):a("",!0),(M=e.field_visible)!=null&&M.email_verified_at?(o(),n("p",Be,"Дата верификации почты "+m(r.email_verified_at),1)):a("",!0),(I=e.field_visible)!=null&&I.blocked_at?(o(),n("p",Ve,"Дата блокировки "+m(r.blocked_at),1)):a("",!0),($=e.field_visible)!=null&&$.created_at?(o(),n("p",Ee,"Дата создания пользователя "+m(r.created_at),1)):a("",!0),(B=e.field_visible)!=null&&B.updated_at?(o(),n("p",je,"Дата последнего обновления данных пользователя "+m(r.updated_at),1)):a("",!0)]),t("div",Te,[l[6]||(l[6]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",De,[s.forSelect?(o(),n(h,{key:0},[t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.$emit("select",r),["prevent"])},"Выбрать",8,Ne)]),l[3]||(l[3]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1))],64)):a("",!0),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.openRoleSwitcher(r),["prevent"])},"Сменить роль",8,Le)]),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.openEdit(r),["prevent"])},"Редактировать",8,Pe)]),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.openView(r),["prevent"])},"Просмотреть",8,Re)]),l[4]||(l[4]=t("hr",{class:"dropdown-divider"},null,-1)),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.getTelegramLink(r),["prevent"])},"Получить ссылку на телеграм",8,Oe)]),l[5]||(l[5]=t("hr",{class:"dropdown-divider"},null,-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:u(v=>e.confirmDelete(r),["prevent"])},"Удалить",8,Ae)]),r.blocked_at?a("",!0):(o(),n("li",qe,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:u(v=>e.confirmBlocked(r),["prevent"])},"Заблокировать",8,ze)])),r.blocked_at?(o(),n("li",We,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:u(v=>e.confirmUnBlocked(r),["prevent"])},"Разблокировать",8,Ge)])):a("",!0)])])])}),128))]),w(T,{pagination:e.usersStore.pagination,onPageChanged:e.fetchUsersByUrl},null,8,["pagination","onPageChanged"]),e.usersStore.items.length===0?(o(),n("div",He," Пользователей пока нет. ")):a("",!0),t("div",Je,[t("div",Ke,[t("div",Qe,[l[7]||(l[7]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование пользователя"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Xe,[e.selectedUser?(o(),y(V,{key:0,initialData:e.selectedUser,onSaved:e.fetchUsers},null,8,["initialData","onSaved"])):a("",!0)])])])]),t("div",Ye,[t("div",Ze,[t("div",xe,[l[8]||(l[8]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование пользователя"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",et,[e.selectedUser?(o(),y(V,{key:0,initialData:e.selectedUser,onSaved:e.fetchUsers},null,8,["initialData","onSaved"])):a("",!0)])])])]),t("div",tt,[t("div",st,[t("div",lt,[l[12]||(l[12]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование роли"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",ot,[e.selectedUser?(o(),n("form",{key:0,onSubmit:l[1]||(l[1]=u((...r)=>e.changeRole&&e.changeRole(...r),["prevent"]))},[t("div",it,[p(t("select",{"onUpdate:modelValue":l[0]||(l[0]=r=>e.selectedUser.role=r),class:"form-select",id:"role",required:""},[...l[9]||(l[9]=[t("option",{value:0},"Пользователь",-1),t("option",{value:1},"Младший администратор",-1),t("option",{value:2},"Поставщик",-1),t("option",{value:3},"Администратор",-1),t("option",{value:4},"Суперадмин",-1)])],512),[[E,e.selectedUser.role]]),l[10]||(l[10]=t("label",{for:"role"},"Роль",-1))]),l[11]||(l[11]=t("button",{type:"submit",class:"btn btn-primary w-100 p-3"}," Сохранить изменения ",-1))],32)):a("",!0)])])])]),t("div",rt,[t("div",dt,[t("div",nt,[l[13]||(l[13]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Информация о пользователе"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",at,[e.selectedUser?(o(),y(J,{key:0,user:e.selectedUser,onEdit:e.openEdit},null,8,["user","onEdit"])):a("",!0)])])])])],64))}}),ut=S(ct,[["__scopeId","data-v-e9cfbea7"]]),pt={class:"container-fluid p-3"},ft={},wt=Object.assign(ft,{__name:"UserPage",setup(s){return(e,l)=>(o(),n("div",pt,[w(L),l[0]||(l[0]=t("h4",{class:"mb-3"},"Список пользователей",-1)),w(ut)]))}});export{wt as default};
