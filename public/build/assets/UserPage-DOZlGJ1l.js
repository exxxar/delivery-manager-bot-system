import{c as n,o,b as t,i as f,t as a,F as h,e as m,r as w,h as u,w as p,v as k,J as T,E as j,k as g,d as y,a as U}from"./app-3wFJrSMW.js";import{U as N}from"./UserForm-BAmlhSGP.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as D}from"./Pagination-DGcs_Sxn.js";import{u as L,a as P}from"./useConfitmModalStore-DnuffLqD.js";import{B as R}from"./BackBtn-CDCEfx5I.js";import"./makeAxiosFactory-pnXFIPBQ.js";const O={name:"UserCard",props:{user:{type:Object,required:!0}},methods:{roleName(s){switch(s){case 0:return"Пользователь";case 1:return"Администратор";case 2:return"Поставщик";case 3:return"Старший администратор";case 4:return"Суперадмин";default:return"Неизвестно"}}}},A={class:"list-group list-group-flush"},q={class:"list-group-item"},z={class:"list-group-item"},W={class:"list-group-item"},J={class:"list-group-item"},G={class:"list-group-item"},H={class:"list-group-item"};function K(s,e,l,r,i,b){return o(),n(h,null,[t("ul",A,[t("li",q,[e[1]||(e[1]=t("strong",null,"Имя в системе:",-1)),f(" "+a(l.user.name),1)]),t("li",z,[e[2]||(e[2]=t("strong",null,"Имя из Telegram:",-1)),f(" "+a(l.user.fio_from_telegram||"не указано"),1)]),t("li",W,[e[3]||(e[3]=t("strong",null,"Email:",-1)),f(" "+a(l.user.email),1)]),t("li",J,[e[4]||(e[4]=t("strong",null,"Telegram Chat ID:",-1)),f(" "+a(l.user.telegram_chat_id||"не указан"),1)]),t("li",G,[e[5]||(e[5]=t("strong",null,"Роль:",-1)),f(" "+a(b.roleName(l.user.role)),1)]),t("li",H,[e[6]||(e[6]=t("strong",null,"Процент:",-1)),f(" "+a(l.user.percent)+"% ",1)])]),t("button",{class:"btn btn-primary w-100 p-3",onClick:e[0]||(e[0]=d=>s.$emit("edit",l.user))},"Редактировать")],64)}const Q=S(O,[["render",K]]),X={name:"UserFilter",data(){return{field_visible:[],filters:{name:"",fio_from_telegram:"",email:"",telegram_chat_id:"",role:"",percent:"",is_work:!1,email_verified:!1,blocked:!1},sort:{field:"id",direction:"asc"},sortableFields:{id:"№",name:"Имя",fio_from_telegram:"ФИО из Telegram",email:"Электронная почта",telegram_chat_id:"ID чата Telegram",role:"Роль",percent:"Процент",is_work:"Работает(да\\нет)",email_verified_at:"Дата подтверждения email",blocked_at:"Дата блокировки",created_at:"Дата создания",updated_at:"Дата обновления данных"}}},created(){let s=["name","email"];for(const e in this.sortableFields)this.field_visible[e]=s.indexOf(e)!==-1},methods:{openFilter(){new bootstrap.Modal(document.getElementById("userFilterModal")).show()},changeSort(s){this.sort.field===s?this.sort.direction=this.sort.direction==="asc"?"desc":"asc":(this.sort.field=s,this.sort.direction="asc");const e={filters:this.filters,sort:this.sort};this.$emit("apply-filters",e)},applyFilters(){const s={filters:this.filters,sort:this.sort,field_visible:this.field_visible};this.$emit("apply-filters",s),bootstrap.Modal.getInstance(document.getElementById("userFilterModal")).hide()}}},Y={class:"d-flex mb-2"},Z={class:"dropdown d-inline-block ms-2"},x={style:{"font-size":"12px"},class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown"},ee={key:0},te={key:1},se={key:2},le={class:"dropdown-menu"},oe=["onClick"],ie={class:"modal fade",id:"userFilterModal",tabindex:"-1"},re={class:"modal-dialog"},ne={class:"modal-content"},de={class:"modal-body"},ae={class:"form-floating mb-2"},me={class:"form-floating mb-2"},ce={class:"form-floating mb-2"},ue={class:"form-floating mb-2"},pe={class:"form-floating mb-2"},fe={class:"form-floating mb-2"},be={class:"form-check mb-2"},ve={class:"form-check mb-2"},he={class:"form-check mb-2"},_e=["onUpdate:modelValue","id"],ke=["for"];function ge(s,e,l,r,i,b){return o(),n("div",null,[t("div",Y,[t("button",{style:{"font-size":"12px"},class:"btn btn-secondary",onClick:e[0]||(e[0]=(...d)=>b.openFilter&&b.openFilter(...d))},"Фильтр"),t("div",Z,[t("button",x,[f(a(i.sortableFields[i.sort.field].slice(0,17))+" ",1),i.sortableFields[i.sort.field].length>17?(o(),n("span",ee,"...")):m("",!0),e[13]||(e[13]=f(" (",-1)),i.sort.direction==="asc"?(o(),n("span",te,[...e[11]||(e[11]=[t("i",{class:"fa-solid fa-arrow-down"},null,-1)])])):m("",!0),i.sort.direction==="desc"?(o(),n("span",se,[...e[12]||(e[12]=[t("i",{class:"fa-solid fa-arrow-up"},null,-1)])])):m("",!0),e[14]||(e[14]=f(") ",-1))]),t("ul",le,[(o(!0),n(h,null,w(i.sortableFields,(d,c)=>(o(),n("li",{key:c},[t("a",{class:"dropdown-item",onClick:_=>b.changeSort(c)},a(d),9,oe)]))),128))])])]),t("div",ie,[t("div",re,[t("div",ne,[t("form",{onSubmit:e[10]||(e[10]=u((...d)=>b.applyFilters&&b.applyFilters(...d),["prevent"]))},[e[26]||(e[26]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Фильтры пользователей"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",de,[t("div",ae,[p(t("input",{"onUpdate:modelValue":e[1]||(e[1]=d=>i.filters.name=d),class:"form-control",id:"nameInput",placeholder:"Имя"},null,512),[[k,i.filters.name]]),e[15]||(e[15]=t("label",{for:"nameInput"},"Имя",-1))]),t("div",me,[p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=d=>i.filters.fio_from_telegram=d),class:"form-control",id:"fioInput",placeholder:"ФИО из Telegram"},null,512),[[k,i.filters.fio_from_telegram]]),e[16]||(e[16]=t("label",{for:"fioInput"},"ФИО из Telegram",-1))]),t("div",ce,[p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=d=>i.filters.email=d),class:"form-control",id:"emailInput",placeholder:"Email"},null,512),[[k,i.filters.email]]),e[17]||(e[17]=t("label",{for:"emailInput"},"Email",-1))]),t("div",ue,[p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=d=>i.filters.telegram_chat_id=d),class:"form-control",id:"tgInput",placeholder:"Telegram chat id"},null,512),[[k,i.filters.telegram_chat_id]]),e[18]||(e[18]=t("label",{for:"tgInput"},"Telegram chat id",-1))]),t("div",pe,[p(t("select",{"onUpdate:modelValue":e[5]||(e[5]=d=>i.filters.role=d),class:"form-select",id:"roleSelect"},[...e[19]||(e[19]=[j('<option value="">Все</option><option value="0">Пользователь</option><option value="1">Администратор</option><option value="2">Поставщик</option><option value="3">Старший администратор</option><option value="4">Суперадмин</option>',6)])],512),[[T,i.filters.role]]),e[20]||(e[20]=t("label",{for:"roleSelect"},"Роль",-1))]),t("div",fe,[p(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=d=>i.filters.percent=d),class:"form-control",id:"percentInput",placeholder:"Процент"},null,512),[[k,i.filters.percent]]),e[21]||(e[21]=t("label",{for:"percentInput"},"Процент",-1))]),t("div",be,[p(t("input",{class:"form-check-input",type:"checkbox",id:"isWorkCheck","onUpdate:modelValue":e[7]||(e[7]=d=>i.filters.is_work=d)},null,512),[[g,i.filters.is_work]]),e[22]||(e[22]=t("label",{class:"form-check-label",for:"isWorkCheck"},"Работает",-1))]),t("div",ve,[p(t("input",{class:"form-check-input",type:"checkbox",id:"verifiedCheck","onUpdate:modelValue":e[8]||(e[8]=d=>i.filters.email_verified=d)},null,512),[[g,i.filters.email_verified]]),e[23]||(e[23]=t("label",{class:"form-check-label",for:"verifiedCheck"},"Email подтверждён",-1))]),t("div",he,[p(t("input",{class:"form-check-input",type:"checkbox",id:"blockedCheck","onUpdate:modelValue":e[9]||(e[9]=d=>i.filters.blocked=d)},null,512),[[g,i.filters.blocked]]),e[24]||(e[24]=t("label",{class:"form-check-label",for:"blockedCheck"},"Заблокирован",-1))]),e[25]||(e[25]=t("h6",null,"Отображаемые поля",-1)),(o(!0),n(h,null,w(i.sortableFields,(d,c)=>(o(),n("div",{key:c,class:"form-check form-switch mb-2"},[p(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":_=>i.field_visible[c]=_,id:`switch-${c}`},null,8,_e),[[g,i.field_visible[c]]]),t("label",{class:"form-check-label",for:`switch-${c}`},a(d),9,ke)]))),128))]),e[27]||(e[27]=t("div",{class:"modal-footer"},[t("button",{type:"submit",class:"btn btn-primary"},"Применить")],-1))],32)])])])])}const ye=S(X,[["render",ge]]),we={class:"list-group"},Ue={class:"fw-bold"},Se={key:0},Ce={key:1},Fe={key:0,class:"text-muted small mb-0"},Me={class:"text-primary fw-bold"},$e={key:1,class:"text-muted small mb-0"},Ie={key:2,class:"text-muted small mb-0"},Ve={key:3,class:"text-muted small mb-0"},Be=["onClick"],Ee={key:4,class:"text-muted small mb-0"},Te={key:5,class:"text-muted small mb-0"},je={key:6,class:"text-muted small mb-0"},Ne={key:7,class:"text-muted small mb-0"},De={key:8,class:"text-muted small mb-0"},Le={key:9,class:"text-muted small mb-0"},Pe={key:10,class:"text-muted small mb-0"},Re={class:"dropdown"},Oe={class:"dropdown-menu dropdown-menu-end"},Ae=["onClick"],qe=["onClick"],ze=["onClick"],We=["onClick"],Je=["onClick"],Ge=["onClick"],He={key:1},Ke=["onClick"],Qe={key:2},Xe=["onClick"],Ye={key:1,class:"alert alert-light mt-3"},Ze={class:"modal fade",id:"editUserModal",tabindex:"-1"},xe={class:"modal-dialog modal-lg"},et={class:"modal-content"},tt={class:"modal-body"},st={class:"modal fade",id:"roleSwitcherUserModal",tabindex:"-1"},lt={class:"modal-dialog modal-lg"},ot={class:"modal-content"},it={class:"modal-body"},rt={class:"form-floating mb-2"},nt={class:"modal fade",id:"viewUserModal",tabindex:"-1"},dt={class:"modal-dialog"},at={class:"modal-content"},mt={class:"modal-body"},ct={name:"UserList",props:["forSelect"],data(){return{roles:["Пользователь","Администратор","Поставщик","Старший администратор","Суперадмин"],modalStore:P(),usersStore:L(),selectedUser:null,field_visible:null}},created(){this.fetchUsers()},methods:{async fetchUsers(s=1){await this.usersStore.fetchAllByPage(s)},async getTelegramLink(s){await this.usersStore.getTelegramLink(s.id)},async fetchUsersByUrl(s){await this.usersStore.fetchByUrl(s)},applyFilter(s){this.field_visible=s.field_visible,console.log("test",this.field_visible),this.usersStore.setFilters(s.filters),this.usersStore.setSort(s.sort.field,s.sort.direction),this.usersStore.fetchFiltered()},openRoleSwitcher(s){this.selectedUser=s,new bootstrap.Modal(document.getElementById("roleSwitcherUserModal")).show()},openEdit(s){this.selectedUser=null,this.$nextTick(()=>{this.selectedUser=s;const e=bootstrap.Modal.getInstance(document.getElementById("viewUserModal"));e&&e.hide(),new bootstrap.Modal(document.getElementById("editUserModal")).show()})},confirmDelete(s){var e;this.selectedUser=s,this.modalStore.open(`Вы уверены, что хотите удалить ${(e=this.selectedUser)==null?void 0:e.name}?`,()=>this.usersStore.remove(this.selectedUser.id),()=>this.modalStore.close())},confirmUnBlocked(s){var e;this.selectedUser=s,this.modalStore.open(`Вы уверены, что хотите разблокировать ${(e=this.selectedUser)==null?void 0:e.name}?`,()=>this.usersStore.unblock(this.selectedUser.id),()=>this.modalStore.close())},confirmBlocked(s){var e;this.selectedUser=s,this.modalStore.open(`Вы уверены, что хотите заблокировать ${(e=this.selectedUser)==null?void 0:e.name}?`,()=>this.usersStore.block(this.selectedUser.id,""),()=>this.modalStore.close())},openView(s){this.selectedUser=s,new bootstrap.Modal(document.getElementById("viewUserModal")).show()},async changeRole(){await this.usersStore.updateRole(this.selectedUser.id,this.selectedUser.role);const s=bootstrap.Modal.getInstance(document.getElementById("roleSwitcherUserModal"));s&&s.hide()}}},ut=Object.assign(ct,{setup(s){return(e,l)=>(o(),n(h,null,[s.forSelect?m("",!0):(o(),y(ye,{key:0,onApplyFilters:e.applyFilter},null,8,["onApplyFilters"])),t("ul",we,[(o(!0),n(h,null,w(e.usersStore.items,r=>{var i,b,d,c,_,C,F,M,$,I,V,B,E;return o(),n("li",{key:r.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",null,[t("div",Ue,[((i=e.field_visible)!=null&&i.name,o(),n("span",Se,a(r.name),1)),(b=e.field_visible)!=null&&b.id?(o(),n("span",Ce,"(#"+a(r.id)+")",1)):m("",!0)]),((d=e.field_visible)!=null&&d.role,o(),n("p",Fe,[l[2]||(l[2]=f("Роль ",-1)),t("span",Me,a(e.roles.at(r.role||0)),1)])),(c=e.field_visible)!=null&&c.email?(o(),n("p",$e,"Почта "+a(r.email),1)):m("",!0),((_=e.field_visible)!=null&&_.phone,o(),n("p",Ie,"Телефон "+a(r.phone||"-"),1)),(C=e.field_visible)!=null&&C.telegram_chat_id?(o(),n("p",Ve,[l[3]||(l[3]=f(" ТГ id ",-1)),t("a",{href:"javascript:void(0)",onClick:u(v=>e.getTelegramLink(r),["prevent"])},a(r.telegram_chat_id||"Не указано"),9,Be)])):m("",!0),(F=e.field_visible)!=null&&F.role?(o(),n("p",Ee,a(e.roles[r.role||0]||"неизвестная роль"),1)):m("",!0),(M=e.field_visible)!=null&&M.percent?(o(),n("p",Te,"Процент за работу "+a(r.percent)+"%",1)):m("",!0),($=e.field_visible)!=null&&$.is_work?(o(),n("p",je,"Статус работы "+a(r.is_work?"работает":"не работает"),1)):m("",!0),(I=e.field_visible)!=null&&I.email_verified_at?(o(),n("p",Ne,"Дата верификации почты "+a(r.email_verified_at),1)):m("",!0),(V=e.field_visible)!=null&&V.blocked_at?(o(),n("p",De,"Дата блокировки "+a(r.blocked_at),1)):m("",!0),(B=e.field_visible)!=null&&B.created_at?(o(),n("p",Le,"Дата создания пользователя "+a(r.created_at),1)):m("",!0),(E=e.field_visible)!=null&&E.updated_at?(o(),n("p",Pe,"Дата последнего обновления данных пользователя "+a(r.updated_at),1)):m("",!0)]),t("div",Re,[l[7]||(l[7]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",Oe,[s.forSelect?(o(),n(h,{key:0},[t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.$emit("select",r),["prevent"])},"Выбрать",8,Ae)]),l[4]||(l[4]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1))],64)):m("",!0),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.openRoleSwitcher(r),["prevent"])},"Сменить роль",8,qe)]),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.openEdit(r),["prevent"])},"Редактировать",8,ze)]),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.openView(r),["prevent"])},"Просмотреть",8,We)]),l[5]||(l[5]=t("hr",{class:"dropdown-divider"},null,-1)),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.getTelegramLink(r),["prevent"])},"Получить ссылку на телеграм",8,Je)]),l[6]||(l[6]=t("hr",{class:"dropdown-divider"},null,-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:u(v=>e.confirmDelete(r),["prevent"])},"Удалить",8,Ge)]),r.blocked_at?m("",!0):(o(),n("li",He,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:u(v=>e.confirmBlocked(r),["prevent"])},"Заблокировать",8,Ke)])),r.blocked_at?(o(),n("li",Qe,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:u(v=>e.confirmUnBlocked(r),["prevent"])},"Разблокировать",8,Xe)])):m("",!0)])])])}),128))]),U(D,{pagination:e.usersStore.pagination,onPageChanged:e.fetchUsersByUrl},null,8,["pagination","onPageChanged"]),e.usersStore.items.length===0?(o(),n("div",Ye," Пользователей пока нет. ")):m("",!0),t("div",Ze,[t("div",xe,[t("div",et,[l[8]||(l[8]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование пользователя"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",tt,[e.selectedUser?(o(),y(N,{key:0,initialData:e.selectedUser,onSaved:e.fetchUsers},null,8,["initialData","onSaved"])):m("",!0)])])])]),t("div",st,[t("div",lt,[t("div",ot,[l[12]||(l[12]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование роли"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",it,[e.selectedUser?(o(),n("form",{key:0,onSubmit:l[1]||(l[1]=u((...r)=>e.changeRole&&e.changeRole(...r),["prevent"]))},[t("div",rt,[p(t("select",{"onUpdate:modelValue":l[0]||(l[0]=r=>e.selectedUser.role=r),class:"form-select",id:"role",required:""},[...l[9]||(l[9]=[t("option",{value:0},"Пользователь",-1),t("option",{value:1},"Администратор",-1),t("option",{value:2},"Поставщик",-1),t("option",{value:3},"Старший администратор",-1),t("option",{value:4},"Суперадмин",-1)])],512),[[T,e.selectedUser.role]]),l[10]||(l[10]=t("label",{for:"role"},"Роль",-1))]),l[11]||(l[11]=t("button",{type:"submit",class:"btn btn-primary w-100 p-3"}," Сохранить изменения ",-1))],32)):m("",!0)])])])]),t("div",nt,[t("div",dt,[t("div",at,[l[13]||(l[13]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Информация о пользователе"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",mt,[e.selectedUser?(o(),y(Q,{key:0,user:e.selectedUser,onEdit:e.openEdit},null,8,["user","onEdit"])):m("",!0)])])])])],64))}}),pt=S(ut,[["__scopeId","data-v-5bd6cb71"]]),ft={class:"container-fluid p-3"},bt={},Ut=Object.assign(bt,{__name:"UserPage",setup(s){return(e,l)=>(o(),n("div",ft,[U(R),l[0]||(l[0]=t("h4",{class:"mb-3"},"Список пользователей",-1)),U(pt)]))}});export{Ut as default};
