import{c as a,o as l,b as t,e as d,i as r,t as m,F as u,f as S,w as g,v as b,k,a as w,h,r as _,d as v}from"./app-F_UjdZn9.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as C}from"./Pagination-DoEh_yg4.js";import{U as M}from"./UserForm-CcdPy6bq.js";import{_ as I}from"./AdminList-BjsPqI3i.js";import{m as c}from"./makeAxiosFactory-CCvZFVQG.js";const U={name:"AgentInfo",props:{agent:{type:Object,required:!0}}},B={class:"list-group list-group-flush"},D={class:"list-group-item"},P={class:"list-group-item"},V={class:"list-group-item"},T={class:"list-group-item"},F={class:"list-group-item"},L={key:0,class:"list-group-item"};function N(o,s,e,n,i,y){var f;return l(),a(u,null,[t("ul",B,[t("li",D,[s[1]||(s[1]=t("strong",null,"ID:",-1)),r(" "+m(e.agent.id),1)]),t("li",P,[s[2]||(s[2]=t("strong",null,"Имя:",-1)),r(" "+m(e.agent.name),1)]),t("li",V,[s[3]||(s[3]=t("strong",null,"Телефон:",-1)),r(" "+m(e.agent.phone),1)]),t("li",T,[s[4]||(s[4]=t("strong",null,"Email:",-1)),r(" "+m(e.agent.email),1)]),t("li",F,[s[5]||(s[5]=t("strong",null,"Регион:",-1)),r(" "+m(e.agent.region),1)]),e.agent.in_learning?(l(),a("li",L,[s[6]||(s[6]=t("strong",null,"Обучается у: ",-1)),e.agent.mentor?(l(),a(u,{key:0},[r(m(((f=e.agent.mentor)==null?void 0:f.name)||"-"),1)],64)):(l(),a(u,{key:1},[r(" Наставник не указан ")],64))])):d("",!0)]),t("button",{class:"btn btn-primary p-3 w-100",onClick:s[0]||(s[0]=Vt=>o.$emit("edit",e.agent))},"Редактировать")],64)}const O=E(U,[["render",N]]),p="/bot-api/agents",A=S("agents",{state:()=>({items:[],loading:!1,error:null}),getters:{byId:o=>s=>o.items.find(e=>e.id===s)},actions:{async fetchAll(){this.loading=!0,this.error=null;try{const{data:o}=await c(`${p}`,"GET");this.items=o}catch(o){this.error=(o==null?void 0:o.message)||"Failed to load agents"}finally{this.loading=!1}},async fetchAllByPage(o=1){const{data:s}=await c(`${p}?page=${o}`,"GET");this.items=s.data,this.pagination=s},async fetchByUrl(o){const{data:s}=await c(o,"GET");this.items=s.data,this.pagination=s},async fetchOne(o){try{const{data:s}=await c(`${p}/${o}`,"GET");return s}catch(s){throw this.error=(s==null?void 0:s.message)||"Failed to load agent",s}},async create(o){const{data:s}=await c(`${p}`,"POST",o);return this.items.push(s),s},async update(o,s){const{data:e}=await c(`${p}/${o}`,"PUT",s),n=this.items.findIndex(i=>i.id===o);return n!==-1&&(this.items[n]=e),e},async remove(o){await c(`${p}/${o}`,"DELETE"),this.items=this.items.filter(s=>s.id!==o)},async downloadSelReport(o){var s,e;this.loading=!0,this.error=null;try{const{data:n}=await c(`${p}/download-self-report`,"POST",o);return n}catch(n){throw this.error=((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.message)??"Ошибка отправки отчёта",n}finally{this.loading=!1}}}}),j={class:"form-floating mb-2"},q={class:"form-floating mb-2"},G={class:"form-floating mb-2"},z={class:"form-floating mb-2"},R={class:"form-check form-switch mb-2"},W={class:"form-check-label",for:"in_learning"},H={key:0,class:"fw-bold text-primary"},J={key:1,class:"fw-bold text-primary"},K={class:"input-group mb-2"},Q={class:"form-floating flex-grow-1"},X=["value"],Y={class:"form-check form-switch mb-2"},Z={class:"form-floating mb-2"},x={class:"form-floating mb-2"},tt={name:"AgentForm",props:{initialData:{type:Object,default:null}},data(){return{agentStore:A(),isEdit:!1,configLearningPeriod:!1,tab:"main",form:{name:"",phone:"",email:"",region:"",start_learning_date:null,end_learning_date:null,in_learning:!1},mentorName:null}},created(){var o;this.initialData&&(this.form={...this.initialData},this.isEdit=!0,this.mentorName=((o=this.initialData.mentor)==null?void 0:o.name)||"")},methods:{selectAdmin(o){this.form.mentor_id=o.id,this.mentorName=o.name,this.tab="main"},async submitForm(){this.isEdit?this.agentStore.update(this.form.id,this.form):this.agentStore.create(this.form),this.$emit("callback")}}},$=Object.assign(tt,{setup(o){return(s,e)=>(l(),a("form",{onSubmit:e[10]||(e[10]=h((...n)=>s.submitForm&&s.submitForm(...n),["prevent"]))},[s.tab==="main"?(l(),a(u,{key:0},[t("div",j,[g(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>s.form.name=n),type:"text",class:"form-control",id:"name",placeholder:"Имя",required:""},null,512),[[b,s.form.name]]),e[11]||(e[11]=t("label",{for:"name"},"Имя",-1))]),t("div",q,[g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>s.form.phone=n),type:"tel",class:"form-control",id:"phone",placeholder:"Телефон",required:""},null,512),[[b,s.form.phone]]),e[12]||(e[12]=t("label",{for:"phone"},"Телефон",-1))]),t("div",G,[g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>s.form.email=n),type:"email",class:"form-control",id:"email",placeholder:"Email",required:""},null,512),[[b,s.form.email]]),e[13]||(e[13]=t("label",{for:"email"},"Email",-1))]),t("div",z,[g(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>s.form.region=n),type:"text",class:"form-control",id:"region",placeholder:"Регион"},null,512),[[b,s.form.region]]),e[14]||(e[14]=t("label",{for:"region"},"Регион",-1))]),t("div",R,[g(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>s.form.in_learning=n),class:"form-check-input",type:"checkbox",role:"switch",id:"in_learning"},null,512),[[k,s.form.in_learning]]),t("label",W,[e[15]||(e[15]=r("На обучении ",-1)),s.form.in_learning?(l(),a("span",H,"включено")):(l(),a("span",J,"выключено"))])]),s.form.in_learning?(l(),a(u,{key:0},[e[21]||(e[21]=t("p",{class:"alert alert-info mb-2"},"Назначение ответственного за обучение (наставника)",-1)),t("div",K,[t("div",Q,[t("input",{type:"text",class:"form-control",id:"admin",value:s.mentorName,placeholder:"Администратор",readonly:""},null,8,X),e[16]||(e[16]=t("label",{for:"admin"},"Старший администратор",-1))]),t("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:e[5]||(e[5]=n=>s.tab="admin")},"Выбрать ")]),t("div",Y,[g(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>s.configLearningPeriod=n),class:"form-check-input",type:"checkbox",role:"switch",id:"configLearningPeriod"},null,512),[[k,s.configLearningPeriod]]),e[17]||(e[17]=t("label",{class:"form-check-label",for:"configLearningPeriod"},"Настройка периода обучения ",-1))]),s.configLearningPeriod?(l(),a(u,{key:0},[e[20]||(e[20]=t("p",{class:"alert alert-info mb-2"},"Период настраивается автоматически после того как вы задали что Админстратор находится на обучении",-1)),t("div",Z,[g(t("input",{"onUpdate:modelValue":e[7]||(e[7]=n=>s.form.start_learning_date=n),type:"date",class:"form-control",id:"sale_date"},null,512),[[b,s.form.start_learning_date]]),e[18]||(e[18]=t("label",{for:"sale_date"},"Дата начала обучения",-1))]),t("div",x,[g(t("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>s.form.end_learning_date=n),type:"date",class:"form-control",id:"sale_date"},null,512),[[b,s.form.end_learning_date]]),e[19]||(e[19]=t("label",{for:"sale_date"},"Дата окончания обучения",-1))])],64)):d("",!0)],64)):d("",!0)],64)):d("",!0),s.tab==="admin"?(l(),a(u,{key:1},[t("button",{onClick:e[9]||(e[9]=n=>s.tab="main"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"0px","z-index":"100"}},"Назад "),w(I,{"for-select":!0,onSelect:s.selectAdmin},null,8,["onSelect"])],64)):d("",!0),e[22]||(e[22]=t("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Сохранить",-1))],32))}}),et={class:"form-floating mb-3"},st={class:"list-group"},ot=["onClick"],nt={class:"fw-bold"},lt={key:0,class:"badge bg-success"},it={key:1,class:"small text-success"},at=["onClick"],dt={class:"text-muted"},rt={class:"dropdown"},mt={class:"dropdown-menu dropdown-menu-end"},ut={key:0},gt=["onClick"],ft=["onClick"],ct=["onClick"],pt=["onClick"],bt={class:"modal fade",id:"agentInfoModal",tabindex:"-1"},ht={class:"modal-dialog"},yt={class:"modal-content"},vt={class:"modal-body"},kt={class:"modal fade",id:"deleteModal",tabindex:"-1"},wt={class:"modal-dialog"},At={class:"modal-content"},$t={class:"modal-body"},St={class:"modal-footer"},_t={class:"modal fade",id:"editAgentModal",tabindex:"-1"},Et={class:"modal-dialog modal-lg"},Ct={class:"modal-content"},Mt={class:"modal-body"},It={class:"modal fade",id:"editUserModal",tabindex:"-1"},Ut={class:"modal-dialog modal-lg"},Bt={class:"modal-content"},Dt={class:"modal-body"},Pt={name:"SupplierListWithDropdown",components:{AgentForm:$},props:["forSelect"],data(){return{search:"",selectedAdmin:null,agentStore:A(),selectedAgent:null}},computed:{filteredAgents(){if(!this.search)return this.agentStore.items||[];const o=this.search.toLowerCase();return this.agentStore.items.filter(s=>Object.values(s).some(e=>e?String(e).toLowerCase().includes(o):!1))}},created(){this.fetchAgents()},methods:{openEdit(o){this.selectedAdmin=null,this.$nextTick(()=>{this.selectedAdmin=o,new bootstrap.Modal(document.getElementById("editUserModal")).show()})},async fetchAgents(o=1){await this.agentStore.fetchAllByPage(o)},async fetchAgentsByUrl(o){await this.agentStore.fetchByUrl(o)},selectAgent(o){this.forSelect&&this.$emit("select",o)},openAgentInfo(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("agentInfoModal")).show()},openPercents(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("percentsModal")).show()},confirmDelete(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("deleteModal")).show()},async deleteAgent(){try{await this.agentStore.remove(this.selectedAgent.id),bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide()}catch(o){console.error("Ошибка удаления:",o)}},openEditAgent(o){this.selectedAgent=null,this.$nextTick(()=>{this.selectedAgent=o,new bootstrap.Modal(document.getElementById("editAgentModal")).show()})}}},qt=Object.assign(Pt,{setup(o){return(s,e)=>{var n;return l(),a(u,null,[t("div",et,[g(t("input",{type:"search","onUpdate:modelValue":e[0]||(e[0]=i=>s.search=i),class:"form-control",id:"searchInput",placeholder:"Поиск..."},null,512),[[b,s.search]]),e[2]||(e[2]=t("label",{for:"searchInput"},"Поиск",-1))]),t("ul",st,[(l(!0),a(u,null,_(s.filteredAgents,i=>{var y;return l(),a("li",{key:i.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",{onClick:f=>s.selectAgent(i)},[t("div",nt,[i.in_learning?(l(),a("span",lt,[...e[3]||(e[3]=[t("i",{class:"fa-solid fa-user-graduate"},null,-1)])])):d("",!0),r(" "+m(i.name)+" ",1),i.in_learning&&!o.forSelect?(l(),a("span",it,[i.mentor?(l(),a("a",{key:0,onClick:f=>s.openEdit(i.mentor),href:"javascript:void(0)"},"("+m(((y=i.mentor)==null?void 0:y.name)||"-")+")",9,at)):(l(),a(u,{key:1},[r(" Наставник не указан ")],64))])):d("",!0)]),t("small",dt,m(i.phone)+" | "+m(i.email),1)],8,ot),t("div",rt,[e[5]||(e[5]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",mt,[o.forSelect?(l(),a("li",ut,[t("a",{class:"dropdown-item",href:"#",onClick:h(f=>s.selectAgent(i),["prevent"])},"Выбрать",8,gt)])):d("",!0),o.forSelect?d("",!0):(l(),a(u,{key:1},[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:h(f=>s.openAgentInfo(i),["prevent"])},"Просмотр",8,ft)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:h(f=>s.openEditAgent(i),["prevent"])},"Редактировать",8,ct)]),e[4]||(e[4]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"#",onClick:h(f=>s.confirmDelete(i),["prevent"])},"Удалить",8,pt)])],64))])])])}),128))]),w(C,{pagination:s.agentStore.pagination,onPageChanged:s.fetchAgentsByUrl},null,8,["pagination","onPageChanged"]),t("div",bt,[t("div",ht,[t("div",yt,[e[6]||(e[6]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Информация"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",vt,[s.selectedAgent?(l(),v(O,{key:0,agent:s.selectedAgent},null,8,["agent"])):d("",!0)])])])]),t("div",kt,[t("div",wt,[t("div",At,[e[10]||(e[10]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title text-danger"},"Удаление"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",$t,[e[7]||(e[7]=r(" Вы уверены, что хотите удалить ",-1)),t("strong",null,m((n=s.selectedAgent)==null?void 0:n.name),1),e[8]||(e[8]=r("? ",-1))]),t("div",St,[e[9]||(e[9]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),t("button",{type:"button",class:"btn btn-danger",onClick:e[1]||(e[1]=(...i)=>s.deleteAgent&&s.deleteAgent(...i))},"Удалить")])])])]),t("div",_t,[t("div",Et,[t("div",Ct,[e[11]||(e[11]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Mt,[s.selectedAgent?(l(),v($,{key:0,initialData:s.selectedAgent},null,8,["initialData"])):d("",!0)])])])]),t("div",It,[t("div",Ut,[t("div",Bt,[e[12]||(e[12]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование администратора"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Dt,[s.selectedAdmin?(l(),v(M,{key:0,initialData:s.selectedAdmin,onSaved:s.fetchData},null,8,["initialData","onSaved"])):d("",!0)])])])])],64)}}});export{qt as _,$ as a,A as u};
