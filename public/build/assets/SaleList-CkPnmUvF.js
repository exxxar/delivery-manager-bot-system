import{c as d,o as i,b as e,i as u,e as a,t as r,h as y,F as p,w as m,J as $,E as J,k as E,v as g,r as L,a as h,n as I,d as P}from"./app-DAC7qauX.js";import{a as G,u as T,_ as H}from"./SaleForm-DUBi5D9b.js";import{P as K}from"./Pagination-CyVtRdhf.js";import{_ as Q,u as R}from"./AgentList-CM5N2h7W.js";import{_ as W}from"./SupplierList-DO_o_Ko5.js";import{a as X}from"./ProductList-tzPtNxyH.js";import{_ as Y}from"./ProductCategoryList-Ctzn7L6T.js";import{u as N}from"./users-lQK4cwef.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Z}from"./useConfitmModalStore-BOpL4kq5.js";const x={class:"mb-2"},tt={class:"dropdown d-inline-block ms-2"},et={style:{"font-size":"12px"},class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown"},st={key:0},lt={key:1},ot={key:2},nt={class:"dropdown-menu"},it={class:"modal fade",id:"saleFilterModal",tabindex:"-1"},dt={class:"modal-dialog modal-fullscreen"},at={class:"modal-body"},rt={class:"form-floating mb-2"},ut={key:0,class:"form-check form-switch mb-2"},mt={class:"form-floating mb-2"},pt={class:"form-floating mb-2"},ft={class:"form-floating mb-2"},bt={class:"form-floating mb-2"},yt={class:"form-floating mb-2"},ct={class:"form-floating mb-2"},gt={class:"form-floating mb-2"},vt={class:"input-group mb-2"},kt={class:"form-floating flex-grow-1"},St=["value"],Ct={class:"input-group mb-2"},ht={class:"form-floating flex-grow-1"},wt=["value"],$t={class:"input-group mb-2"},Ft={class:"form-floating flex-grow-1"},Pt=["value"],It={class:"input-group mb-2"},Tt={class:"form-floating flex-grow-1"},Dt=["value"],_t={class:"input-group mb-2"},Mt={class:"form-floating flex-grow-1"},Vt=["value"],Ut=["onUpdate:modelValue","id"],Bt=["for"],qt={class:"form-floating mb-2"},At={class:"form-floating mb-3"},jt={name:"SaleFilterForm",data(){return{page:0,size:20,onlyMyTask:!1,needCompletedTask:!1,userStore:N(),salesStore:T(),tab:"filter",titleMap:{agent:"Выбор младшего админа",customer:"Выбор клиента",supplier:"Выбор поставщика"},selectedAgent:null,selectedProduct:null,selectedProductCategory:null,selectedSupplier:null,selectedCustomer:null,field_visible:[],sortableFields:{id:"№",title:"Название",description:"Описание",status:"Статус",due_date:"Дата назначения встречи",sale_date:"Дата продажи",payment_type:"Тип оплаты",actual_delivery_date:"Фактическая дата доставки",quantity:"Доставляемое число товара",total_price:"Сумма заказа",agent_id:"Торговый представитель",customer_id:"Клиент",supplier_id:"Поставщик",created_by_id:"Создатель заявки",product_id:"Продукт"},filters:{number:"",title:"",payment_type:null,description:"",status:"",date_type:null,date_from:"",date_to:"",agent_id:"",customer_id:"",supplier_id:"",created_by_id:"",product_id:"",product_category_id:"",quantity:"",total_price:""}}},computed:{role(){var l;return((l=this.userStore.self)==null?void 0:l.role)??0}},mounted(){let l=["title","description","status","due_date"];for(const s in this.sortableFields)this.field_visible[s]=l.indexOf(s)!==-1;this.tab="filter"},methods:{applyFilters(){const l={...this.filters,size:this.size,page:this.page,only_my_tasks:this.onlyMyTask,field_visible:this.field_visible},s=bootstrap.Modal.getInstance(document.getElementById("saleFilterModal"));s&&s.hide(),this.$emit("apply-filters",l)},cancelAgent(){this.selectedAgent=null,this.$nextTick(()=>{this.filters.agent_id=null})},selectAgent(l){this.selectedAgent=null,this.$nextTick(()=>{this.selectedAgent=l,this.filters.agent_id=(l==null?void 0:l.id)||null,this.tab="filter"})},openFilter(){new bootstrap.Modal(document.getElementById("saleFilterModal")).show()},cancelCustomer(){this.selectedCustomer=null,this.$nextTick(()=>{this.filters.customer_id=null})},selectCustomer(l){this.selectedCustomer=null,this.$nextTick(()=>{this.selectedCustomer=l,this.filters.customer_id=(l==null?void 0:l.id)||null,this.tab="filter"})},cancelProductCategory(){this.selectedProductCategory=null,this.$nextTick(()=>{this.filters.product_category_id=null})},selectProductCategory(l){console.log(l),this.selectedProductCategory=null,this.$nextTick(()=>{this.selectedProductCategory=l,this.filters.product_category_id=(l==null?void 0:l.id)||null,this.tab="filter"})},cancelProduct(){this.selectedProduct=null,this.$nextTick(()=>{this.filters.product_id=null})},selectProduct(l){this.selectedProduct=null,this.$nextTick(()=>{this.selectedProduct=l,this.filters.product_id=(l==null?void 0:l.id)||null,this.tab="filter"})},cancelSupplier(){this.selectedSupplier=null,this.$nextTick(()=>{this.filters.supplier_id=null})},selectSupplier(l){this.selectedSupplier=null,this.$nextTick(()=>{this.selectedSupplier=l,this.filters.supplier_id=(l==null?void 0:l.id)||null,this.tab="filter"})},changeSort(l){const s=this.salesStore.sort,t=s.field===l&&s.direction==="asc"?"desc":"asc";this.salesStore.setSort(l,t),this.salesStore.fetchFiltered()},clearFilters(){const l={number:"",title:"",description:"",status:"",date_type:null,date_from:"",date_to:"",agent_id:"",customer_id:"",product_id:"",product_category_id:"",supplier_id:"",created_by_id:"",quantity:"",total_price:""};this.size=20,this.page=0,this.onlyMyTask=!1;let s=["title","description","status","due_date"];for(const t in this.sortableFields)this.field_visible[t]=s.indexOf(t)!==-1;this.filters=l}}},zt=Object.assign(jt,{setup(l){return(s,t)=>{var n,c,f,v,k;return i(),d(p,null,[e("div",x,[e("button",{style:{"font-size":"12px"},class:"btn btn-secondary",onClick:t[0]||(t[0]=(...o)=>s.openFilter&&s.openFilter(...o))},"Фильтр "),e("div",tt,[e("button",et,[u(r(s.sortableFields[s.salesStore.sort.field].slice(0,17))+" ",1),s.sortableFields[s.salesStore.sort.field].length>17?(i(),d("span",st,"...")):a("",!0),t[45]||(t[45]=u(" (",-1)),s.salesStore.sort.direction==="asc"?(i(),d("span",lt,[...t[43]||(t[43]=[e("i",{class:"fa-solid fa-arrow-down"},null,-1)])])):a("",!0),s.salesStore.sort.direction==="desc"?(i(),d("span",ot,[...t[44]||(t[44]=[e("i",{class:"fa-solid fa-arrow-up"},null,-1)])])):a("",!0),t[46]||(t[46]=u(") ",-1))]),e("ul",nt,[e("li",null,[e("a",{class:"dropdown-item",onClick:t[1]||(t[1]=o=>s.changeSort("title"))},"Название")]),e("li",null,[e("a",{class:"dropdown-item",onClick:t[2]||(t[2]=o=>s.changeSort("status"))},"Статус")]),e("li",null,[e("a",{class:"dropdown-item",onClick:t[3]||(t[3]=o=>s.changeSort("sale_date"))},"Дата продажи")]),e("li",null,[e("a",{class:"dropdown-item",onClick:t[4]||(t[4]=o=>s.changeSort("total_price"))},"Сумма")])])])]),e("div",it,[e("div",dt,[e("form",{onSubmit:t[42]||(t[42]=y((...o)=>s.applyFilters&&s.applyFilters(...o),["prevent"])),class:"modal-content"},[t[73]||(t[73]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Фильтры"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",at,[s.tab==="filter"?(i(),d(p,{key:0},[e("div",rt,[m(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.filters.status=o),class:"form-select",id:"statusSelect"},[...t[47]||(t[47]=[J('<option value="">Все</option><option value="pending">В ожидании</option><option value="completed">Завершено</option><option value="delivered">Доставляется</option><option value="rejected">Отклонено</option>',5)])],512),[[$,s.filters.status]]),t[48]||(t[48]=e("label",{for:"statusSelect"},"Статус",-1))]),s.role>=3?(i(),d("div",ut,[m(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=o=>s.onlyMyTask=o),id:"only-my-tasks"},null,512),[[E,s.onlyMyTask]]),t[49]||(t[49]=e("label",{class:"form-check-label",for:"only-my-tasks"}," Только мои сделки ",-1))])):a("",!0),e("div",mt,[m(e("input",{class:"form-control","onUpdate:modelValue":t[7]||(t[7]=o=>s.filters.number=o),id:"titleInput",placeholder:"Номер сделки"},null,512),[[g,s.filters.number]]),t[50]||(t[50]=e("label",{for:"titleInput"},"Номер сделки",-1))]),e("div",pt,[m(e("input",{class:"form-control","onUpdate:modelValue":t[8]||(t[8]=o=>s.filters.title=o),id:"titleInput",placeholder:"Название"},null,512),[[g,s.filters.title]]),t[51]||(t[51]=e("label",{for:"titleInput"},"Название",-1))]),e("div",ft,[m(e("input",{class:"form-control","onUpdate:modelValue":t[9]||(t[9]=o=>s.filters.description=o),id:"descInput",placeholder:"Описание"},null,512),[[g,s.filters.description]]),t[52]||(t[52]=e("label",{for:"descInput"},"Описание",-1))]),e("div",bt,[m(e("select",{id:"itemsPerPage",class:"form-select","onUpdate:modelValue":t[10]||(t[10]=o=>s.filters.payment_type=o)},[...t[53]||(t[53]=[e("option",{value:null},"Любой тип оплаты",-1),e("option",{value:"0"},"Наличная оплата",-1),e("option",{value:"1"},"Безналичная оплата",-1)])],512),[[$,s.filters.payment_type]]),t[54]||(t[54]=e("label",{for:"itemsPerPage"},"Тип оплаты",-1))]),e("div",yt,[m(e("select",{"onUpdate:modelValue":t[11]||(t[11]=o=>s.filters.date_type=o),class:"form-select",id:"dateTypeSelect"},[...t[55]||(t[55]=[e("option",{value:null},"Не имеет значения",-1),e("option",{value:"2"},"Дата оплаты заказа",-1),e("option",{value:"0"},"Дата создания задачи",-1),e("option",{value:"4"},"Дата доставки фактическая",-1)])],512),[[$,s.filters.date_type]]),t[56]||(t[56]=e("label",{for:"dateTypeSelect"},"Тип даты",-1))]),e("div",ct,[m(e("input",{type:"date","onUpdate:modelValue":t[12]||(t[12]=o=>s.filters.date_from=o),class:"form-control",id:"dateFromInput"},null,512),[[g,s.filters.date_from]]),t[57]||(t[57]=e("label",{for:"dateFromInput"},"Дата от",-1))]),e("div",gt,[m(e("input",{type:"date","onUpdate:modelValue":t[13]||(t[13]=o=>s.filters.date_to=o),class:"form-control",id:"dateToInput"},null,512),[[g,s.filters.date_to]]),t[58]||(t[58]=e("label",{for:"dateToInput"},"Дата до",-1))]),s.role>=3?(i(),d(p,{key:1},[e("div",vt,[e("div",kt,[e("input",{type:"text",disabled:"",onChange:t[14]||(t[14]=o=>s.selectedAgent=null),value:((n=s.selectedAgent)==null?void 0:n.name)||"не указан",class:"form-control",id:"agentInput",placeholder:"Агент"},null,40,St),t[59]||(t[59]=e("label",{for:"agentInput"},"Администратор",-1))]),s.selectedAgent?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-light text-primary",onClick:t[15]||(t[15]=(...o)=>s.cancelAgent&&s.cancelAgent(...o))},[...t[60]||(t[60]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):a("",!0),e("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:t[16]||(t[16]=o=>s.tab="agent")}," Выбрать ")]),e("div",Ct,[e("div",ht,[e("input",{class:"form-control",type:"text",disabled:"",onChange:t[17]||(t[17]=o=>s.selectedCustomer=null),value:((c=s.selectedCustomer)==null?void 0:c.name)||"не указан",id:"customerInput",placeholder:"Клиент"},null,40,wt),t[61]||(t[61]=e("label",{for:"customerInput"},"Клиент",-1))]),s.selectedCustomer?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-light text-primary",onClick:t[18]||(t[18]=(...o)=>s.cancelCustomer&&s.cancelCustomer(...o))},[...t[62]||(t[62]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):a("",!0),e("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:t[19]||(t[19]=o=>s.tab="customer")}," Выбрать ")])],64)):a("",!0),e("div",$t,[e("div",Ft,[e("input",{class:"form-control",type:"text",disabled:"",onChange:t[20]||(t[20]=o=>s.selectedSupplier=null),value:((f=s.selectedSupplier)==null?void 0:f.name)||"не указан",id:"supplierInput",placeholder:"Поставщик"},null,40,Pt),t[63]||(t[63]=e("label",{for:"supplierInput"},"Поставщик",-1))]),s.selectedSupplier?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-light text-primary",onClick:t[21]||(t[21]=(...o)=>s.cancelSupplier&&s.cancelSupplier(...o))},[...t[64]||(t[64]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):a("",!0),e("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:t[22]||(t[22]=o=>s.tab="supplier")}," Выбрать ")]),e("div",It,[e("div",Tt,[e("input",{type:"text",disabled:"",onChange:t[23]||(t[23]=o=>s.selectedProduct=null),value:((v=s.selectedProduct)==null?void 0:v.name)||"не указан",class:"form-control",id:"agentInput",placeholder:"Агент"},null,40,Dt),t[65]||(t[65]=e("label",{for:"agentInput"},"Продукт",-1))]),s.selectedProduct?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-light text-primary",onClick:t[24]||(t[24]=(...o)=>s.cancelProduct&&s.cancelProduct(...o))},[...t[66]||(t[66]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):a("",!0),e("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:t[25]||(t[25]=o=>s.tab="product")}," Выбрать ")]),e("div",_t,[e("div",Mt,[e("input",{type:"text",disabled:"",onChange:t[26]||(t[26]=o=>s.selectedProductCategory=null),value:((k=s.selectedProductCategory)==null?void 0:k.name)||"не указана",class:"form-control",id:"agentInput",placeholder:"Агент"},null,40,Vt),t[67]||(t[67]=e("label",{for:"agentInput"},"Категория товара",-1))]),s.selectedProductCategory?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-light text-primary",onClick:t[27]||(t[27]=(...o)=>s.cancelProductCategory&&s.cancelProductCategory(...o))},[...t[68]||(t[68]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])):a("",!0),e("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:t[28]||(t[28]=o=>s.tab="product_category")}," Выбрать ")]),s.role>=3?(i(),d(p,{key:2},[t[69]||(t[69]=e("h6",null,"Отображаемые поля",-1)),(i(!0),d(p,null,L(s.sortableFields,(o,b)=>(i(),d("div",{key:b,class:"form-check form-switch mb-2"},[m(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":S=>s.field_visible[b]=S,id:`switch-${b}`},null,8,Ut),[[E,s.field_visible[b]]]),e("label",{class:"form-check-label",for:`switch-${b}`},r(o),9,Bt)]))),128))],64)):a("",!0),e("div",qt,[m(e("select",{id:"itemsPerPage",class:"form-select","onUpdate:modelValue":t[29]||(t[29]=o=>s.size=o)},[...t[70]||(t[70]=[e("option",{value:"10"},"10",-1),e("option",{value:"20"},"20",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)])],512),[[$,s.size]]),t[71]||(t[71]=e("label",{for:"itemsPerPage"},"Элементов на странице",-1))]),e("div",At,[m(e("input",{type:"number",id:"pageNumber",class:"form-control","onUpdate:modelValue":t[30]||(t[30]=o=>s.page=o),min:"0"},null,512),[[g,s.page]]),t[72]||(t[72]=e("label",{for:"pageNumber"},"Номер страницы",-1))]),e("button",{type:"button",onClick:t[31]||(t[31]=(...o)=>s.clearFilters&&s.clearFilters(...o)),class:"btn btn-outline-light text-secondary mb-2 w-100 p-3"},"Очистить фильтры ")],64)):a("",!0),s.tab==="agent"?(i(),d(p,{key:1},[e("button",{class:"btn btn-secondary my-3",onClick:t[32]||(t[32]=o=>s.tab="filter")},"Назад "),s.selectedAgent!=null?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-secondary p-3 w-100 mb-2",onClick:t[33]||(t[33]=o=>s.selectAgent(null))},"Отменить выбор ")):a("",!0),h(Q,{"for-select":!0,onSelect:s.selectAgent},null,8,["onSelect"])],64)):a("",!0),s.tab==="product"?(i(),d(p,{key:2},[e("button",{class:"btn btn-secondary my-3",onClick:t[34]||(t[34]=o=>s.tab="filter")},"Назад "),s.selectedProduct!=null?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-secondary p-3 w-100 mb-2",onClick:t[35]||(t[35]=o=>s.selectProduct(null))},"Отменить выбор ")):a("",!0),h(X,{"for-select":!0,onSelect:s.selectProduct},null,8,["onSelect"])],64)):a("",!0),s.tab==="product_category"?(i(),d(p,{key:3},[e("button",{class:"btn btn-secondary my-3",onClick:t[36]||(t[36]=o=>s.tab="filter")},"Назад "),s.selectedProductCategory!=null?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-secondary p-3 w-100 mb-2",onClick:t[37]||(t[37]=o=>s.selectProductCategory(null))},"Отменить выбор ")):a("",!0),h(Y,{"for-select":!0,onSelect:s.selectProductCategory},null,8,["onSelect"])],64)):a("",!0),s.tab==="customer"?(i(),d(p,{key:4},[e("button",{class:"btn btn-secondary my-3",onClick:t[38]||(t[38]=o=>s.tab="filter")},"Назад "),s.selectedCustomer!=null?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-secondary p-3 w-100 mb-2",onClick:t[39]||(t[39]=o=>s.selectCustomer(null))},"Отменить выбор ")):a("",!0),h(G,{"for-select":!0,onSelect:s.selectCustomer},null,8,["onSelect"])],64)):a("",!0),s.tab==="supplier"?(i(),d(p,{key:5},[e("button",{class:"btn btn-secondary my-3",onClick:t[40]||(t[40]=o=>s.tab="filter")},"Назад "),s.selectedSupplier!=null?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-secondary p-3 w-100 mb-2",onClick:t[41]||(t[41]=o=>s.selectSupplier(null))},"Отменить выбор ")):a("",!0),h(W,{"for-select":!0,onSelect:s.selectSupplier},null,8,["onSelect"])],64)):a("",!0)]),t[74]||(t[74]=e("div",{class:"modal-footer"},[e("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Применить фильтры")],-1))],32)])])],64)}}}),Et={name:"TaskCard",props:{task:{type:Object,required:!0}},data(){return{salesStore:T(),statusLabels:{pending:"В ожидании",assigned:"Назначено",delivered:"Доставлено",completed:"Завершено",rejected:"Отклонено"}}},methods:{formatDate(l){return l?new Date(l).toLocaleDateString():"—"},async sendPaymentDocumentToTg(){await this.salesStore.sendPaymentDocumentToTg(this.task.id)},statusClass(l){switch(l){case"pending":return"bg-secondary";case"assigned":return"bg-info";case"delivered":return"bg-primary";case"completed":return"bg-success";case"rejected":return"bg-danger";default:return"bg-dark"}}}},Lt={class:"mb-2"},Nt={class:"mb-2"},Ot={class:"text-muted"},Jt={class:"list-group list-group-flush"},Gt={class:"list-group-item"},Ht={class:"list-group-item"},Kt={class:"list-group-item"},Qt={class:"list-group-item"},Rt={key:0},Wt={key:1},Xt={class:"list-group-item"},Yt={class:"list-group-item"},Zt={class:"mt-3"},xt={key:0},te={key:1},ee={key:2},se={class:"text-muted small"};function le(l,s,t,n,c,f){var v,k,o,b,S,w;return i(),d(p,null,[e("h6",Lt,[u(r(t.task.title)+" ",1),e("span",{class:I(["badge",f.statusClass(t.task.status)])},r(c.statusLabels[t.task.status]),3)]),e("div",Nt,[e("p",Ot,r(t.task.description),1),e("ul",Jt,[e("li",Gt,[s[1]||(s[1]=e("strong",null,"Дата встречи:",-1)),u(" "+r(f.formatDate(t.task.due_date)),1)]),e("li",Ht,[s[2]||(s[2]=e("strong",null,"Дата продажи:",-1)),u(" "+r(f.formatDate(t.task.sale_date)),1)]),e("li",Kt,[s[3]||(s[3]=e("strong",null,"Фактическая доставка:",-1)),u(" "+r(f.formatDate(t.task.actual_delivery_date)),1)]),e("li",Qt,[s[4]||(s[4]=e("strong",null,"Тип оплаты:",-1)),t.task.payment_type===0?(i(),d("span",Rt,"Наличный расчет")):a("",!0),t.task.payment_type===1?(i(),d("span",Wt,"Безналичный расчет")):a("",!0)]),e("li",Xt,[s[5]||(s[5]=e("strong",null,"Количество:",-1)),u(" "+r(t.task.quantity),1)]),e("li",Yt,[s[6]||(s[6]=e("strong",null,"Сумма заказа:",-1)),u(" "+r(t.task.total_price)+" ₴ ",1)])]),e("div",Zt,[s[13]||(s[13]=e("h6",{class:"fw-bold text-primary"},"Связанные элементы",-1)),e("p",null,[s[7]||(s[7]=e("strong",null,"Отвественный:",-1)),u(" "+r(((v=t.task.agent)==null?void 0:v.name)||"—"),1)]),t.task.customer?(i(),d("p",xt,[s[8]||(s[8]=e("strong",null,"Покупатель:",-1)),u(" "+r(((k=t.task.customer)==null?void 0:k.name)||"—"),1)])):a("",!0),e("p",null,[s[9]||(s[9]=e("strong",null,"Поставщик:",-1)),u(" "+r(((o=t.task.supplier)==null?void 0:o.name)||"—"),1)]),e("p",null,[s[10]||(s[10]=e("strong",null,"Продукт:",-1)),u(" "+r(((b=t.task.product)==null?void 0:b.name)||"—"),1)]),t.task.category?(i(),d("p",te,[s[11]||(s[11]=e("strong",null,"Категория:",-1)),u(" "+r(((S=t.task.category)==null?void 0:S.name)||"—"),1)])):a("",!0),t.task.creator?(i(),d("p",ee,[s[12]||(s[12]=e("strong",null,"Создан старшим администратором:",-1)),u(" "+r(((w=t.task.creator)==null?void 0:w.name)||"—"),1)])):a("",!0)]),t.task.payment_document_name?(i(),d("button",{key:0,onClick:s[0]||(s[0]=(...F)=>f.sendPaymentDocumentToTg&&f.sendPaymentDocumentToTg(...F)),class:"btn btn-info p-3 w-100",type:"button"},"Документ чека ")):a("",!0)]),e("div",se," Создано: "+r(f.formatDate(t.task.created_at))+" | Обновлено: "+r(f.formatDate(t.task.updated_at)),1)],64)}const oe=O(Et,[["render",le]]),ne={class:"list-group"},ie={class:"fw-bold mb-2"},de={key:0,class:"fa-solid fa-clock",style:{"margin-left":"8px"}},ae={key:1,class:"badge bg-success"},re={key:2,class:"badge bg-primary"},ue={key:0,class:"fw-bold mb-2",style:{"font-size":"14px"}},me={key:1,class:"fw-bold mb-2",style:{"font-size":"14px"}},pe={key:2,class:"fw-bold mb-2",style:{"font-size":"14px"}},fe={key:0},be={key:1},ye={key:3,class:"fw-bold mb-2",style:{"font-size":"14px"}},ce={key:4,class:"text-muted"},ge={key:5,class:"mb-2"},ve={key:6,class:"mb-2"},ke={class:"fw-bold"},Se={key:7,class:"mb-2"},Ce={class:"fw-bold"},he={key:8,class:"mb-2"},we={class:"fw-bold"},$e={key:9,class:"mb-2"},Fe={class:"fw-bold"},Pe={key:10,class:"mb-2"},Ie={class:"fw-bold"},Te={key:11,class:"mb-2"},De={class:"fw-bold"},_e={key:12,class:"mb-2"},Me={class:"fw-bold"},Ve={class:"dropdown"},Ue={class:"dropdown-menu dropdown-menu-end"},Be={key:0},qe=["onClick"],Ae=["onClick"],je=["onClick"],ze={key:0},Ee=["onClick"],Le={key:1},Ne=["onClick"],Oe=["onClick"],Je=["onClick"],Ge=["onClick"],He={key:1,class:"alert alert-info mt-3"},Ke={class:"modal fade",id:"editSaleModal",tabindex:"-1"},Qe={class:"modal-dialog modal-fullscreen"},Re={class:"modal-content"},We={class:"modal-body"},Xe={class:"modal fade",id:"viewSaleModal",tabindex:"-1"},Ye={class:"modal-dialog modal-lg"},Ze={class:"modal-content"},xe={class:"modal-body"},ts={class:"modal fade",id:"confirmDealModal",tabindex:"-1"},es={class:"modal-dialog"},ss={class:"modal-content"},ls={class:"modal-body"},os={class:"form-floating mb-2"},ns={class:"form-floating mb-2"},is={class:"form-floating mb-2"},ds={class:"modal fade",id:"paymentConfirmForm",tabindex:"-1"},as={class:"modal-dialog"},rs={class:"modal-content"},us={class:"modal-body"},ms={class:"form-floating mb-2"},ps={key:0,class:"card mb-2 rounded-0"},fs={class:"card-body"},bs={class:"form-floating"},ys={name:"SaleList",props:["forSelect","adminId","agentId","productId","customerId","supplierId"],data(){return{field_visible:null,sales:[],search:"",userStore:N(),salesStore:T(),agentStore:R(),modalStore:Z(),selectedSale:null,saleStatuses:{pending:"В ожидании",assigned:"Назначено",completed:"Завершено",rejected:"Отклонено",delivered:"Доставляется"},paymentConfirmForm:{file:null,payment_type:0},dealForm:{sale_date:new Date().toISOString().split("T")[0],quantity:0,total_price:0}}},computed:{user(){return this.userStore.self||null},filteredSales(){return this.salesStore.items.filter(l=>l.title.toLowerCase().includes(this.search.toLowerCase()))}},created(){var l;this.salesStore.setFilters({created_by_id:this.adminId||null,customer_id:this.customerId||null,product_id:this.productId||null,supplier_id:this.supplierId||null}),(((l=this.user)==null?void 0:l.role)||0)>=3?this.salesStore.fetchFiltered():this.salesStore.selfSalesFiltered()},methods:{async sendPaymentDocumentToTg(l){await this.salesStore.sendPaymentDocumentToTg(l)},onFileChange(l){this.paymentConfirmForm.file=l.target.files[0]},async fetchData(l=1){await this.salesStore.fetchAllByPage(l);const s=bootstrap.Modal.getInstance(document.getElementById("editSaleModal"));s&&s.hide();const t=bootstrap.Modal.getInstance(document.getElementById("confirmDealModal"));t&&t.hide()},async fetchDataByUrl(l){await this.salesStore.fetchByUrl(l)},openEdit(l){this.selectedSale=null,this.$nextTick(()=>{this.selectedSale=l,new bootstrap.Modal(document.getElementById("editSaleModal")).show()})},confirmDelete(l){var s;this.selectedSale=l,this.modalStore.open(`Вы уверены, что хотите удалить ${(s=this.selectedSale)==null?void 0:s.title}?`,()=>this.salesStore.deleteSale(this.selectedSale.id),()=>this.modalStore.close())},confirmCancelDeal(l){var s;this.selectedSale=l,this.modalStore.open(`Вы уверены, что хотите отменить сделку ${(s=this.selectedSale)==null?void 0:s.title}?`,()=>this.salesStore.cancelDeal(l),()=>this.modalStore.close())},async deleteSale(){try{await this.salesStore.deleteSale(),bootstrap.Modal.getInstance(document.getElementById("deleteSaleModal")).hide()}catch(l){console.error("Ошибка удаления продажи:",l)}},openView(l){this.selectedSale=null,this.$nextTick(()=>{this.selectedSale=l,new bootstrap.Modal(document.getElementById("viewSaleModal")).show()})},openConfirmPayment(l){this.selectedSale=null,this.$nextTick(()=>{this.selectedSale=l,this.paymentConfirmForm.payment_type=l.payment_type,new bootstrap.Modal(document.getElementById("paymentConfirmForm")).show()})},openConfirmDeal(l){this.selectedSale=null,this.$nextTick(()=>{this.selectedSale=l,this.dealForm.quantity=l.quantity,this.dealForm.id=l.id,this.dealForm.total_price=l.total_price,new bootstrap.Modal(document.getElementById("confirmDealModal")).show()})},async confirmPayment(){this.paymentConfirmForm.id=this.selectedSale.id,await this.salesStore.confirmPayment(this.paymentConfirmForm),bootstrap.Modal.getInstance(document.getElementById("paymentConfirmForm")).hide()},async confirmDeal(){this.dealForm.id=this.selectedSale.id,await this.salesStore.confirmDeal(this.dealForm),bootstrap.Modal.getInstance(document.getElementById("confirmDealModal")).hide()},async cancelDeal(l){try{await this.salesStore.cancelDeal(l)}catch(s){console.error("Ошибка отмены сделки:",s)}},applyFilters(l){var c;this.field_visible=l.field_visible;let s=l.size||30,t=l.page||1;const n=l.only_my_tasks||(((c=this.user)==null?void 0:c.role)||0)<3;delete l.field_visible,delete l.only_my_tasks,this.salesStore.setFilters(l),n?this.salesStore.selfSalesFiltered(t,s):this.salesStore.fetchFiltered(t,s)}}},cs=Object.assign(ys,{setup(l){return(s,t)=>(i(),d(p,null,[m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>s.search=n),type:"text",class:"form-control mb-2",placeholder:"Поиск по названию..."},null,512),[[g,s.search]]),h(zt,{onApplyFilters:s.applyFilters},null,8,["onApplyFilters"]),e("ul",ne,[(i(!0),d(p,null,L(s.filteredSales,n=>{var c,f,v,k,o,b,S,w,F,D,_,M,V,U,B,q,A,j,z;return i(),d("li",{key:n.id,class:"list-group-item d-flex justify-content-between align-items-center"},[e("div",null,[e("p",ie,[n.payment_type===0?(i(),d("span",{key:0,class:I(["badge",{"bg-warning":!n.sale_date,"bg-success":n.sale_date}])},[t[8]||(t[8]=e("i",{class:"fa-solid fa-money-bill"},null,-1)),n.sale_date?a("",!0):(i(),d("i",de))],2)):a("",!0),n.payment_type===1?(i(),d("span",ae,[...t[9]||(t[9]=[e("i",{class:"fa-solid fa-credit-card"},null,-1)])])):a("",!0),(c=s.field_visible)!=null&&c.id?(i(),d("span",re,"#"+r(n.id),1)):a("",!0),u(" "+r(n.title),1)]),((f=s.field_visible)!=null&&f.due_date,i(),d("p",ue,"Дата задания "+r(n.due_date||"не указана"),1)),(v=s.field_visible)!=null&&v.sale_date?(i(),d("p",me,"Дата продажи "+r(n.sale_date||"не указана"),1)):a("",!0),(k=s.field_visible)!=null&&k.payment_type?(i(),d("p",pe,[t[10]||(t[10]=u(" Тип оплаты ",-1)),n.payment_type===0?(i(),d("span",fe,"Наличный расчет")):a("",!0),n.payment_type===1?(i(),d("span",be,"Безналичный расчет")):a("",!0)])):a("",!0),(o=s.field_visible)!=null&&o.actual_delivery_date?(i(),d("p",ye," Фактическая дата доставки "+r(n.actual_delivery_date||"не указана"),1)):a("",!0),(b=s.field_visible)!=null&&b.status?(i(),d("small",ce,[t[11]||(t[11]=u("Статус: ",-1)),e("span",{class:I(["badge",{"bg-warning":n.status==="pending","bg-info":n.status==="assigned","bg-primary":n.status==="delivered","bg-success":n.status==="completed","bg-danger":n.status==="rejected"}])},r(s.saleStatuses[n.status]),3)])):a("",!0),(S=s.field_visible)!=null&&S.description?(i(),d("p",ge,r(n.description),1)):a("",!0),(w=s.field_visible)!=null&&w.quantity?(i(),d("p",ve,[t[12]||(t[12]=u("Доставляемое число товара ",-1)),e("span",ke,r(n.quantity||"не указана"),1),t[13]||(t[13]=u(" ед.",-1))])):a("",!0),(F=s.field_visible)!=null&&F.total_price?(i(),d("p",Se,[t[14]||(t[14]=u("Сумма заказа ",-1)),e("span",Ce,r(n.total_price),1),t[15]||(t[15]=u(" руб.",-1))])):a("",!0),(D=s.field_visible)!=null&&D.agent_id?(i(),d("p",he,[t[16]||(t[16]=u("Администратор ",-1)),e("span",we,r(((_=n.agent)==null?void 0:_.name)||n.agent_id||"-"),1)])):a("",!0),(M=s.field_visible)!=null&&M.customer_id?(i(),d("p",$e,[t[17]||(t[17]=u("Клиент ",-1)),e("span",Fe,r(((V=n.customer)==null?void 0:V.name)||n.customer_id||"-"),1)])):a("",!0),(U=s.field_visible)!=null&&U.supplier_id?(i(),d("p",Pe,[t[18]||(t[18]=u("Поставщик ",-1)),e("span",Ie,r(((B=n.supplier)==null?void 0:B.name)||n.supplier_id||"-"),1)])):a("",!0),(q=s.field_visible)!=null&&q.created_by_id?(i(),d("p",Te,[t[19]||(t[19]=u("Старший администратор ",-1)),e("span",De,r(((A=n.creator)==null?void 0:A.name)||n.created_by_id||"-"),1)])):a("",!0),(j=s.field_visible)!=null&&j.product_id?(i(),d("p",_e,[t[20]||(t[20]=u("Товар ",-1)),e("span",Me,r(((z=n.product)==null?void 0:z.name)||n.product_id||"-"),1)])):a("",!0)]),e("div",Ve,[t[23]||(t[23]=e("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[e("i",{class:"fas fa-bars"})],-1)),e("ul",Ue,[l.forSelect?(i(),d("li",Be,[e("a",{class:"dropdown-item",href:"#",onClick:y(C=>s.$emit("select",n),["prevent"])},"Выбрать",8,qe)])):a("",!0),l.forSelect?a("",!0):(i(),d(p,{key:1},[e("li",null,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:y(C=>s.openView(n),["prevent"])},"Просмотреть",8,Ae)]),e("li",null,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:y(C=>s.openEdit(n),["prevent"])},"Редактировать",8,je)]),n.status!=="completed"?(i(),d("li",ze,[e("a",{class:"dropdown-item text-success",href:"javascript:void(0)",onClick:y(C=>s.openConfirmDeal(n),["prevent"])},"Подтвердить доставку",8,Ee)])):a("",!0),n.payment_type===0&&!n.sale_date?(i(),d("li",Le,[e("a",{class:"dropdown-item text-success",href:"javascript:void(0)",onClick:y(C=>s.openConfirmPayment(n),["prevent"])},"Подтвердить оплату",8,Ne)])):a("",!0),n.payment_document_name?(i(),d(p,{key:2},[t[21]||(t[21]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[e("a",{class:"dropdown-item text-success",href:"javascript:void(0)",onClick:y(C=>s.sendPaymentDocumentToTg(n.id),["prevent"])},"Отправить документ в чат",8,Oe)])],64)):a("",!0),t[22]||(t[22]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[e("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:y(C=>s.confirmDelete(n),["prevent"])},"Удалить",8,Je)]),e("li",null,[e("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:y(C=>s.confirmCancelDeal(n),["prevent"])},"Отменить сделку",8,Ge)])],64))])])])}),128))]),s.salesStore.items.length>0?(i(),P(K,{key:0,pagination:s.salesStore.pagination,onPageChanged:s.fetchDataByUrl},null,8,["pagination","onPageChanged"])):a("",!0),s.salesStore.items.length===0?(i(),d("div",He," На текущий момент у вас нет продаж. ")):a("",!0),e("div",Ke,[e("div",Qe,[e("div",Re,[t[24]||(t[24]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Редактирование задания"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",We,[s.selectedSale?(i(),P(H,{key:0,initialData:s.selectedSale,onSaved:s.fetchData},null,8,["initialData","onSaved"])):a("",!0)])])])]),e("div",Xe,[e("div",Ye,[e("div",Ze,[t[25]||(t[25]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Карточка задания"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",xe,[s.selectedSale?(i(),P(oe,{key:0,task:s.selectedSale},null,8,["task"])):a("",!0)])])])]),e("div",ts,[e("div",es,[e("div",ss,[t[30]||(t[30]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Подтверждение сделки"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",ls,[e("form",{onSubmit:t[4]||(t[4]=y((...n)=>s.confirmDeal&&s.confirmDeal(...n),["prevent"]))},[e("div",os,[m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>s.dealForm.sale_date=n),type:"date",class:"form-control",id:"sale_date",required:""},null,512),[[g,s.dealForm.sale_date]]),t[26]||(t[26]=e("label",{for:"sale_date"},"Дата",-1))]),e("div",ns,[m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>s.dealForm.quantity=n),type:"number",class:"form-control",id:"quantity",placeholder:"Количество",required:""},null,512),[[g,s.dealForm.quantity]]),t[27]||(t[27]=e("label",{for:"quantity"},"Количество",-1))]),e("div",is,[m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>s.dealForm.total_price=n),type:"number",step:"0.01",class:"form-control",id:"total_price",placeholder:"Сумма",required:""},null,512),[[g,s.dealForm.total_price]]),t[28]||(t[28]=e("label",{for:"total_price"},"Сумма сделки",-1))]),t[29]||(t[29]=e("button",{type:"submit",class:"btn btn-success w-100 p-3"},"Подтвердить",-1))],32)])])])]),e("div",ds,[e("div",as,[e("div",rs,[t[36]||(t[36]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Подтверждение оплаты"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",us,[e("form",{onSubmit:t[7]||(t[7]=y((...n)=>s.confirmPayment&&s.confirmPayment(...n),["prevent"]))},[e("div",ms,[m(e("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=n=>s.paymentConfirmForm.payment_type=n),id:"payment-type","aria-label":"Floating label select example"},[...t[31]||(t[31]=[e("option",{value:"0"},"Наличный расчет",-1),e("option",{value:"1"},"Безналичный расчет",-1)])],512),[[$,s.paymentConfirmForm.payment_type]]),t[32]||(t[32]=e("label",{for:"payment-type"},"Тип оплаты",-1))]),s.paymentConfirmForm.payment_type==="1"?(i(),d("div",ps,[e("div",fs,[t[34]||(t[34]=e("h6",null,"Фотография чека",-1)),e("div",bs,[e("input",{type:"file",class:"form-control",onChange:t[6]||(t[6]=(...n)=>s.onFileChange&&s.onFileChange(...n)),accept:".jpg,.png,.pdf",required:""},null,32),t[33]||(t[33]=e("label",{for:"payment-type"},"Прикрепить",-1))])])])):a("",!0),t[35]||(t[35]=e("button",{type:"submit",class:"btn btn-success w-100 p-3"},"Подтвердить",-1))],32)])])])])],64))}}),Is=O(cs,[["__scopeId","data-v-f1d1ad8e"]]);export{Is as S};
