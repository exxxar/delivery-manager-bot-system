import{c as a,o as l,b as t,e as r,i as m,t as p,F as u,w as g,v as b,h as f,f as C,H as R,d as v,r as D,J as _,k as $,I as V,a as w,E as T,n as j}from"./app-BFmSYGG6.js";import{_ as O}from"./SupplierList-BWvVzcKP.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as E}from"./Pagination-tlNAmARK.js";import{U as M}from"./UserForm-CMTWBbCi.js";import{u as G}from"./baseExports-CbGMW2iY.js";import{m as c}from"./makeAxiosFactory-C7tuAQ4t.js";import{u as I}from"./useConfitmModalStore-fM6MVOLx.js";const F={name:"AgentInfo",props:{agent:{type:Object,required:!0}}},L={class:"list-group list-group-flush"},q={class:"list-group-item"},N={class:"list-group-item"},z={class:"list-group-item"},W={class:"list-group-item"},H={class:"list-group-item"},J={key:0,class:"list-group-item"};function K(o,e,s,n,i,k){var d;return l(),a(u,null,[t("ul",L,[t("li",q,[e[1]||(e[1]=t("strong",null,"ID:",-1)),m(" "+p(s.agent.id),1)]),t("li",N,[e[2]||(e[2]=t("strong",null,"Имя:",-1)),m(" "+p(s.agent.name),1)]),t("li",z,[e[3]||(e[3]=t("strong",null,"Телефон:",-1)),m(" "+p(s.agent.phone),1)]),t("li",W,[e[4]||(e[4]=t("strong",null,"Email:",-1)),m(" "+p(s.agent.email),1)]),t("li",H,[e[5]||(e[5]=t("strong",null,"Регион:",-1)),m(" "+p(s.agent.region),1)]),s.agent.in_learning?(l(),a("li",J,[e[6]||(e[6]=t("strong",null,"Обучается у: ",-1)),s.agent.mentor?(l(),a(u,{key:0},[m(p(((d=s.agent.mentor)==null?void 0:d.name)||"-"),1)],64)):(l(),a(u,{key:1},[m(" Наставник не указан ")],64))])):r("",!0)]),t("button",{class:"btn btn-primary p-3 w-100",onClick:e[0]||(e[0]=S=>o.$emit("edit",s.agent))},"Редактировать")],64)}const Q=U(F,[["render",K]]),X={name:"ReportIndividualGenerator",props:["agentId"],data(){return{reportStore:G(),report:{startDate:"",endDate:""}}},methods:{generateReport(){const o={...this.report,id:this.agentId};this.reportStore.exportIndividual(o),this.$emit("generate-report",o)}}},Y={class:"form-floating mb-2"},Z={class:"form-floating mb-2"},x=["disabled"];function tt(o,e,s,n,i,k){return l(),a("form",{onSubmit:e[2]||(e[2]=f((...d)=>k.generateReport&&k.generateReport(...d),["prevent"]))},[t("div",Y,[g(t("input",{type:"date",class:"form-control",id:"startDate","onUpdate:modelValue":e[0]||(e[0]=d=>i.report.startDate=d),required:""},null,512),[[b,i.report.startDate]]),e[3]||(e[3]=t("label",{for:"startDate"},"Дата начала периода",-1))]),t("div",Z,[g(t("input",{type:"date",class:"form-control",id:"endDate","onUpdate:modelValue":e[1]||(e[1]=d=>i.report.endDate=d),required:""},null,512),[[b,i.report.endDate]]),e[4]||(e[4]=t("label",{for:"endDate"},"Дата окончания периода",-1))]),t("button",{disabled:i.report.loading,type:"submit",class:"btn btn-primary p-3 w-100"}," Сформировать отчёт ",8,x)],32)}const et=U(X,[["render",tt]]),A="/bot-api/admins",st=C("admins",{state:()=>({items:[],loading:!1,error:null}),getters:{byId:o=>e=>o.items.find(s=>s.id===e)},actions:{async fetchAdminsByPage(o=1){const{data:e}=await c(`${A}?page=${o}`,"GET");this.items=e.data,this.pagination=e},async fetchByUrl(o){const{data:e}=await c(o,"GET");this.items=e.data,this.pagination=e},async downloadPersonalAdminReport(o){var s,n;const e=R();e.show("Подготавливаем отчет"),this.loading=!0,this.error=null;try{const{data:i}=await c(`${A}/download-personal-report`,"POST",o);return e.show("Отчет отправлен","success"),i}catch(i){throw this.error=((n=(s=i.response)==null?void 0:s.data)==null?void 0:n.message)??"Ошибка отправки отчёта",e.show(this.error,"error"),i}finally{this.loading=!1}},async downloadReport(o){var e,s;this.loading=!0,this.error=null;try{const{data:n}=await c(`${A}/download-report`,"POST",o);return n}catch(n){throw this.error=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)??"Ошибка отправки отчёта",n}finally{this.loading=!1}}}}),ot={class:"list-group"},nt=["onClick"],lt={class:"badge bg-primary"},it={class:"text-muted mb-0 small"},at={class:"text-muted mb-2 small"},dt={class:"form-check form-switch"},rt=["onChange","onUpdate:modelValue","id"],mt=["for"],pt={class:"dropdown"},ut={class:"dropdown-menu dropdown-menu-end"},gt={key:0},ct=["onClick"],ft=["onClick"],bt=["onClick"],ht=["onClick"],yt={key:1,class:"alert alert-info mt-3"},vt={class:"modal fade",id:"reportModal",tabindex:"-1"},kt={class:"modal-dialog"},$t={class:"modal-content"},wt={class:"modal-body"},St={class:"modal fade",id:"roleSwitcherUserModal",tabindex:"-1"},At={class:"modal-dialog modal-lg"},_t={class:"modal-content"},Ct={class:"modal-body"},Dt={class:"form-floating mb-2"},Ut={class:"modal fade",id:"editUserModal",tabindex:"-1"},Et={class:"modal-dialog modal-lg"},Mt={class:"modal-content"},It={class:"modal-body"},Bt={name:"AdminList",props:["forSelect"],data(){return{adminsStore:st(),userStore:I(),selectedAdmin:null}},created(){this.fetchData()},methods:{selectAdmin(o){this.forSelect&&this.$emit("select",o)},openRoleSwitcher(o){this.selectedAdmin=o,new bootstrap.Modal(document.getElementById("roleSwitcherUserModal")).show()},openEdit(o){this.selectedAdmin=o,new bootstrap.Modal(document.getElementById("editUserModal")).show()},async changeAdminWorkStatus(o){await this.userStore.updateWorkStatus(o.id,o.is_work)},async handleReport(o){o.user_id=this.selectedAdmin.id,await this.adminsStore.downloadPersonalAdminReport(o)},async fetchData(o=1){await this.adminsStore.fetchAdminsByPage(o).then(()=>{const e=bootstrap.Modal.getInstance(document.getElementById("editUserModal"));e&&e.hide()})},async fetchDataByUrl(o){await this.adminsStore.fetchByUrl(o)},async downloadReport(o){await this.adminsStore.downloadReport(o)},async changeRole(){await this.userStore.updateRole(this.selectedAdmin.id,this.selectedAdmin.role).then(()=>{this.fetchData(),bootstrap.Modal.getInstance(document.getElementById("roleSwitcherUserModal")).hide()})}}},Pt=Object.assign(Bt,{setup(o){return(e,s)=>(l(),a(u,null,[t("ul",ot,[(l(!0),a(u,null,D(e.adminsStore.items,n=>(l(),a("li",{key:n.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",null,[t("div",{onClick:i=>e.selectAdmin(n),class:"fw-bold"},[t("span",lt,p(n.percent)+"%",1),m(" "+p(n.name)+" ",1),t("p",it,p(n.phone||"Телефон не указан"),1),t("p",at,p(n.email),1)],8,nt),t("div",dt,[g(t("input",{onChange:i=>e.changeAdminWorkStatus(n),class:"form-check-input",type:"checkbox","onUpdate:modelValue":i=>n.is_work=i,id:`is-work-${n.id}`},null,40,rt),[[$,n.is_work]]),t("label",{class:"form-check-label",for:`is-work-${n.id}`},p(n.is_work?"работает":"не работает"),9,mt)])]),t("div",pt,[s[2]||(s[2]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",ut,[o.forSelect?(l(),a("li",gt,[t("a",{class:"dropdown-item",href:"#",onClick:f(i=>e.selectAdmin(n),["prevent"])},"Выбрать",8,ct)])):r("",!0),o.forSelect?r("",!0):(l(),a(u,{key:1},[t("li",null,[t("button",{type:"button",onClick:i=>e.selectedAdmin=n,class:"dropdown-item","data-bs-toggle":"modal","data-bs-target":"#reportModal"}," Сформировать отчет ",8,ft)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:f(i=>e.openRoleSwitcher(n),["prevent"])},"Сменить роль",8,bt)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:f(i=>e.openEdit(n),["prevent"])},"Редактировать",8,ht)])],64))])])]))),128))]),e.adminsStore.items.length>0?(l(),v(E,{key:0,pagination:e.adminsStore.pagination,onPageChanged:e.fetchDataByUrl},null,8,["pagination","onPageChanged"])):r("",!0),e.adminsStore.items.length===0?(l(),a("div",yt," Администраторов пока нет. ")):r("",!0),t("div",vt,[t("div",kt,[t("div",$t,[s[3]||(s[3]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Отчет по администратору"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",wt,[e.selectedAdmin?(l(),v(ls,{key:0,type:"admins","is-simple":!0,"object-id":e.selectedAdmin.id,onGenerateReport:e.handleReport},null,8,["object-id","onGenerateReport"])):r("",!0)])])])]),t("div",St,[t("div",At,[t("div",_t,[s[7]||(s[7]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование пользователя"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Ct,[e.selectedAdmin?(l(),a("form",{key:0,onSubmit:s[1]||(s[1]=f((...n)=>e.changeRole&&e.changeRole(...n),["prevent"]))},[t("div",Dt,[g(t("select",{"onUpdate:modelValue":s[0]||(s[0]=n=>e.selectedAdmin.role=n),class:"form-select",id:"role",required:""},[...s[4]||(s[4]=[t("option",{value:0},"Пользователь",-1),t("option",{value:1},"Администратор",-1),t("option",{value:2},"Поставщик",-1),t("option",{value:3},"Старший администратор",-1)])],512),[[_,e.selectedAdmin.role]]),s[5]||(s[5]=t("label",{for:"role"},"Роль",-1))]),s[6]||(s[6]=t("button",{type:"submit",class:"btn btn-primary w-100 p-3"}," Сохранить изменения ",-1))],32)):r("",!0)])])])]),t("div",Ut,[t("div",Et,[t("div",Mt,[s[8]||(s[8]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование администратора"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",It,[e.selectedAdmin?(l(),v(M,{key:0,initialData:e.selectedAdmin,onSaved:e.fetchData},null,8,["initialData","onSaved"])):r("",!0)])])])])],64))}}),y="/bot-api/agents",B=C("agents",{state:()=>({items:[],loading:!1,error:null}),getters:{byId:o=>e=>o.items.find(s=>s.id===e)},actions:{async fetchAll(){this.loading=!0,this.error=null;try{const{data:o}=await c(`${y}`,"GET");this.items=o}catch(o){this.error=(o==null?void 0:o.message)||"Failed to load agents"}finally{this.loading=!1}},async fetchAllByPage(o=1,e=20){const{data:s}=await c(`${y}?page=${o}&size=${e}`,"GET");this.items=s.data,this.pagination=s},async fetchByUrl(o){const{data:e}=await c(o,"GET");this.items=e.data,this.pagination=e},async fetchOne(o){try{const{data:e}=await c(`${y}/${o}`,"GET");return e}catch(e){throw this.error=(e==null?void 0:e.message)||"Failed to load agent",e}},async create(o){const{data:e}=await c(`${y}`,"POST",o);return this.items.push(e),e},async update(o,e){const{data:s}=await c(`${y}/${o}`,"PUT",e),n=this.items.findIndex(i=>i.id===o);return n!==-1&&(this.items[n]=s),s},async remove(o){await c(`${y}/${o}`,"DELETE"),this.items=this.items.filter(e=>e.id!==o)},async downloadSelReport(o){var e,s;this.loading=!0,this.error=null;try{const{data:n}=await c(`${y}/download-self-report`,"POST",o);return n}catch(n){throw this.error=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)??"Ошибка отправки отчёта",n}finally{this.loading=!1}}}}),Rt={class:"form-floating mb-2"},Vt={class:"form-floating mb-2"},Tt={class:"form-floating mb-2"},jt={class:"form-floating mb-2"},Ot={class:"form-check form-switch mb-2"},Gt={class:"form-check-label",for:"is_test"},Ft={key:0,class:"fw-bold text-primary"},Lt={key:1,class:"fw-bold text-primary"},qt={class:"form-check form-switch mb-2"},Nt={class:"form-check-label",for:"in_learning"},zt={key:0,class:"fw-bold text-primary"},Wt={key:1,class:"fw-bold text-primary"},Ht={class:"input-group mb-2"},Jt={class:"form-floating flex-grow-1"},Kt=["value"],Qt={class:"form-check form-switch mb-2"},Xt={class:"form-floating mb-2"},Yt={class:"form-floating mb-2"},Zt={name:"AgentForm",props:{initialData:{type:Object,default:null}},data(){return{agentStore:B(),isEdit:!1,configLearningPeriod:!1,tab:"main",form:{name:"",phone:"",email:"",region:"",start_learning_date:null,end_learning_date:null,in_learning:!1,is_test:!1},mentorName:null}},created(){var o;this.initialData&&(this.form={...this.initialData},this.isEdit=!0,this.mentorName=((o=this.initialData.mentor)==null?void 0:o.name)||"")},methods:{selectAdmin(o){this.form.mentor_id=o.id,this.mentorName=o.name,this.tab="main"},async submitForm(){this.isEdit?this.agentStore.update(this.form.id,this.form):this.agentStore.create(this.form),this.$emit("callback")}}},P=Object.assign(Zt,{setup(o){return(e,s)=>{const n=V("mask");return l(),a("form",{onSubmit:s[11]||(s[11]=f((...i)=>e.submitForm&&e.submitForm(...i),["prevent"]))},[e.tab==="main"?(l(),a(u,{key:0},[t("div",Rt,[g(t("input",{"onUpdate:modelValue":s[0]||(s[0]=i=>e.form.name=i),type:"text",class:"form-control",id:"name",placeholder:"Имя",required:""},null,512),[[b,e.form.name]]),s[12]||(s[12]=t("label",{for:"name"},"Имя",-1))]),t("div",Vt,[g(t("input",{"onUpdate:modelValue":s[1]||(s[1]=i=>e.form.phone=i),minlength:"3",type:"text",class:"form-control",id:"phone",placeholder:"Телефон",required:""},null,512),[[b,e.form.phone],[n,"+7(###) ###-##-##"]]),s[13]||(s[13]=t("label",{for:"phone"},"Телефон",-1))]),t("div",Tt,[g(t("input",{"onUpdate:modelValue":s[2]||(s[2]=i=>e.form.email=i),minlength:"3",type:"email",class:"form-control",id:"email",placeholder:"Email",required:""},null,512),[[b,e.form.email]]),s[14]||(s[14]=t("label",{for:"email"},"Email",-1))]),t("div",jt,[g(t("input",{"onUpdate:modelValue":s[3]||(s[3]=i=>e.form.region=i),minlength:"3",required:"",type:"text",class:"form-control",id:"region",placeholder:"Регион"},null,512),[[b,e.form.region]]),s[15]||(s[15]=t("label",{for:"region"},"Регион",-1))]),t("div",Ot,[g(t("input",{"onUpdate:modelValue":s[4]||(s[4]=i=>e.form.is_test=i),class:"form-check-input",type:"checkbox",role:"switch",id:"is_test"},null,512),[[$,e.form.is_test]]),t("label",Gt,[s[16]||(s[16]=m("Тестовый агент ",-1)),e.form.is_test?(l(),a("span",Ft,"включено")):(l(),a("span",Lt,"выключено"))])]),t("div",qt,[g(t("input",{"onUpdate:modelValue":s[5]||(s[5]=i=>e.form.in_learning=i),class:"form-check-input",type:"checkbox",role:"switch",id:"in_learning"},null,512),[[$,e.form.in_learning]]),t("label",Nt,[s[17]||(s[17]=m("На обучении ",-1)),e.form.in_learning?(l(),a("span",zt,"включено")):(l(),a("span",Wt,"выключено"))])]),e.form.in_learning?(l(),a(u,{key:0},[s[23]||(s[23]=t("p",{class:"alert alert-info mb-2"},"Назначение ответственного за обучение (наставника)",-1)),t("div",Ht,[t("div",Jt,[t("input",{type:"text",class:"form-control",id:"admin",value:e.mentorName,placeholder:"Администратор",readonly:""},null,8,Kt),s[18]||(s[18]=t("label",{for:"admin"},"Старший администратор",-1))]),t("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:s[6]||(s[6]=i=>e.tab="admin")},"Выбрать ")]),t("div",Qt,[g(t("input",{"onUpdate:modelValue":s[7]||(s[7]=i=>e.configLearningPeriod=i),class:"form-check-input",type:"checkbox",role:"switch",id:"configLearningPeriod"},null,512),[[$,e.configLearningPeriod]]),s[19]||(s[19]=t("label",{class:"form-check-label",for:"configLearningPeriod"},"Настройка периода обучения ",-1))]),e.configLearningPeriod?(l(),a(u,{key:0},[s[22]||(s[22]=t("p",{class:"alert alert-info mb-2"},"Период настраивается автоматически после того как вы задали что Админстратор находится на обучении",-1)),t("div",Xt,[g(t("input",{"onUpdate:modelValue":s[8]||(s[8]=i=>e.form.start_learning_date=i),type:"date",class:"form-control",id:"sale_date"},null,512),[[b,e.form.start_learning_date]]),s[20]||(s[20]=t("label",{for:"sale_date"},"Дата начала обучения",-1))]),t("div",Yt,[g(t("input",{"onUpdate:modelValue":s[9]||(s[9]=i=>e.form.end_learning_date=i),type:"date",class:"form-control",id:"sale_date"},null,512),[[b,e.form.end_learning_date]]),s[21]||(s[21]=t("label",{for:"sale_date"},"Дата окончания обучения",-1))])],64)):r("",!0)],64)):r("",!0)],64)):r("",!0),e.tab==="admin"?(l(),a(u,{key:1},[t("button",{onClick:s[10]||(s[10]=i=>e.tab="main"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"0px","z-index":"100"}},"Назад "),w(Pt,{"for-select":!0,onSelect:e.selectAdmin},null,8,["onSelect"])],64)):r("",!0),s[24]||(s[24]=t("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Сохранить",-1))],32)}}}),xt={class:"form-floating mb-3"},te={key:0,class:"d-flex justify-content-between"},ee={key:0,class:"small"},se={class:"fw-bold"},oe={class:"list-group"},ne=["onClick"],le={class:"fw-bold"},ie={key:0,class:"badge bg-success"},ae=["onClick"],de={key:1,class:"small text-success"},re=["onClick"],me={class:"text-muted"},pe={class:"dropdown"},ue={class:"dropdown-menu dropdown-menu-end"},ge={key:0},ce=["onClick"],fe=["onClick"],be=["onClick"],he=["onClick"],ye=["onClick"],ve={class:"form-floating my-2"},ke={class:"modal fade",id:"agentInfoModal",tabindex:"-1"},$e={class:"modal-dialog"},we={class:"modal-content"},Se={class:"modal-body"},Ae={class:"modal fade",id:"deleteModal",tabindex:"-1"},_e={class:"modal-dialog"},Ce={class:"modal-content"},De={class:"modal-body"},Ue={class:"modal-footer"},Ee={class:"modal fade",id:"editAgentModal",tabindex:"-1"},Me={class:"modal-dialog modal-lg"},Ie={class:"modal-content"},Be={class:"modal-body"},Pe={class:"modal fade",id:"editUserModal",tabindex:"-1"},Re={class:"modal-dialog modal-lg"},Ve={class:"modal-content"},Te={class:"modal-body"},je={class:"modal fade",id:"personalStatisticModal",tabindex:"-1"},Oe={class:"modal-dialog modal-lg"},Ge={class:"modal-content"},Fe={class:"modal-body"},Le={name:"AgentList",components:{AgentForm:P},props:["forSelect"],data(){return{size:20,search:"",selectedAdmin:null,agentStore:B(),userStore:I(),selection:[],selectedAgent:null,report:{startDate:"",endDate:""}}},watch:{size:function(){this.fetchAgents()}},computed:{user(){return this.userStore.self||null},filteredAgents(){if(!this.search)return this.agentStore.items||[];const o=this.search.toLowerCase();return this.agentStore.items.filter(e=>Object.values(e).some(s=>s?String(s).toLowerCase().includes(o):!1))}},created(){this.fetchAgents()},methods:{toggleSelection(o){let e=this.selection.findIndex(s=>s===o);e===-1?this.selection.push(o):this.selection.splice(e,1),this.$emit("select",this.selection)},selectAll(){this.selection.length===0?this.agentStore.items.forEach(o=>{this.selection.indexOf(o.id)===-1&&this.selection.push(o.id)}):this.selection=[],this.$emit("select",this.selection)},generateReport(){bootstrap.Modal.getInstance(document.getElementById("personalStatisticModal")).hide()},openEdit(o){this.selectedAdmin=null,this.$nextTick(()=>{this.selectedAdmin=o,new bootstrap.Modal(document.getElementById("editUserModal")).show()})},async fetchAgents(o=1){await this.agentStore.fetchAllByPage(o,this.size)},async fetchAgentsByUrl(o){await this.agentStore.fetchByUrl(o)},selectAgent(o){this.forSelect&&this.$emit("select",o)},openAgentInfo(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("agentInfoModal")).show()},openPercents(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("percentsModal")).show()},confirmDelete(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("deleteModal")).show()},async deleteAgent(){try{await this.agentStore.remove(this.selectedAgent.id),bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide()}catch(o){console.error("Ошибка удаления:",o)}},getPersonalStatistic(o){this.selectedAgent=null,this.$nextTick(()=>{this.selectedAgent=o,new bootstrap.Modal(document.getElementById("personalStatisticModal")).show()})},openEditAgent(o){this.selectedAgent=null,this.$nextTick(()=>{this.selectedAgent=o,new bootstrap.Modal(document.getElementById("editAgentModal")).show()})}}},qe=Object.assign(Le,{setup(o){return(e,s)=>{var n,i,k;return l(),a(u,null,[t("div",xt,[g(t("input",{type:"search","onUpdate:modelValue":s[0]||(s[0]=d=>e.search=d),class:"form-control",id:"searchInput",placeholder:"Поиск..."},null,512),[[b,e.search]]),s[4]||(s[4]=t("label",{for:"searchInput"},"Поиск",-1))]),o.forSelect?r("",!0):(l(),a(u,{key:0},[(((n=e.user)==null?void 0:n.role)||0)>=3?(l(),a("div",te,[t("a",{href:"javascript:void(0)",onClick:s[1]||(s[1]=(...d)=>e.selectAll&&e.selectAll(...d)),class:"small"},"Выделить все"),e.selection.length>0?(l(),a("span",ee,[s[5]||(s[5]=m("Выбрано ",-1)),t("span",se,p(e.selection.length),1),s[6]||(s[6]=m(" админов",-1))])):r("",!0)])):r("",!0)],64)),t("ul",oe,[(l(!0),a(u,null,D(e.filteredAgents,d=>{var S;return l(),a("li",{key:d.id,class:j([{"border-primary":e.selection.indexOf(d.id)!==-1},"list-group-item d-flex justify-content-between align-items-center"])},[t("div",{onClick:h=>e.selectAgent(d)},[t("div",le,[d.in_learning?(l(),a("span",ie,[...s[7]||(s[7]=[t("i",{class:"fa-solid fa-user-graduate"},null,-1)])])):r("",!0),t("span",{onClick:h=>e.toggleSelection(d.id)},p(d.name),9,ae),d.in_learning&&!o.forSelect?(l(),a("span",de,[d.mentor?(l(),a("a",{key:0,onClick:h=>e.openEdit(d.mentor),href:"javascript:void(0)"},"("+p(((S=d.mentor)==null?void 0:S.name)||"-")+")",9,re)):(l(),a(u,{key:1},[m(" Наставник не указан ")],64))])):r("",!0)]),t("small",me,p(d.phone)+" | "+p(d.email),1)],8,ne),t("div",pe,[s[9]||(s[9]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",ue,[o.forSelect?(l(),a("li",ge,[t("a",{class:"dropdown-item",href:"#",onClick:f(h=>e.selectAgent(d),["prevent"])},"Выбрать",8,ce)])):r("",!0),o.forSelect?r("",!0):(l(),a(u,{key:1},[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:f(h=>e.openAgentInfo(d),["prevent"])},"Просмотр",8,fe)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:f(h=>e.openEditAgent(d),["prevent"])},"Редактировать",8,be)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:f(h=>e.getPersonalStatistic(d),["prevent"])},"Выгрузка статистики",8,he)]),s[8]||(s[8]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"#",onClick:f(h=>e.confirmDelete(d),["prevent"])},"Удалить",8,ye)])],64))])])],2)}),128))]),((i=e.agentStore.pagination)==null?void 0:i.total)>0?(l(),a(u,{key:1},[t("div",ve,[g(t("select",{id:"itemsPerPage",class:"form-select","onUpdate:modelValue":s[2]||(s[2]=d=>e.size=d)},[...s[10]||(s[10]=[T('<option value="10">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option><option value="500">500</option><option value="1000">1000</option><option value="5000">5000</option>',7)])],512),[[_,e.size]]),s[11]||(s[11]=t("label",{for:"itemsPerPage"},"Элементов на странице",-1))]),w(E,{pagination:e.agentStore.pagination,onPageChanged:e.fetchAgentsByUrl},null,8,["pagination","onPageChanged"])],64)):r("",!0),t("div",ke,[t("div",$e,[t("div",we,[s[12]||(s[12]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Информация"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Se,[e.selectedAgent?(l(),v(Q,{key:0,agent:e.selectedAgent},null,8,["agent"])):r("",!0)])])])]),t("div",Ae,[t("div",_e,[t("div",Ce,[s[16]||(s[16]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title text-danger"},"Удаление"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",De,[s[13]||(s[13]=m(" Вы уверены, что хотите удалить ",-1)),t("strong",null,p((k=e.selectedAgent)==null?void 0:k.name),1),s[14]||(s[14]=m("? ",-1))]),t("div",Ue,[s[15]||(s[15]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),t("button",{type:"button",class:"btn btn-danger",onClick:s[3]||(s[3]=(...d)=>e.deleteAgent&&e.deleteAgent(...d))},"Удалить")])])])]),t("div",Ee,[t("div",Me,[t("div",Ie,[s[17]||(s[17]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Be,[e.selectedAgent?(l(),v(P,{key:0,initialData:e.selectedAgent},null,8,["initialData"])):r("",!0)])])])]),t("div",Pe,[t("div",Re,[t("div",Ve,[s[18]||(s[18]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование администратора"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Te,[e.selectedAdmin?(l(),v(M,{key:0,initialData:e.selectedAdmin,onSaved:e.fetchData},null,8,["initialData","onSaved"])):r("",!0)])])])]),t("div",je,[t("div",Oe,[t("div",Ge,[s[19]||(s[19]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Персональная статистика за период"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Fe,[e.selectedAgent?(l(),v(et,{key:0,"agent-id":e.selectedAgent.id,onGenerateReport:e.generateReport},null,8,["agent-id","onGenerateReport"])):r("",!0)])])])])],64)}}}),Ne={class:"form-floating mb-2"},ze={class:"form-floating mb-2"},We={class:"form-check form-switch mb-2"},He={key:0},Je={key:1},Ke={class:"fw-bold"},Qe={key:0},Xe={key:1},Ye={class:"fw-bold"},Ze={class:"form-floating mb-2"},xe=["disabled"],ts={class:"btn-group w-100",style:{position:"sticky",bottom:"20px"},role:"group","aria-label":"Basic example"},es={key:0,class:"fw-bold"},ss={class:"btn-group w-100",style:{position:"sticky",bottom:"20px"},role:"group","aria-label":"Basic example"},os={key:0,class:"fw-bold"},ns={name:"ReportGenerator",components:{},props:["type","isSimple"],data(){return{need_more_options:!1,tab:"main",report:{result_type:0,startDate:"",endDate:"",type:this.type||"",restriction:null,selected_suppliers:[],selected_agents:[]}}},watch:{need_more_options:function(){this.need_more_options||(this.report.selected_suppliers=[],this.report.selected_agents=[])}},methods:{selectSuppliers(o){this.report.selected_suppliers=o},selectAgents(o){this.report.selected_agents=o},resetSuppliers(){this.report.selected_suppliers=[],this.tab="main"},resetAgents(){this.report.selected_agents=[],this.tab="main"},generateReport(){const o={...this.report};this.$emit("generate-report",o)}}},ls=Object.assign(ns,{setup(o){return(e,s)=>(l(),a("form",{onSubmit:s[10]||(s[10]=f((...n)=>e.generateReport&&e.generateReport(...n),["prevent"]))},[e.tab==="main"?(l(),a(u,{key:0},[t("div",Ne,[g(t("input",{type:"date",class:"form-control",id:"startDate","onUpdate:modelValue":s[0]||(s[0]=n=>e.report.startDate=n),required:""},null,512),[[b,e.report.startDate]]),s[11]||(s[11]=t("label",{for:"startDate"},"Дата начала периода",-1))]),t("div",ze,[g(t("input",{type:"date",class:"form-control",id:"endDate","onUpdate:modelValue":s[1]||(s[1]=n=>e.report.endDate=n),required:""},null,512),[[b,e.report.endDate]]),s[12]||(s[12]=t("label",{for:"endDate"},"Дата окончания периода",-1))]),t("div",We,[g(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=n=>e.need_more_options=n),id:"need_more_options"},null,512),[[$,e.need_more_options]]),s[13]||(s[13]=t("label",{class:"form-check-label",for:"need_more_options"}," Больше параметров отчета ",-1))]),e.need_more_options?(l(),a(u,{key:0},[t("button",{onClick:s[3]||(s[3]=n=>e.tab="suppliers"),type:"button",class:"btn btn-outline-light text-primary p-3 mb-2 w-100"},[(e.report.selected_suppliers||[]).length===0?(l(),a("span",He," Выбрать поставщиков ")):(l(),a("span",Je,[s[14]||(s[14]=m(" Выбрано ",-1)),t("span",Ke,p(e.report.selected_suppliers.length),1),s[15]||(s[15]=m(" поставщиков ",-1))]))]),t("button",{onClick:s[4]||(s[4]=n=>e.tab="agents"),type:"button",class:"btn btn-outline-light text-primary p-3 mb-2 w-100"},[(e.report.selected_agents||[]).length===0?(l(),a("span",Qe," Выбрать администраторов ")):(l(),a("span",Xe,[s[16]||(s[16]=m(" Выбрано ",-1)),t("span",Ye,p(e.report.selected_agents.length),1),s[17]||(s[17]=m(" админов ",-1))]))]),t("div",Ze,[g(t("select",{"onUpdate:modelValue":s[5]||(s[5]=n=>e.report.result_type=n),class:"form-select",id:"floatingSelect","aria-label":"Floating label select example"},[...s[18]||(s[18]=[t("option",{value:"0"},"Классический отчет",-1),t("option",{value:"1"},"Расширенный отчет",-1)])],512),[[_,e.report.result_type]]),s[19]||(s[19]=t("label",{for:"floatingSelect"},"Как вывести результат",-1))])],64)):r("",!0),t("button",{disabled:e.report.loading,type:"submit",class:"btn btn-primary p-3 w-100"}," Сформировать отчёт ",8,xe)],64)):r("",!0),e.tab==="suppliers"?(l(),a(u,{key:1},[w(O,{onSelect:e.selectSuppliers},null,8,["onSelect"]),t("div",ts,[t("button",{onClick:s[6]||(s[6]=n=>e.tab="main"),class:"btn btn-primary p-3"},[s[20]||(s[20]=m("Выбрать ",-1)),(e.report.selected_suppliers||[]).length>0?(l(),a("span",es," ("+p(e.report.selected_suppliers.length)+") ",1)):r("",!0)]),t("button",{type:"button",onClick:s[7]||(s[7]=(...n)=>e.resetSuppliers&&e.resetSuppliers(...n)),class:"btn btn-light"},"Сбросить")])],64)):r("",!0),e.tab==="agents"?(l(),a(u,{key:2},[w(qe,{onSelect:e.selectAgents},null,8,["onSelect"]),t("div",ss,[t("button",{onClick:s[8]||(s[8]=n=>e.tab="main"),class:"btn btn-primary p-3"},[s[21]||(s[21]=m("Выбрать ",-1)),(e.report.selected_agents||[]).length>0?(l(),a("span",os," ("+p(e.report.selected_agents.length)+") ",1)):r("",!0)]),t("button",{type:"button",onClick:s[9]||(s[9]=(...n)=>e.resetAgents&&e.resetAgents(...n)),class:"btn btn-light"},"Сбросить")])],64)):r("",!0)],32))}});export{et as R,Pt as _,qe as a,P as b,ls as c,B as u};
