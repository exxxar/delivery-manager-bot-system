import{P as h,_ as f,a as _}from"./ProductList-BTeSx2Ja.js";import{u as v}from"./baseExports-DvkN-v-C.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as l,a as t,F as u,o as a,h as m,d as r,r as b,b as g,t as p,w as y,i as C,I as $,L as M}from"./app-kqq_ax9F.js";import{u as w,_ as S,P as E}from"./ProductCategoryList-C93MXW4j.js";import{P as k}from"./Pagination-Bt6uxHH4.js";import{u as B}from"./SupplierList-Bqt28g09.js";import{B as x}from"./BackBtn-De_9Dnic.js";import"./makeAxiosFactory-DcNQawBG.js";import"./useConfitmModalStore-_TLIiHym.js";const j={data(){return{jobStore:v()}},methods:{selectMenu(o){this.$emit("select",o)},exportProducts(o){this.jobStore.exportProducts(o)}}},I={class:"btn-group-vertical w-100",role:"group","aria-label":"Вертикальное меню"},D={class:"dropdown mt-2"},U={class:"dropdown-menu w-100"},F=["disabled"],V=["disabled"],z=["disabled"];function T(o,e,s,n,i,d){return a(),l(u,null,[t("div",I,[t("button",{type:"button",onClick:e[0]||(e[0]=c=>d.selectMenu("products")),class:"btn btn-outline-primary p-3"},"Общий список товаров "),t("button",{type:"button",onClick:e[1]||(e[1]=c=>d.selectMenu("products-by-supplier")),class:"btn btn-outline-primary p-3"},"Список товаров по поставщикам "),t("button",{type:"button",onClick:e[2]||(e[2]=c=>d.selectMenu("products-by-categories")),class:"btn btn-outline-primary p-3"},"Список товаров по категориям "),t("button",{type:"button",onClick:e[3]||(e[3]=c=>d.selectMenu("categories")),class:"btn btn-outline-primary p-3"},"Список категорий товаров "),t("button",{onClick:e[4]||(e[4]=c=>d.selectMenu("import-products")),type:"button",class:"btn btn-outline-primary p-3"},"Загрузить прайс с товарами и категориями ")]),t("div",D,[e[8]||(e[8]=t("button",{class:"btn btn-outline-primary p-3 dropdown-toggle w-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Скачать таблицу с товарами ",-1)),t("ul",U,[t("li",null,[t("button",{type:"button",disabled:i.jobStore.loading,class:"dropdown-item",onClick:e[5]||(e[5]=c=>d.exportProducts(0))}," Список всех товаров ",8,F)]),t("li",null,[t("button",{type:"button",disabled:i.jobStore.loading,onClick:e[6]||(e[6]=c=>d.exportProducts(1)),class:"dropdown-item"}," Список по категориям ",8,V)]),t("li",null,[t("button",{type:"button",disabled:i.jobStore.loading,onClick:e[7]||(e[7]=c=>d.exportProducts(2)),class:"dropdown-item"}," Список по поставщикам ",8,z)])])])],64)}const N=P(j,[["render",T]]),O={class:"card-header"},W={class:"mb-0"},L={class:"card-body"},A={key:0,class:"text-muted small"},q={key:1,class:"text-muted small"},G={class:"list-group list-group-flush"},H=["onClick"],J={class:"badge bg-success"},K={key:2,class:"mt-3 text-center"},Q=["onClick"],R={key:0,class:"alert alert-info mt-3"},X={class:"modal fade",id:"viewProductModal",tabindex:"-1"},Y={class:"modal-dialog modal-lg"},Z={class:"modal-content"},tt={class:"modal-body"},et={name:"Suppliers",components:{ProductCard:h},data(){return{supplierStore:B(),selectedProduct:null,pageMap:{}}},mounted(){this.fetchSuppliers()},methods:{async fetchDataByUrl(o){await this.supplierStore.fetchByUrl(o)},openView(o){this.selectedProduct=o,new bootstrap.Modal(document.getElementById("viewProductModal")).show()},async fetchSuppliers(){await this.supplierStore.fetchSupplierWithProducts()},async loadMore(o){this.pageMap[o]||(this.pageMap[o]=1),this.pageMap[o]++,await this.supplierStore.loadMoreSupplierProducts(o,this.pageMap[o])},closeEdit(){bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()},openEdit(o){this.$emit("edit-product",o),bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()}}},ot=Object.assign(et,{setup(o){return(e,s)=>(a(),l(u,null,[(a(!0),l(u,null,b(e.supplierStore.items,n=>{var i;return a(),l("div",{key:n.id,class:"card mb-2"},[t("div",O,[t("h6",W,p(n.name)+" ("+p(n.products_count||0)+"ед.)",1)]),t("div",L,[n.description?(a(),l("p",A,p(n.description),1)):r("",!0),n.address?(a(),l("p",q,p(n.address),1)):r("",!0),t("ul",G,[(a(!0),l(u,null,b(n.products,d=>(a(),l("li",{key:d.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("span",{onClick:y(c=>e.openView(d),["prevent"]),class:"small text-primary btn-link"},p(d.name),9,H),t("span",J,p(d.price)+" ₽",1)]))),128))]),((i=n.products)==null?void 0:i.length)<n.products_count?(a(),l("div",K,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:d=>e.loadMore(n.id)}," Загрузить ещё ",8,Q)])):r("",!0)])])}),128)),m(k,{pagination:e.supplierStore.pagination,onPageChanged:e.fetchDataByUrl},null,8,["pagination","onPageChanged"]),e.supplierStore.items.length===0?(a(),l("div",R," Товаров пока нет. ")):r("",!0),t("div",X,[t("div",Y,[t("div",Z,[s[0]||(s[0]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Карточка товара"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",tt,[e.selectedProduct?(a(),g(h,{key:0,product:e.selectedProduct,onClose:e.closeEdit,onEdit:e.openEdit},null,8,["product","onClose","onEdit"])):r("",!0)])])])])],64))}}),st={class:"card-header"},nt={class:"mb-0"},at={class:"card-body"},dt={key:0,class:"text-muted small"},lt={class:"list-group list-group-flush"},it=["onClick"],rt={class:"badge bg-success"},ut={key:1,class:"mt-2 text-center"},ct=["onClick"],pt={key:0,class:"alert alert-info mt-3"},mt={class:"modal fade",id:"viewProductModal",tabindex:"-1"},bt={class:"modal-dialog modal-lg"},gt={class:"modal-content"},ht={class:"modal-body"},yt={name:"Categories",components:{ProductCard:h},data(){return{productCategoryStore:w(),selectedProduct:null,pageMap:{}}},mounted(){this.fetchProductsByCategory()},methods:{async fetchDataByUrl(o){await this.productCategoryStore.fetchByUrl(o)},async fetchProductsByCategory(){await this.productCategoryStore.fetchProductsByCategory()},openView(o){this.selectedProduct=o,new bootstrap.Modal(document.getElementById("viewProductModal")).show()},async loadMore(o){this.pageMap[o]||(this.pageMap[o]=1),this.pageMap[o]++,await this.productCategoryStore.loadMoreProductsInCategory(o,this.pageMap[o])},closeEdit(){bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()},openEdit(o){this.$emit("edit-product",o),bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()}}},ft=Object.assign(yt,{setup(o){return(e,s)=>(a(),l(u,null,[(a(!0),l(u,null,b(e.productCategoryStore.items,n=>{var i;return a(),l("div",{key:n.id,class:"card mb-2"},[t("div",st,[t("h6",nt,p(n.name)+" ("+p(n.products_count||0)+" ед.)",1)]),t("div",at,[n.description?(a(),l("p",dt,p(n.description),1)):r("",!0),t("ul",lt,[(a(!0),l(u,null,b(n.products,d=>(a(),l("li",{key:d.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("span",{onClick:y(c=>e.openView(d),["prevent"]),class:"small"},p(d.name),9,it),t("span",rt,p(d.price)+" ₽",1)]))),128))]),((i=n.products)==null?void 0:i.length)<n.products_count?(a(),l("div",ut,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:d=>e.loadMore(n.id)}," Загрузить ещё ",8,ct)])):r("",!0)])])}),128)),m(k,{pagination:e.productCategoryStore.pagination,onPageChanged:e.fetchDataByUrl},null,8,["pagination","onPageChanged"]),e.productCategoryStore.items.length===0?(a(),l("div",pt," Товаров пока нет. ")):r("",!0),t("div",mt,[t("div",bt,[t("div",gt,[s[0]||(s[0]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Карточка товара"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",ht,[e.selectedProduct?(a(),g(h,{key:0,product:e.selectedProduct,onClose:e.closeEdit,onEdit:e.openEdit},null,8,["product","onClose","onEdit"])):r("",!0)])])])])],64))}}),vt="/bot-api/imports",Pt=C("import",{state:()=>({uploading:!1,message:null,error:null}),actions:{async uploadProductWithCategoriesExcel(o){var s,n;this.uploading=!0,this.message=null,this.error=null;const e=$();e.show("Загрузка файла началась");try{const i=new FormData;i.append("excel",o);const{data:d}=await M.post(`${vt}/import-products-with-categories`,i,{headers:{"Content-Type":"multipart/form-data"}});this.message=d.message||"Файл успешно загружен",e.show(this.message,"success")}catch(i){const d=i;this.error=((n=(s=d.response)==null?void 0:s.data)==null?void 0:n.message)||"Ошибка при загрузке файла",e.show(this.error,"error")}finally{this.uploading=!1}}}}),kt={name:"ImportProducts",data(){return{file:null,jobStore:v(),store:Pt()}},methods:{onFileChange(o){this.file=o.target.files[0]},exportProducts(o){this.jobStore.exportProducts(o)},async handleUpload(){this.file&&await this.store.uploadProductWithCategoriesExcel(this.file)}}},_t={class:"card mb-2"},Ct={class:"card-body"},$t={class:"mb-3"},Mt=["disabled"],wt={key:0,class:"alert alert-success mb-0"},St={key:1,class:"alert alert-danger mb-0"},Et=["disabled"];function Bt(o,e,s,n,i,d){return a(),l(u,null,[e[4]||(e[4]=t("p",{class:"alert alert-info"}," При импорте товаров будут созданы также категории и поставщики, которых еще нет в системе. ",-1)),t("div",_t,[e[3]||(e[3]=t("div",{class:"card-header bg-primary text-white"},[t("h6",{class:"mb-0"},"Импорт Excel-файла с продуктами")],-1)),t("div",Ct,[t("form",{onSubmit:e[1]||(e[1]=y((...c)=>d.handleUpload&&d.handleUpload(...c),["prevent"]))},[t("div",$t,[t("input",{type:"file",class:"form-control",onChange:e[0]||(e[0]=(...c)=>d.onFileChange&&d.onFileChange(...c)),accept:".xlsx,.xls"},null,32)]),t("button",{class:"btn btn-success w-100 p-3 mb-2",type:"submit",disabled:i.store.uploading||!i.file},p(i.store.uploading?"Загрузка...":"Загрузить"),9,Mt)],32),i.store.message?(a(),l("div",wt,p(i.store.message),1)):r("",!0),i.store.error?(a(),l("div",St,p(i.store.error),1)):r("",!0)])]),t("button",{type:"button",disabled:i.jobStore.loading,class:"btn btn-outline-light text-primary w-100 p-3",onClick:e[2]||(e[2]=c=>d.exportProducts(0))}," Скачать пример ",8,Et)],64)}const xt=P(kt,[["render",Bt]]),jt={class:"container-fluid p-3"},It={key:1,class:"alert alert-info"},Dt={class:"navbar fixed-bottom p-3"},Ut={class:"modal fade",id:"createProductModal",tabindex:"-1"},Ft={class:"modal-dialog modal-lg"},Vt={class:"modal-content"},zt={class:"modal-body"},Tt={class:"modal fade",id:"createCategoryModal",tabindex:"-1"},Nt={class:"modal-dialog"},Ot={class:"modal-content"},Wt={class:"modal-body"},Lt={data(){return{loading:!1,selectedProduct:null,tab:"menu"}},mounted(){},methods:{openProductModal(){this.loading=!0,this.$nextTick(()=>{this.loading=!1,new bootstrap.Modal(document.getElementById("createProductModal")).show()})},selectMenu(o){this.tab=o},openEditProduct(o){this.selectMenu("product"),this.selectedProduct=o},fetchProducts(){const o=bootstrap.Modal.getInstance(document.getElementById("createProductModal"));o&&o.hide(),this.loading=!0,this.$nextTick(()=>{this.loading=!1})},fetchData(){const o=bootstrap.Modal.getInstance(document.getElementById("createCategoryModal"));o&&o.hide(),this.loading=!0,this.$nextTick(()=>{this.loading=!1})}}},Zt=Object.assign(Lt,{__name:"ProductPage",setup(o){return(e,s)=>(a(),l(u,null,[t("div",jt,[e.tab==="menu"?(a(),l(u,{key:0},[m(x),m(N,{onSelect:e.selectMenu},null,8,["onSelect"])],64)):r("",!0),e.tab==="product"?(a(),l(u,{key:1},[t("button",{onClick:s[0]||(s[0]=n=>e.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),e.selectedProduct?(a(),g(f,{key:0,"initial-data":e.selectedProduct},null,8,["initial-data"])):(a(),l("p",It," Продукт не выбран "))],64)):r("",!0),e.tab==="products"?(a(),l(u,{key:2},[t("button",{onClick:s[1]||(s[1]=n=>e.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[7]||(s[7]=t("h4",{class:"mb-3"},"Список товаров",-1)),m(_),t("nav",Dt,[t("button",{type:"button",onClick:s[2]||(s[2]=(...n)=>e.openProductModal&&e.openProductModal(...n)),class:"btn w-100 p-3 btn-primary"}," Добавить товар ")])],64)):r("",!0),e.tab==="products-by-supplier"?(a(),l(u,{key:3},[t("button",{onClick:s[3]||(s[3]=n=>e.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[8]||(s[8]=t("h4",{class:"mb-3"},"Список товаров по поставщику",-1)),m(ot,{onEditProduct:e.openEditProduct},null,8,["onEditProduct"])],64)):r("",!0),e.tab==="products-by-categories"?(a(),l(u,{key:4},[t("button",{onClick:s[4]||(s[4]=n=>e.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[9]||(s[9]=t("h4",{class:"mb-3"},"Список товаров по категориям",-1)),m(ft,{onEditProduct:e.openEditProduct},null,8,["onEditProduct"])],64)):r("",!0),e.tab==="categories"?(a(),l(u,{key:5},[t("button",{onClick:s[5]||(s[5]=n=>e.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[10]||(s[10]=t("h4",{class:"mb-3"},"Категории товара",-1)),m(S),s[11]||(s[11]=t("nav",{class:"navbar fixed-bottom p-3"},[t("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#createCategoryModal",class:"btn w-100 p-3 btn-primary"}," Добавить категорию ")],-1))],64)):r("",!0),e.tab==="import-products"?(a(),l(u,{key:6},[t("button",{onClick:s[6]||(s[6]=n=>e.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),m(xt)],64)):r("",!0)]),t("div",Ut,[t("div",Ft,[t("div",Vt,[s[12]||(s[12]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Добавление товара"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",zt,[e.loading?r("",!0):(a(),g(f,{key:0,onSaved:e.fetchProducts},null,8,["onSaved"]))])])])]),t("div",Tt,[t("div",Nt,[t("div",Ot,[s[13]||(s[13]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Создание новой категории товара"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Wt,[m(E,{onSaved:e.fetchData},null,8,["onSaved"])])])])])],64))}});export{Zt as default};
