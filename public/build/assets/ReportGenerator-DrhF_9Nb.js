import{c as i,o as l,b as t,e as d,i as p,t as m,F as u,w as g,v as b,h as f,f as D,H as R,d as v,r as _,J as C,k,a as w,E as V,n as T}from"./app-BSfqWmA-.js";import{_ as j}from"./SupplierList-CfSBhpcl.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as E}from"./Pagination-D-b0grSt.js";import{U as M}from"./UserForm-DR9phqWl.js";import{u as O}from"./baseExports-COkBHPT9.js";import{m as c}from"./makeAxiosFactory-C9uqYQX0.js";import{u as I}from"./useConfitmModalStore-CIqRMjNy.js";const G={name:"AgentInfo",props:{agent:{type:Object,required:!0}}},F={class:"list-group list-group-flush"},L={class:"list-group-item"},q={class:"list-group-item"},N={class:"list-group-item"},z={class:"list-group-item"},W={class:"list-group-item"},H={key:0,class:"list-group-item"};function J(o,e,s,n,r,$){var a;return l(),i(u,null,[t("ul",F,[t("li",L,[e[1]||(e[1]=t("strong",null,"ID:",-1)),p(" "+m(s.agent.id),1)]),t("li",q,[e[2]||(e[2]=t("strong",null,"Имя:",-1)),p(" "+m(s.agent.name),1)]),t("li",N,[e[3]||(e[3]=t("strong",null,"Телефон:",-1)),p(" "+m(s.agent.phone),1)]),t("li",z,[e[4]||(e[4]=t("strong",null,"Email:",-1)),p(" "+m(s.agent.email),1)]),t("li",W,[e[5]||(e[5]=t("strong",null,"Регион:",-1)),p(" "+m(s.agent.region),1)]),s.agent.in_learning?(l(),i("li",H,[e[6]||(e[6]=t("strong",null,"Обучается у: ",-1)),s.agent.mentor?(l(),i(u,{key:0},[p(m(((a=s.agent.mentor)==null?void 0:a.name)||"-"),1)],64)):(l(),i(u,{key:1},[p(" Наставник не указан ")],64))])):d("",!0)]),t("button",{class:"btn btn-primary p-3 w-100",onClick:e[0]||(e[0]=S=>o.$emit("edit",s.agent))},"Редактировать")],64)}const K=U(G,[["render",J]]),Q={name:"ReportIndividualGenerator",props:["agentId"],data(){return{reportStore:O(),report:{startDate:"",endDate:""}}},methods:{generateReport(){const o={...this.report,id:this.agentId};this.reportStore.exportIndividual(o),this.$emit("generate-report",o)}}},X={class:"form-floating mb-2"},Y={class:"form-floating mb-2"},Z=["disabled"];function x(o,e,s,n,r,$){return l(),i("form",{onSubmit:e[2]||(e[2]=f((...a)=>$.generateReport&&$.generateReport(...a),["prevent"]))},[t("div",X,[g(t("input",{type:"date",class:"form-control",id:"startDate","onUpdate:modelValue":e[0]||(e[0]=a=>r.report.startDate=a),required:""},null,512),[[b,r.report.startDate]]),e[3]||(e[3]=t("label",{for:"startDate"},"Дата начала периода",-1))]),t("div",Y,[g(t("input",{type:"date",class:"form-control",id:"endDate","onUpdate:modelValue":e[1]||(e[1]=a=>r.report.endDate=a),required:""},null,512),[[b,r.report.endDate]]),e[4]||(e[4]=t("label",{for:"endDate"},"Дата окончания периода",-1))]),t("button",{disabled:r.report.loading,type:"submit",class:"btn btn-primary p-3 w-100"}," Сформировать отчёт ",8,Z)],32)}const tt=U(Q,[["render",x]]),A="/bot-api/admins",et=D("admins",{state:()=>({items:[],loading:!1,error:null}),getters:{byId:o=>e=>o.items.find(s=>s.id===e)},actions:{async fetchAdminsByPage(o=1){const{data:e}=await c(`${A}?page=${o}`,"GET");this.items=e.data,this.pagination=e},async fetchByUrl(o){const{data:e}=await c(o,"GET");this.items=e.data,this.pagination=e},async downloadPersonalAdminReport(o){var s,n;const e=R();e.show("Подготавливаем отчет"),this.loading=!0,this.error=null;try{const{data:r}=await c(`${A}/download-personal-report`,"POST",o);return e.show("Отчет отправлен","success"),r}catch(r){throw this.error=((n=(s=r.response)==null?void 0:s.data)==null?void 0:n.message)??"Ошибка отправки отчёта",e.show(this.error,"error"),r}finally{this.loading=!1}},async downloadReport(o){var e,s;this.loading=!0,this.error=null;try{const{data:n}=await c(`${A}/download-report`,"POST",o);return n}catch(n){throw this.error=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)??"Ошибка отправки отчёта",n}finally{this.loading=!1}}}}),st={class:"list-group"},ot=["onClick"],nt={class:"badge bg-primary"},lt={class:"text-muted mb-0 small"},it={class:"text-muted mb-2 small"},at={class:"form-check form-switch"},dt=["onChange","onUpdate:modelValue","id"],rt=["for"],mt={class:"dropdown"},pt={class:"dropdown-menu dropdown-menu-end"},ut={key:0},gt=["onClick"],ct=["onClick"],ft=["onClick"],bt=["onClick"],ht={key:1,class:"alert alert-info mt-3"},yt={class:"modal fade",id:"reportModal",tabindex:"-1"},vt={class:"modal-dialog"},$t={class:"modal-content"},kt={class:"modal-body"},wt={class:"modal fade",id:"roleSwitcherUserModal",tabindex:"-1"},St={class:"modal-dialog modal-lg"},At={class:"modal-content"},Ct={class:"modal-body"},Dt={class:"form-floating mb-2"},_t={class:"modal fade",id:"editUserModal",tabindex:"-1"},Ut={class:"modal-dialog modal-lg"},Et={class:"modal-content"},Mt={class:"modal-body"},It={name:"AdminList",props:["forSelect"],data(){return{adminsStore:et(),userStore:I(),selectedAdmin:null}},created(){this.fetchData()},methods:{selectAdmin(o){this.forSelect&&this.$emit("select",o)},openRoleSwitcher(o){this.selectedAdmin=o,new bootstrap.Modal(document.getElementById("roleSwitcherUserModal")).show()},openEdit(o){this.selectedAdmin=o,new bootstrap.Modal(document.getElementById("editUserModal")).show()},async changeAdminWorkStatus(o){await this.userStore.updateWorkStatus(o.id,o.is_work)},async handleReport(o){o.user_id=this.selectedAdmin.id,await this.adminsStore.downloadPersonalAdminReport(o)},async fetchData(o=1){await this.adminsStore.fetchAdminsByPage(o).then(()=>{const e=bootstrap.Modal.getInstance(document.getElementById("editUserModal"));e&&e.hide()})},async fetchDataByUrl(o){await this.adminsStore.fetchByUrl(o)},async downloadReport(o){await this.adminsStore.downloadReport(o)},async changeRole(){await this.userStore.updateRole(this.selectedAdmin.id,this.selectedAdmin.role).then(()=>{this.fetchData(),bootstrap.Modal.getInstance(document.getElementById("roleSwitcherUserModal")).hide()})}}},Bt=Object.assign(It,{setup(o){return(e,s)=>(l(),i(u,null,[t("ul",st,[(l(!0),i(u,null,_(e.adminsStore.items,n=>(l(),i("li",{key:n.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",null,[t("div",{onClick:r=>e.selectAdmin(n),class:"fw-bold"},[t("span",nt,m(n.percent)+"%",1),p(" "+m(n.name)+" ",1),t("p",lt,m(n.phone||"Телефон не указан"),1),t("p",it,m(n.email),1)],8,ot),t("div",at,[g(t("input",{onChange:r=>e.changeAdminWorkStatus(n),class:"form-check-input",type:"checkbox","onUpdate:modelValue":r=>n.is_work=r,id:`is-work-${n.id}`},null,40,dt),[[k,n.is_work]]),t("label",{class:"form-check-label",for:`is-work-${n.id}`},m(n.is_work?"работает":"не работает"),9,rt)])]),t("div",mt,[s[2]||(s[2]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",pt,[o.forSelect?(l(),i("li",ut,[t("a",{class:"dropdown-item",href:"#",onClick:f(r=>e.selectAdmin(n),["prevent"])},"Выбрать",8,gt)])):d("",!0),o.forSelect?d("",!0):(l(),i(u,{key:1},[t("li",null,[t("button",{type:"button",onClick:r=>e.selectedAdmin=n,class:"dropdown-item","data-bs-toggle":"modal","data-bs-target":"#reportModal"}," Сформировать отчет ",8,ct)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:f(r=>e.openRoleSwitcher(n),["prevent"])},"Сменить роль",8,ft)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:f(r=>e.openEdit(n),["prevent"])},"Редактировать",8,bt)])],64))])])]))),128))]),e.adminsStore.items.length>0?(l(),v(E,{key:0,pagination:e.adminsStore.pagination,onPageChanged:e.fetchDataByUrl},null,8,["pagination","onPageChanged"])):d("",!0),e.adminsStore.items.length===0?(l(),i("div",ht," Администраторов пока нет. ")):d("",!0),t("div",yt,[t("div",vt,[t("div",$t,[s[3]||(s[3]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Отчет по администратору"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",kt,[e.selectedAdmin?(l(),v(ts,{key:0,type:"admins","is-simple":!0,"object-id":e.selectedAdmin.id,onGenerateReport:e.handleReport},null,8,["object-id","onGenerateReport"])):d("",!0)])])])]),t("div",wt,[t("div",St,[t("div",At,[s[7]||(s[7]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование пользователя"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Ct,[e.selectedAdmin?(l(),i("form",{key:0,onSubmit:s[1]||(s[1]=f((...n)=>e.changeRole&&e.changeRole(...n),["prevent"]))},[t("div",Dt,[g(t("select",{"onUpdate:modelValue":s[0]||(s[0]=n=>e.selectedAdmin.role=n),class:"form-select",id:"role",required:""},[...s[4]||(s[4]=[t("option",{value:0},"Пользователь",-1),t("option",{value:1},"Администратор",-1),t("option",{value:2},"Поставщик",-1),t("option",{value:3},"Старший администратор",-1)])],512),[[C,e.selectedAdmin.role]]),s[5]||(s[5]=t("label",{for:"role"},"Роль",-1))]),s[6]||(s[6]=t("button",{type:"submit",class:"btn btn-primary w-100 p-3"}," Сохранить изменения ",-1))],32)):d("",!0)])])])]),t("div",_t,[t("div",Ut,[t("div",Et,[s[8]||(s[8]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование администратора"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Mt,[e.selectedAdmin?(l(),v(M,{key:0,initialData:e.selectedAdmin,onSaved:e.fetchData},null,8,["initialData","onSaved"])):d("",!0)])])])])],64))}}),y="/bot-api/agents",B=D("agents",{state:()=>({items:[],loading:!1,error:null}),getters:{byId:o=>e=>o.items.find(s=>s.id===e)},actions:{async fetchAll(){this.loading=!0,this.error=null;try{const{data:o}=await c(`${y}`,"GET");this.items=o}catch(o){this.error=(o==null?void 0:o.message)||"Failed to load agents"}finally{this.loading=!1}},async fetchAllByPage(o=1,e=20){const{data:s}=await c(`${y}?page=${o}&size=${e}`,"GET");this.items=s.data,this.pagination=s},async fetchByUrl(o){const{data:e}=await c(o,"GET");this.items=e.data,this.pagination=e},async fetchOne(o){try{const{data:e}=await c(`${y}/${o}`,"GET");return e}catch(e){throw this.error=(e==null?void 0:e.message)||"Failed to load agent",e}},async create(o){const{data:e}=await c(`${y}`,"POST",o);return this.items.push(e),e},async update(o,e){const{data:s}=await c(`${y}/${o}`,"PUT",e),n=this.items.findIndex(r=>r.id===o);return n!==-1&&(this.items[n]=s),s},async remove(o){await c(`${y}/${o}`,"DELETE"),this.items=this.items.filter(e=>e.id!==o)},async downloadSelReport(o){var e,s;this.loading=!0,this.error=null;try{const{data:n}=await c(`${y}/download-self-report`,"POST",o);return n}catch(n){throw this.error=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)??"Ошибка отправки отчёта",n}finally{this.loading=!1}}}}),Pt={class:"form-floating mb-2"},Rt={class:"form-floating mb-2"},Vt={class:"form-floating mb-2"},Tt={class:"form-floating mb-2"},jt={class:"form-check form-switch mb-2"},Ot={class:"form-check-label",for:"in_learning"},Gt={key:0,class:"fw-bold text-primary"},Ft={key:1,class:"fw-bold text-primary"},Lt={class:"input-group mb-2"},qt={class:"form-floating flex-grow-1"},Nt=["value"],zt={class:"form-check form-switch mb-2"},Wt={class:"form-floating mb-2"},Ht={class:"form-floating mb-2"},Jt={name:"AgentForm",props:{initialData:{type:Object,default:null}},data(){return{agentStore:B(),isEdit:!1,configLearningPeriod:!1,tab:"main",form:{name:"",phone:"",email:"",region:"",start_learning_date:null,end_learning_date:null,in_learning:!1},mentorName:null}},created(){var o;this.initialData&&(this.form={...this.initialData},this.isEdit=!0,this.mentorName=((o=this.initialData.mentor)==null?void 0:o.name)||"")},methods:{selectAdmin(o){this.form.mentor_id=o.id,this.mentorName=o.name,this.tab="main"},async submitForm(){this.isEdit?this.agentStore.update(this.form.id,this.form):this.agentStore.create(this.form),this.$emit("callback")}}},P=Object.assign(Jt,{setup(o){return(e,s)=>(l(),i("form",{onSubmit:s[10]||(s[10]=f((...n)=>e.submitForm&&e.submitForm(...n),["prevent"]))},[e.tab==="main"?(l(),i(u,{key:0},[t("div",Pt,[g(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>e.form.name=n),type:"text",class:"form-control",id:"name",placeholder:"Имя",required:""},null,512),[[b,e.form.name]]),s[11]||(s[11]=t("label",{for:"name"},"Имя",-1))]),t("div",Rt,[g(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.form.phone=n),type:"tel",class:"form-control",id:"phone",placeholder:"Телефон",required:""},null,512),[[b,e.form.phone]]),s[12]||(s[12]=t("label",{for:"phone"},"Телефон",-1))]),t("div",Vt,[g(t("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>e.form.email=n),type:"email",class:"form-control",id:"email",placeholder:"Email",required:""},null,512),[[b,e.form.email]]),s[13]||(s[13]=t("label",{for:"email"},"Email",-1))]),t("div",Tt,[g(t("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>e.form.region=n),type:"text",class:"form-control",id:"region",placeholder:"Регион"},null,512),[[b,e.form.region]]),s[14]||(s[14]=t("label",{for:"region"},"Регион",-1))]),t("div",jt,[g(t("input",{"onUpdate:modelValue":s[4]||(s[4]=n=>e.form.in_learning=n),class:"form-check-input",type:"checkbox",role:"switch",id:"in_learning"},null,512),[[k,e.form.in_learning]]),t("label",Ot,[s[15]||(s[15]=p("На обучении ",-1)),e.form.in_learning?(l(),i("span",Gt,"включено")):(l(),i("span",Ft,"выключено"))])]),e.form.in_learning?(l(),i(u,{key:0},[s[21]||(s[21]=t("p",{class:"alert alert-info mb-2"},"Назначение ответственного за обучение (наставника)",-1)),t("div",Lt,[t("div",qt,[t("input",{type:"text",class:"form-control",id:"admin",value:e.mentorName,placeholder:"Администратор",readonly:""},null,8,Nt),s[16]||(s[16]=t("label",{for:"admin"},"Старший администратор",-1))]),t("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:s[5]||(s[5]=n=>e.tab="admin")},"Выбрать ")]),t("div",zt,[g(t("input",{"onUpdate:modelValue":s[6]||(s[6]=n=>e.configLearningPeriod=n),class:"form-check-input",type:"checkbox",role:"switch",id:"configLearningPeriod"},null,512),[[k,e.configLearningPeriod]]),s[17]||(s[17]=t("label",{class:"form-check-label",for:"configLearningPeriod"},"Настройка периода обучения ",-1))]),e.configLearningPeriod?(l(),i(u,{key:0},[s[20]||(s[20]=t("p",{class:"alert alert-info mb-2"},"Период настраивается автоматически после того как вы задали что Админстратор находится на обучении",-1)),t("div",Wt,[g(t("input",{"onUpdate:modelValue":s[7]||(s[7]=n=>e.form.start_learning_date=n),type:"date",class:"form-control",id:"sale_date"},null,512),[[b,e.form.start_learning_date]]),s[18]||(s[18]=t("label",{for:"sale_date"},"Дата начала обучения",-1))]),t("div",Ht,[g(t("input",{"onUpdate:modelValue":s[8]||(s[8]=n=>e.form.end_learning_date=n),type:"date",class:"form-control",id:"sale_date"},null,512),[[b,e.form.end_learning_date]]),s[19]||(s[19]=t("label",{for:"sale_date"},"Дата окончания обучения",-1))])],64)):d("",!0)],64)):d("",!0)],64)):d("",!0),e.tab==="admin"?(l(),i(u,{key:1},[t("button",{onClick:s[9]||(s[9]=n=>e.tab="main"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"0px","z-index":"100"}},"Назад "),w(Bt,{"for-select":!0,onSelect:e.selectAdmin},null,8,["onSelect"])],64)):d("",!0),s[22]||(s[22]=t("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Сохранить",-1))],32))}}),Kt={class:"form-floating mb-3"},Qt={key:0,class:"d-flex justify-content-between"},Xt={key:0,class:"small"},Yt={class:"fw-bold"},Zt={class:"list-group"},xt=["onClick"],te={class:"fw-bold"},ee={key:0,class:"badge bg-success"},se=["onClick"],oe={key:1,class:"small text-success"},ne=["onClick"],le={class:"text-muted"},ie={class:"dropdown"},ae={class:"dropdown-menu dropdown-menu-end"},de={key:0},re=["onClick"],me=["onClick"],pe=["onClick"],ue=["onClick"],ge=["onClick"],ce={class:"form-floating my-2"},fe={class:"modal fade",id:"agentInfoModal",tabindex:"-1"},be={class:"modal-dialog"},he={class:"modal-content"},ye={class:"modal-body"},ve={class:"modal fade",id:"deleteModal",tabindex:"-1"},$e={class:"modal-dialog"},ke={class:"modal-content"},we={class:"modal-body"},Se={class:"modal-footer"},Ae={class:"modal fade",id:"editAgentModal",tabindex:"-1"},Ce={class:"modal-dialog modal-lg"},De={class:"modal-content"},_e={class:"modal-body"},Ue={class:"modal fade",id:"editUserModal",tabindex:"-1"},Ee={class:"modal-dialog modal-lg"},Me={class:"modal-content"},Ie={class:"modal-body"},Be={class:"modal fade",id:"personalStatisticModal",tabindex:"-1"},Pe={class:"modal-dialog modal-lg"},Re={class:"modal-content"},Ve={class:"modal-body"},Te={name:"AgentList",components:{AgentForm:P},props:["forSelect"],data(){return{size:20,search:"",selectedAdmin:null,agentStore:B(),userStore:I(),selection:[],selectedAgent:null,report:{startDate:"",endDate:""}}},watch:{size:function(){this.fetchAgents()}},computed:{user(){return this.userStore.self||null},filteredAgents(){if(!this.search)return this.agentStore.items||[];const o=this.search.toLowerCase();return this.agentStore.items.filter(e=>Object.values(e).some(s=>s?String(s).toLowerCase().includes(o):!1))}},created(){this.fetchAgents()},methods:{toggleSelection(o){let e=this.selection.findIndex(s=>s===o);e===-1?this.selection.push(o):this.selection.splice(e,1),this.$emit("select",this.selection)},selectAll(){this.selection.length===0?this.agentStore.items.forEach(o=>{this.selection.indexOf(o.id)===-1&&this.selection.push(o.id)}):this.selection=[],this.$emit("select",this.selection)},generateReport(){bootstrap.Modal.getInstance(document.getElementById("personalStatisticModal")).hide()},openEdit(o){this.selectedAdmin=null,this.$nextTick(()=>{this.selectedAdmin=o,new bootstrap.Modal(document.getElementById("editUserModal")).show()})},async fetchAgents(o=1){await this.agentStore.fetchAllByPage(o,this.size)},async fetchAgentsByUrl(o){await this.agentStore.fetchByUrl(o)},selectAgent(o){this.forSelect&&this.$emit("select",o)},openAgentInfo(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("agentInfoModal")).show()},openPercents(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("percentsModal")).show()},confirmDelete(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("deleteModal")).show()},async deleteAgent(){try{await this.agentStore.remove(this.selectedAgent.id),bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide()}catch(o){console.error("Ошибка удаления:",o)}},getPersonalStatistic(o){this.selectedAgent=null,this.$nextTick(()=>{this.selectedAgent=o,new bootstrap.Modal(document.getElementById("personalStatisticModal")).show()})},openEditAgent(o){this.selectedAgent=null,this.$nextTick(()=>{this.selectedAgent=o,new bootstrap.Modal(document.getElementById("editAgentModal")).show()})}}},je=Object.assign(Te,{setup(o){return(e,s)=>{var n,r,$;return l(),i(u,null,[t("div",Kt,[g(t("input",{type:"search","onUpdate:modelValue":s[0]||(s[0]=a=>e.search=a),class:"form-control",id:"searchInput",placeholder:"Поиск..."},null,512),[[b,e.search]]),s[4]||(s[4]=t("label",{for:"searchInput"},"Поиск",-1))]),o.forSelect?d("",!0):(l(),i(u,{key:0},[(((n=e.user)==null?void 0:n.role)||0)>=3?(l(),i("div",Qt,[t("a",{href:"javascript:void(0)",onClick:s[1]||(s[1]=(...a)=>e.selectAll&&e.selectAll(...a)),class:"small"},"Выделить все"),e.selection.length>0?(l(),i("span",Xt,[s[5]||(s[5]=p("Выбрано ",-1)),t("span",Yt,m(e.selection.length),1),s[6]||(s[6]=p(" админов",-1))])):d("",!0)])):d("",!0)],64)),t("ul",Zt,[(l(!0),i(u,null,_(e.filteredAgents,a=>{var S;return l(),i("li",{key:a.id,class:T([{"border-primary":e.selection.indexOf(a.id)!==-1},"list-group-item d-flex justify-content-between align-items-center"])},[t("div",{onClick:h=>e.selectAgent(a)},[t("div",te,[a.in_learning?(l(),i("span",ee,[...s[7]||(s[7]=[t("i",{class:"fa-solid fa-user-graduate"},null,-1)])])):d("",!0),t("span",{onClick:h=>e.toggleSelection(a.id)},m(a.name),9,se),a.in_learning&&!o.forSelect?(l(),i("span",oe,[a.mentor?(l(),i("a",{key:0,onClick:h=>e.openEdit(a.mentor),href:"javascript:void(0)"},"("+m(((S=a.mentor)==null?void 0:S.name)||"-")+")",9,ne)):(l(),i(u,{key:1},[p(" Наставник не указан ")],64))])):d("",!0)]),t("small",le,m(a.phone)+" | "+m(a.email),1)],8,xt),t("div",ie,[s[9]||(s[9]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",ae,[o.forSelect?(l(),i("li",de,[t("a",{class:"dropdown-item",href:"#",onClick:f(h=>e.selectAgent(a),["prevent"])},"Выбрать",8,re)])):d("",!0),o.forSelect?d("",!0):(l(),i(u,{key:1},[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:f(h=>e.openAgentInfo(a),["prevent"])},"Просмотр",8,me)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:f(h=>e.openEditAgent(a),["prevent"])},"Редактировать",8,pe)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:f(h=>e.getPersonalStatistic(a),["prevent"])},"Выгрузка статистики",8,ue)]),s[8]||(s[8]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"#",onClick:f(h=>e.confirmDelete(a),["prevent"])},"Удалить",8,ge)])],64))])])],2)}),128))]),((r=e.agentStore.pagination)==null?void 0:r.total)>0?(l(),i(u,{key:1},[t("div",ce,[g(t("select",{id:"itemsPerPage",class:"form-select","onUpdate:modelValue":s[2]||(s[2]=a=>e.size=a)},[...s[10]||(s[10]=[V('<option value="10">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option><option value="500">500</option><option value="1000">1000</option><option value="5000">5000</option>',7)])],512),[[C,e.size]]),s[11]||(s[11]=t("label",{for:"itemsPerPage"},"Элементов на странице",-1))]),w(E,{pagination:e.agentStore.pagination,onPageChanged:e.fetchAgentsByUrl},null,8,["pagination","onPageChanged"])],64)):d("",!0),t("div",fe,[t("div",be,[t("div",he,[s[12]||(s[12]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Информация"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",ye,[e.selectedAgent?(l(),v(K,{key:0,agent:e.selectedAgent},null,8,["agent"])):d("",!0)])])])]),t("div",ve,[t("div",$e,[t("div",ke,[s[16]||(s[16]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title text-danger"},"Удаление"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",we,[s[13]||(s[13]=p(" Вы уверены, что хотите удалить ",-1)),t("strong",null,m(($=e.selectedAgent)==null?void 0:$.name),1),s[14]||(s[14]=p("? ",-1))]),t("div",Se,[s[15]||(s[15]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),t("button",{type:"button",class:"btn btn-danger",onClick:s[3]||(s[3]=(...a)=>e.deleteAgent&&e.deleteAgent(...a))},"Удалить")])])])]),t("div",Ae,[t("div",Ce,[t("div",De,[s[17]||(s[17]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",_e,[e.selectedAgent?(l(),v(P,{key:0,initialData:e.selectedAgent},null,8,["initialData"])):d("",!0)])])])]),t("div",Ue,[t("div",Ee,[t("div",Me,[s[18]||(s[18]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование администратора"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Ie,[e.selectedAdmin?(l(),v(M,{key:0,initialData:e.selectedAdmin,onSaved:e.fetchData},null,8,["initialData","onSaved"])):d("",!0)])])])]),t("div",Be,[t("div",Pe,[t("div",Re,[s[19]||(s[19]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Персональная статистика за период"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Ve,[e.selectedAgent?(l(),v(tt,{key:0,"agent-id":e.selectedAgent.id,onGenerateReport:e.generateReport},null,8,["agent-id","onGenerateReport"])):d("",!0)])])])])],64)}}}),Oe={class:"form-floating mb-2"},Ge={class:"form-floating mb-2"},Fe={class:"form-check form-switch mb-2"},Le={key:0},qe={key:1},Ne={class:"fw-bold"},ze={key:0},We={key:1},He={class:"fw-bold"},Je={class:"form-floating mb-2"},Ke=["disabled"],Qe={class:"btn-group w-100",style:{position:"sticky",bottom:"20px"},role:"group","aria-label":"Basic example"},Xe={key:0,class:"fw-bold"},Ye={class:"btn-group w-100",style:{position:"sticky",bottom:"20px"},role:"group","aria-label":"Basic example"},Ze={key:0,class:"fw-bold"},xe={name:"ReportGenerator",components:{},props:["type","isSimple"],data(){return{need_more_options:!1,tab:"main",report:{result_type:0,startDate:"",endDate:"",type:this.type||"",restriction:null,selected_suppliers:[],selected_agents:[]}}},watch:{need_more_options:function(){this.need_more_options||(this.report.selected_suppliers=[],this.report.selected_agents=[])}},methods:{selectSuppliers(o){this.report.selected_suppliers=o},selectAgents(o){this.report.selected_agents=o},resetSuppliers(){this.report.selected_suppliers=[],this.tab="main"},resetAgents(){this.report.selected_agents=[],this.tab="main"},generateReport(){const o={...this.report};this.$emit("generate-report",o)}}},ts=Object.assign(xe,{setup(o){return(e,s)=>(l(),i("form",{onSubmit:s[10]||(s[10]=f((...n)=>e.generateReport&&e.generateReport(...n),["prevent"]))},[e.tab==="main"?(l(),i(u,{key:0},[t("div",Oe,[g(t("input",{type:"date",class:"form-control",id:"startDate","onUpdate:modelValue":s[0]||(s[0]=n=>e.report.startDate=n),required:""},null,512),[[b,e.report.startDate]]),s[11]||(s[11]=t("label",{for:"startDate"},"Дата начала периода",-1))]),t("div",Ge,[g(t("input",{type:"date",class:"form-control",id:"endDate","onUpdate:modelValue":s[1]||(s[1]=n=>e.report.endDate=n),required:""},null,512),[[b,e.report.endDate]]),s[12]||(s[12]=t("label",{for:"endDate"},"Дата окончания периода",-1))]),t("div",Fe,[g(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=n=>e.need_more_options=n),id:"need_more_options"},null,512),[[k,e.need_more_options]]),s[13]||(s[13]=t("label",{class:"form-check-label",for:"need_more_options"}," Больше параметров отчета ",-1))]),e.need_more_options?(l(),i(u,{key:0},[t("button",{onClick:s[3]||(s[3]=n=>e.tab="suppliers"),type:"button",class:"btn btn-outline-light text-primary p-3 mb-2 w-100"},[(e.report.selected_suppliers||[]).length===0?(l(),i("span",Le," Выбрать поставщиков ")):(l(),i("span",qe,[s[14]||(s[14]=p(" Выбрано ",-1)),t("span",Ne,m(e.report.selected_suppliers.length),1),s[15]||(s[15]=p(" поставщиков ",-1))]))]),t("button",{onClick:s[4]||(s[4]=n=>e.tab="agents"),type:"button",class:"btn btn-outline-light text-primary p-3 mb-2 w-100"},[(e.report.selected_agents||[]).length===0?(l(),i("span",ze," Выбрать администраторов ")):(l(),i("span",We,[s[16]||(s[16]=p(" Выбрано ",-1)),t("span",He,m(e.report.selected_agents.length),1),s[17]||(s[17]=p(" админов ",-1))]))]),t("div",Je,[g(t("select",{"onUpdate:modelValue":s[5]||(s[5]=n=>e.report.result_type=n),class:"form-select",id:"floatingSelect","aria-label":"Floating label select example"},[...s[18]||(s[18]=[t("option",{value:"0"},"Классический отчет",-1),t("option",{value:"1"},"Расширенный отчет",-1)])],512),[[C,e.report.result_type]]),s[19]||(s[19]=t("label",{for:"floatingSelect"},"Как вывести результат",-1))])],64)):d("",!0),t("button",{disabled:e.report.loading,type:"submit",class:"btn btn-primary p-3 w-100"}," Сформировать отчёт ",8,Ke)],64)):d("",!0),e.tab==="suppliers"?(l(),i(u,{key:1},[w(j,{onSelect:e.selectSuppliers},null,8,["onSelect"]),t("div",Qe,[t("button",{onClick:s[6]||(s[6]=n=>e.tab="main"),class:"btn btn-primary p-3"},[s[20]||(s[20]=p("Выбрать ",-1)),(e.report.selected_suppliers||[]).length>0?(l(),i("span",Xe," ("+m(e.report.selected_suppliers.length)+") ",1)):d("",!0)]),t("button",{type:"button",onClick:s[7]||(s[7]=(...n)=>e.resetSuppliers&&e.resetSuppliers(...n)),class:"btn btn-light"},"Сбросить")])],64)):d("",!0),e.tab==="agents"?(l(),i(u,{key:2},[w(je,{onSelect:e.selectAgents},null,8,["onSelect"]),t("div",Ye,[t("button",{onClick:s[8]||(s[8]=n=>e.tab="main"),class:"btn btn-primary p-3"},[s[21]||(s[21]=p("Выбрать ",-1)),(e.report.selected_agents||[]).length>0?(l(),i("span",Ze," ("+m(e.report.selected_agents.length)+") ",1)):d("",!0)]),t("button",{type:"button",onClick:s[9]||(s[9]=(...n)=>e.resetAgents&&e.resetAgents(...n)),class:"btn btn-light"},"Сбросить")])],64)):d("",!0)],32))}});export{tt as R,Bt as _,je as a,P as b,ts as c,B as u};
