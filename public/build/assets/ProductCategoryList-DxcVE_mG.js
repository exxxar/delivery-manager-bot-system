import{f as b,c as n,b as s,w as y,v as C,t as h,h as p,H as w,o as r,a as S,e as m,F as f,r as $,i as g,d as k,n as E}from"./app-cgtwwb2d.js";import{P as M}from"./Pagination-DFrGqlTd.js";import{m as l}from"./makeAxiosFactory-CxzlH8pq.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as P}from"./useConfitmModalStore-DOjvUCmK.js";import{u as B}from"./users-DNUFq-ng.js";const d="/bot-api/product-categories",v=b("productCategories",{state:()=>({items:[],loading:!1,error:null}),getters:{byId:e=>t=>e.items.find(o=>o.id===t)},actions:{async fetchAll(){this.loading=!0,this.error=null;try{const{data:e}=await l(`${d}`,"GET");this.items=e}catch(e){this.error=(e==null?void 0:e.message)||"Failed to load categories"}finally{this.loading=!1}},async fetchProductsByCategory(e=1){const{data:t}=await l(`${d}/with-products?page=${e}`,"GET");this.items=t.data,this.pagination=t},async loadMoreProductsInCategory(e,t){const{data:o}=await l(`${d}/fetch-next-products/${e}/products?page=${t}`,"GET");this.items.find(a=>a.id===e).products.push(...o.data)},async fetchAllByPage(e=1){const{data:t}=await l(`${d}?page=${e}`,"GET");this.items=t.data,this.pagination=t},async fetchByUrl(e){const{data:t}=await l(e,"GET");this.items=t.data,this.pagination=t},async fetchOne(e){try{const{data:t}=await l(`${d}/${e}`,"GET");return t}catch(t){throw this.error=(t==null?void 0:t.message)||"Failed to load category",t}},async create(e){const{data:t}=await l(`${d}`,"POST",e);return this.items.push(t),t},async removeAll(e){await l(`${d}/remove-all`,"POST",{ids:e}),e.forEach(t=>{this.items=this.items.filter(o=>o.id!==t)})},async update(e,t){const{data:o}=await l(`${d}/${e}`,"PUT",t),i=this.items.findIndex(a=>a.id===e);return i!==-1&&(this.items[i]=o),o},async remove(e){await l(`${d}/${e}`,"DELETE"),this.items=this.items.filter(t=>t.id!==e)}}}),A={name:"ProductCategoryForm",props:{initialData:{type:Object,default:null}},data(){return{alertStore:w(),productCategoryStore:v(),form:{name:"",description:""},isEdit:!1}},created(){this.initialData&&(this.form={...this.initialData},this.isEdit=!0)},methods:{async submitForm(){try{this.isEdit?await this.productCategoryStore.update(this.form.id,this.form).then(()=>{this.alertStore.show("Категория успешно обновлена","success")}):await this.productCategoryStore.create(this.form).then(()=>{this.alertStore.show("Категория успешно создана","success")}),this.$emit("saved")}catch(e){console.error("Ошибка сохранения категории:",e)}}}},D={class:"form-floating mb-2"},T={class:"form-floating mb-2"},F={type:"submit",class:"btn btn-primary w-100 p-3"};function I(e,t,o,i,a,c){return r(),n("form",{onSubmit:t[2]||(t[2]=p((...u)=>c.submitForm&&c.submitForm(...u),["prevent"]))},[s("div",D,[y(s("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>a.form.name=u),type:"text",class:"form-control",id:"name",placeholder:"Название категории",required:""},null,512),[[C,a.form.name]]),t[3]||(t[3]=s("label",{for:"name"},"Название категории",-1))]),s("div",T,[y(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=u=>a.form.description=u),class:"form-control",id:"description",placeholder:"Описание категории",style:{height:"120px"},required:""},null,512),[[C,a.form.description]]),t[4]||(t[4]=s("label",{for:"description"},"Описание категории",-1))]),s("button",F,h(a.isEdit?"Сохранить изменения":"Добавить категорию"),1)],32)}const U=_(A,[["render",I]]),V={class:"d-flex"},O={class:"list-group"},G=["onClick"],j={class:"fw-bold"},N={class:"text-muted"},x={class:"dropdown"},L={class:"dropdown-menu dropdown-menu-end"},q={key:0},z=["onClick"],H=["onClick"],J=["onClick"],K={key:0},Q=["onClick"],R={key:0,class:"alert alert-info mt-3"},W={class:"modal fade",id:"viewCategoryModal",tabindex:"-1"},X={class:"modal-dialog"},Y={class:"modal-content"},Z={class:"modal-body"},tt={key:0},et={class:"modal fade",id:"editCategoryModal",tabindex:"-1"},st={class:"modal-dialog"},ot={class:"modal-content"},it={class:"modal-body"},at={name:"ProductCategoryList",props:["forSelect"],data(){return{userStore:B(),modalStore:P(),productCategoryStore:v(),selectedCategory:null,selection:[]}},created(){this.fetchData()},computed:{user(){return this.userStore.self||null}},methods:{removeAll(){this.modalStore.open("Вы уверены, что хотите удалить все выбранные элементы?",()=>{this.productCategoryStore.removeAll(this.selection),this.selection=[]},()=>{this.modalStore.close(),this.selection=[]})},toggleSelection(e){if(this.forSelect){this.$emit("select",e);return}let t=this.selection.findIndex(o=>o===e.id);t===-1?this.selection.push(e.id):this.selection.splice(t,1)},selectAll(){this.selection.length===0?this.productCategoryStore.items.forEach(e=>{this.selection.indexOf(e.id)===-1&&this.selection.push(e.id)}):this.selection=[]},async fetchData(e=1){const t=bootstrap.Modal.getInstance(document.getElementById("editCategoryModal"));t&&t.hide(),await this.productCategoryStore.fetchAllByPage(e)},async fetchDataByUrl(e){await this.productCategoryStore.fetchByUrl(e)},openViewModal(e){this.selectedCategory=e,new bootstrap.Modal(document.getElementById("viewCategoryModal")).show()},openEditModal(e){this.selectedCategory=null,this.$nextTick(()=>{this.selectedCategory=e,new bootstrap.Modal(document.getElementById("editCategoryModal")).show()})},openDeleteModal(e){this.selectedCategory=e,this.modalStore.open(`Вы уверены, что хотите удалить ${this.selectedCategory.name}?`,()=>{this.productCategoryStore.remove(this.selectedCategory.id),this.selection=[],this.productCategoryStore.fetchAllByPage()},()=>{this.modalStore.close(),this.selection=[]})}}},ht=Object.assign(at,{setup(e){return(t,o)=>(r(),n(f,null,[s("div",V,[s("a",{href:"javascript:void(0)",onClick:o[0]||(o[0]=(...i)=>t.selectAll&&t.selectAll(...i)),class:"small"},"Выделить все"),t.selection.length>0?(r(),n("a",{key:0,href:"javascript:void(0)",onClick:o[1]||(o[1]=(...i)=>t.removeAll&&t.removeAll(...i)),class:"small text-danger mx-2"},"Удалить выделенное")):m("",!0)]),s("ul",O,[(r(!0),n(f,null,$(t.productCategoryStore.items,i=>{var a;return r(),n("li",{key:i.id,class:E([{"border-primary":t.selection.indexOf(i.id)!==-1},"list-group-item d-flex justify-content-between align-items-center"])},[s("div",{onClick:c=>t.toggleSelection(i)},[s("div",j,h(i.name),1),s("small",N,h(i.description),1)],8,G),s("div",x,[o[2]||(o[2]=s("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[s("i",{class:"fas fa-bars"})],-1)),s("ul",L,[e.forSelect?(r(),n("li",q,[s("a",{class:"dropdown-item",href:"#",onClick:p(c=>t.$emit("select",i),["prevent"])},"Выбрать",8,z)])):m("",!0),e.forSelect?m("",!0):(r(),n(f,{key:1},[s("li",null,[s("a",{class:"dropdown-item",href:"#",onClick:p(c=>t.openViewModal(i),["prevent"])},"Просмотреть",8,H)]),s("li",null,[s("a",{class:"dropdown-item",href:"#",onClick:p(c=>t.openEditModal(i),["prevent"])},"Редактировать",8,J)]),(((a=t.user)==null?void 0:a.role)||0)>=3?(r(),n("li",K,[s("a",{class:"dropdown-item text-danger",href:"#",onClick:p(c=>t.openDeleteModal(i),["prevent"])},"Удалить",8,Q)])):m("",!0)],64))])])],2)}),128))]),S(M,{pagination:t.productCategoryStore.pagination,onPageChanged:t.fetchDataByUrl},null,8,["pagination","onPageChanged"]),t.productCategoryStore.items.length===0?(r(),n("div",R," Категорий пока нет. ")):m("",!0),s("div",W,[s("div",X,[s("div",Y,[o[6]||(o[6]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Просмотр категории"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),s("div",Z,[t.selectedCategory?(r(),n("div",tt,[s("p",null,[o[3]||(o[3]=s("strong",null,"Название:",-1)),g(" "+h(t.selectedCategory.name),1)]),s("p",null,[o[4]||(o[4]=s("strong",null,"Описание:",-1)),g(" "+h(t.selectedCategory.description),1)]),s("p",null,[o[5]||(o[5]=s("strong",null,"ID:",-1)),g(" "+h(t.selectedCategory.id),1)])])):m("",!0)])])])]),s("div",et,[s("div",st,[s("div",ot,[o[7]||(o[7]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Редактирование категории"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),s("div",it,[t.selectedCategory?(r(),k(U,{key:0,"initial-data":t.selectedCategory,onSaved:t.fetchData},null,8,["initial-data","onSaved"])):m("",!0)])])])])],64))}});export{U as P,ht as _,v as u};
